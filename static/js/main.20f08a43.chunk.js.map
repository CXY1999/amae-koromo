{"version":3,"sources":["utils/conf.ts","data/types/metadata.ts","data/types/ranking.ts","components/form/formRow.tsx","data/types/record.ts","components/gameRecords/player.tsx","data/source/api.ts","i18n.ts","components/misc/loading.tsx","serviceWorker.ts","components/layout/container.tsx","components/app/appHeader.tsx","components/app/maintenance.tsx","components/app/navbar.tsx","components/misc/canonicalLink.tsx","components/gameRecords/index.tsx","components/app/index.tsx","index.tsx","components/gameRecords/model.tsx","components/gameRecords/table.tsx","components/misc/customizedLoadable.ts","data/types/gameMode.ts","data/types/constants.ts","components/gameRecords/routeSync.tsx","components/gameRecords/filterPanel.tsx","components/gameRecords/playerSearch.tsx","components/gameRecords/routes.tsx","components/misc/tracker.tsx","components/form/checkboxGroup.tsx","components/form/datePicker.tsx","components/form/index.tsx","data/types/level.ts","utils/index.ts","components/gameRecords/dataAdapterProvider.tsx","data/types/index.ts","components/misc/alert.tsx","data/types/utils.ts","components/misc/scroller.tsx","data/source/records/loader.ts","data/source/records/provider.ts","data/source/misc.ts","components/gameRecords/modeSelector.tsx"],"names":["domain","sessionStorage","getItem","localStorage","window","location","hostname","CONFIGURATIONS","DEFAULT","apiSuffix","features","ranking","statistics","estimatedStableLevel","contestTools","statisticsSubPages","rankBySeat","dataByRank","fanStats","table","showGameMode","availableModes","GameMode","王座","玉","dateMin","dayjs","siteTitle","canonicalDomain","showTopNotice","mirrorUrl","siteSpecificNotice","rootClassName","rankColors","ako","金","ikeda","三王座","三玉","三金","contest","s","ConfBase","test","m","exec","Conf","mergeDeep","isObject","obj","constructor","Object","objects","reduce","prev","keys","forEach","key","pVal","oVal","Array","isArray","document","documentElement","className","t","i18n","bind","RANK_DELTA_4","RANK_DELTA_3","RANK_DELTA","MODE_DELTA","MODE_BASE_POINT","RankRates","freeze","getAvg","rates","sum","map","value","index","normalize","total","FanStatEntry2","formatFan","entry","役满","count","FanStatEntryList","formatFanSummary","list","x","result","calculateDeltaPoint","score","rank","mode","level","includePenalty","Math","ceil","length","getPenaltyPoint","PlayerMetadata","calculateRankDeltaPoints","metadata","trimNumber","rankDeltaPoints","rank_avg_score","LevelWithDelta","getAdjustedLevel","calculateExpectedGamePoint","rankWeightedPoints","point","rank_rates","expectedGamePoint","a","b","estimateStableLevel","calcPoint","Level","id","lastPositiveLevel","undefined","abs","getTag","toFixed","getNextLevel","isAllowedMode","getMaxPoint","prevLevel","getPreviousLevel","formatStableLevel2","formatNumber","toString","indexOf","slice","translatedLevelTags","getTranslatedLevelTags","getStableLevelComponents","this","estimateStableLevel2","RankingTimeSpan","CareerRankingType","FormRow","title","inline","children","ns","GameRecord","getRankIndexByPlayer","rec","player","playerId","accountId","sortedPlayers","players","sort","i","getPlayerRankLabel","getRankLabelByIndex","getPlayerRankColor","encodeAccountId","getStartTime","startTime","formatFullStartTime","format","formatStartDate","getRecordLink","trailer","parseInt","uuid","Player","game","isActive","nickname","isTop","href","target","rel","getLevelTag","to","generatePlayerPathById","DATA_MIRRORS","PROBE_TIMEOUT","selectedMirror","onMaintenance","setMaintenanceHandler","handler","fetchWithTimeout","url","async","opts","timeout","abortController","AbortController","signal","abort","Promise","race","fetch","_","reject","setTimeout","Error","fetchData","path","console","warn","done","mirror","then","resp","setItem","log","catch","e","apiGet","ok","json","data","maintenance","use","LanguageDetector","initReactI18next","init","resources","lowerCaseLng","fallbackLng","defaultNS","debug","process","whitelist","detection","order","caches","checkWhitelist","returnEmptyString","returnNull","saveMissing","missingKeyHandler","nsSeparator","keySeparator","interpolation","escapeValue","on","triggerRelayout","Loading","size","role","isLocalhost","Boolean","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","error","Container","fluid","AlertDefault","AlertEn","AlertJa","AppHeader","useTranslation","container","stateName","language","MaintenanceHandler","useState","msg","setMsg","closable","NAV_ITEMS","filter","label","SITE_LINKS","active","LANGUAGES","code","some","pathname","startsWith","Navbar","mobileVisible","setMobileVisible","onToggleButtonClick","useCallback","preventDefault","stopPropagation","useEffect","classList","contains","addEventListener","removeEventListener","type","data-toggle","data-target","aria-controls","aria-expanded","aria-label","onClick","activeClassName","clsx","changeLanguage","CanonicalLink","loc","useLocation","Helmet","Routes","Loadable","loader","loading","GameRecords","Ranking","Statistics","RecentHighlight","ContestTools","App","defaultTitle","titleTemplate","category","rootElement","getElementById","render","URL","origin","headers","response","contentType","get","status","ready","unregister","reload","checkValidServiceWorker","waitingServiceWorker","waiting","event","postMessage","Model","removeExtraParams","model","selectedMode","startDate","endDate","searchText","date","DEFAULT_MODEL","ModelContext","React","createContext","useModel","useContext","isSameModel","generatePath","OnRouteModelUpdatedContext","useOnRouteModelUpdated","ModelProvider","history","useHistory","useReducer","oldModel","newModel","setModel","dispatchModelUpdate","useEventCallback","newProps","valueOf","normalizeUpdate","replace","useMemo","Provider","Players","memo","activePlayerId","cellFormatTime","cellData","unix","cellFormatFullTime","rowData","isMobile","cellFormatRank","columnData","style","color","cellFormatGameMode","modeLabel","makeColumn","builder","random","args","outer","ret","cloneElement","join","COLUMN_GAMEMODE","dataKey","cellRenderer","width","COLUMN_RANK","COLUMN_PLAYERS","flexGrow","COLUMN_STARTTIME","headerClassName","COLUMN_ENDTIME","COLUMN_FULLTIME","GameRecordTable","columns","withActivePlayer","alwaysShowDetailLink","useDataAdapter","scrollerProps","useScrollerProps","isScrolling","onChildScroll","scrollTop","height","registerChild","rowGetter","getRowClassName","isItemLoaded","even","noRowsRenderer","getUnfilteredCount","shouldTriggerLayout","memoColumns","ref","disableHeight","autoHeight","rowCount","getCount","rowHeight","matchMedia","matches","headerHeight","onScroll","rowClassName","CustomizedLoadable","options","delay","getFixedT","PLAYER_RANKS","RANK_LABELS","parseOptionalDate","defaultValue","ModelBuilders","params","search","listing","isValid","startOf","RouteSync","view","scrollToTop","onRouteModelUpdated","useParams","query","URLSearchParams","assign","modelResult","DEFAULT_DATE","FilterPanel","updateModel","updateSearchTextFromEvent","currentTarget","setMode","setDate","min","onChange","playerSearchCache","NUM_RESULTS_SHOWN","NUM_FETCH","normalizeName","toLowerCase","trim","PlayerSearchResult","version","setVersion","cachedResult","prefix","normalizedPrefix","isExactMatch","findRawResultFromCache","mayHaveMore","filteredPlayers","push","isLoading","cancelled","debounceToken","searchPlayer","Date","getTime","clearTimeout","PlayerSearch","PlayerDetails","PLAYER_PATH","PATH","genPath","GameRecordTablePlayerView","exact","currentCategory","PageCategory","useLayoutEffect","oldCategory","TrackerImpl","requestAnimationFrame","peek","ga","hitType","page","contentGroup1","Tracker","host","__loadGa","CheckboxGroup","props","items","groupKey","selectedItemKeys","setSelected","isSelected","has","newSet","Set","add","delete","isChecked","selectedItemKey","Fragment","item","name","checked","htmlFor","DatePicker","max","handleChange","LEVEL_MAX_POINTS","LEVEL_PENALTY","LEVEL_PENALTY_3","LEVEL_ALLOWED_MODES","101","102","103","104","105","106","201","202","203","204","205","206","rawTags","charCodeAt","split","fill","levelId","_majorRank","_minorRank","_numPlayerId","realId","floor","other","includes","majorRank","minorRank","maxPoints","getStartingPoint","formatAdjustedScore","formatAdjustedScoreWithTag","delta","dispatchEvent","UIEvent","scrollTo","formatPercent","formatFixed3","formatIdentity","fn","dependencies","useRef","current","NOT_FINISHED","notFinished","__useAsyncCache","useAsync","maybePromise","cacheKey","fulfilledValue","setFulfilledValue","useAsyncFactory","factory","deps","numbers","loadingPlaceholder","DUMMY_DATA_ADAPTER","noop","DataAdapter","provider","onDataUpdate","_provider","_onDataUpdate","_triggeredRequest","promise","_callHook","isError","maybeCount","getCountMaybeSync","_installHook","getUnfilteredCountSync","getMetadataSync","hook","DataAdapterContext","Consumer","useDataAdapterCommon","dataProvider","onError","dataAdapter","setDataAdapter","refreshDataAdapter","adapter","cancelUpdateHook","setUpdateHook","DataAdapterProvider","dataProviders","searchPredicate","memoFunc","memoDeps","needPredicate","modeId","usePredicate","getProviderKey","DataProvider","createListing","createPlayer","createProvider","setFilterPredicate","DataAdapterProviderCustom","Alert","stateKey","closed","setClosed","Cont","data-dismiss","aria-hidden","ScrollerContext","Scroller","RecentHighlightDataLoader","numItems","_data","every","_id","records","recordMap","skip","limit","ListingDataLoader","_date","cacheTag","PlayerDataLoader","_playerId","_startDate","_endDate","_mode","_getDatePath","_getParams","stats","extended_stats","extendedStats","DataProviderImpl","itemsPerChunk","_loader","_metadata","_countPromise","_chunks","_itemsPerChunk","_filterPredicate","_filteredIndices","_filterResultCache","predicate","updateFilteredIndices","numShownItems","indices","chunk","numLoadedItems","getMetadata","resolve","mappedIndex","_mapItemIndex","chunkNumber","skipPreload","innerIndex","_getChunk","preload","requestedIndex","reversed","chunkIndex","_loadChunk","numChunks","getRecords","createHightlight","endOf","encodeURIComponent","getDeltaRanking","timespan","getCareerRanking","getGlobalStatistics","getFanStats","getRankRateBySeat","rawResp","counts","maxRank","modeIdStr","seatId","numGames","MODE_CHECKBOXES","String","ModeSelector","unshift"],"mappings":"qLAGMA,EACJC,eAAeC,QAAQ,mBAAqBC,aAAaD,QAAQ,mBAAqBE,OAAOC,SAASC,SAE3FC,EAAiB,CAC5BC,QAAS,CACPC,UAAkE,OAClEC,SAAU,CACRC,SAAS,EACTC,YAAY,EACZC,sBAAsB,EACtBC,cAAc,EACdC,mBAAoB,CAClBC,YAAY,EACZC,YAAY,EACZC,UAAU,IAGdC,MAAO,CACLC,cAAc,GAEhBC,eAAgB,CAACC,WAASC,aAAID,WAASE,QACvCC,QAASC,IAAM,aAAc,cAC7BC,UAAW,iCACXC,gBAAiB,sBACjBC,eAAe,EACfC,UAAW,wBACXC,mBAAoB,yJACpBC,cAAe,SACfC,WAAY,CAAC,UAAW,UAAW,UAAW,YAEhDC,IAAK,CACHzB,UAAW,WACXC,SAAU,CACRC,SAAS,EACTC,YAAY,EACZC,sBAAsB,EACtBC,cAAc,EACdC,mBAAoB,CAClBC,YAAY,EACZC,YAAY,EACZC,UAAU,IAGdC,MAAO,CACLC,cAAc,GAEhBC,eAAgB,CAACC,WAASa,QAC1BV,QAASC,IAAM,aAAc,cAC7BC,UAAW,2CACXC,gBAAiB,cACjBE,UAAW,wBACXC,mBAAoB,2HACpBC,cAAe,UAEjBI,MAAO,CACL3B,UAAW,UACXC,SAAU,CACRC,SAAS,EACTC,YAAY,EACZC,sBAAsB,EACtBC,cAAc,EACdC,mBAAoB,CAClBC,YAAY,EACZC,YAAY,EACZC,UAAU,IAGdG,eAAgB,CAACC,WAASe,mBAAKf,WAASgB,aAAIhB,WAASiB,cACrDd,QAASC,IAAM,aAAc,cAC7BC,UAAW,iDACXC,gBAAiB,gBACjBE,UAAW,0BACXC,mBAAoB,iLACpBE,WAAY,CAAC,UAAW,UAAW,WACnCD,cAAe,SAEjBQ,QAAS,CACP/B,UAAW,SAACgC,GAAD,4BAA8BA,EAA9B,MACX/B,SAAU,CACRC,SAAS,EACTC,YAAY,EACZC,sBAAsB,EACtBC,cAAc,EACdC,mBAAoB,CAClBC,YAAY,EACZC,YAAY,EACZC,UAAU,IAGdC,MAAO,CACLC,cAAc,GAEhBC,eAAgB,GAChBO,gBAAiB5B,EACjB6B,eAAe,IAgCnB,IAAMa,EAAoC,WACxC,GAAI,iBAAiBC,KAAK3C,GACxB,OAAOO,EAAe2B,IAExB,GAAI,qBAAqBS,KAAK3C,GAC5B,OAAOO,EAAe6B,MAExB,IAAMQ,EAAI,uBAAuBC,KAAK7C,GACtC,OAAI4C,EACK,eAAKrC,EAAeiC,QAA3B,CAAoC/B,UAAWF,EAAeiC,QAAQ/B,UAAUmC,EAAE,MAE7ErC,EAAeC,QAXkB,GAcpCsC,EAvCN,SAASC,IAAyE,IAEhF,IAAMC,EAAW,SAAIC,GAAJ,OAAeA,GAAsB,kBAARA,GAAqBA,EAAYC,cAAgBC,QAFf,mBAA1BC,EAA0B,yBAA1BA,EAA0B,gBAIhF,OAAOA,EAAQC,QAAO,SAACC,EAASL,GAiB9B,OAhBAE,OAAOI,KAAKN,GAAKO,SAAQ,SAACC,GACxB,IAAMC,EAAOJ,EAAKG,GACZE,EAAOV,EAAIQ,GAEbG,MAAMC,QAAQH,IAASE,MAAMC,QAAQF,GAEvCL,EAAKG,GAAOE,EACHX,EAASU,IAASV,EAASW,GAEpCL,EAAKG,GAAOV,EAAUW,EAAMC,GAG5BL,EAAKG,GAAOE,KAITL,IACN,IAiBQP,CAAyBxC,EAAeC,QAASkC,GAE9DoB,SAASC,gBAAgBC,WAAa,IAAMlB,EAAKd,cAElCc,O,2PC5ITmB,EAAIC,IAAKD,EAAEE,KAAKD,KAEhBE,EAAe,CAAC,GAAI,GAAI,GAAI,IAC5BC,EAAe,CAAC,GAAI,GAAI,IACxBC,GAAU,mBACbhD,IAASa,OAAIiC,GADA,cAEb9C,IAASE,OAAI4C,GAFA,cAGb9C,IAASC,aAAK6C,GAHD,cAIb9C,IAASiB,aAAK8B,GAJD,cAKb/C,IAASgB,aAAK+B,GALD,cAMb/C,IAASe,mBAAMgC,GANF,GAQVE,GAAU,mBACbjD,IAASa,OAAI,CAAC,GAAI,GAAI,EAAG,IADZ,cAEbb,IAASE,OAAI,CAAC,IAAK,GAAI,EAAG,IAFb,cAGbF,IAASC,aAAK,CAAC,IAAK,GAAI,EAAG,IAHd,cAIbD,IAASiB,aAAK,CAAC,IAAK,EAAG,IAJV,cAKbjB,IAASgB,aAAK,CAAC,IAAK,EAAG,IALV,cAMbhB,IAASe,mBAAM,CAAC,IAAK,EAAG,IANX,GAQVmC,GAAe,mBAClBlD,IAASa,OAAI,MADK,cAElBb,IAASE,OAAI,MAFK,cAGlBF,IAASC,aAAK,MAHI,cAIlBD,IAASiB,aAAK,MAJI,cAKlBjB,IAASgB,aAAK,MALI,cAMlBhB,IAASe,mBAAM,MANG,GAURoC,EAAYtB,OAAOuB,OAAO,CACrCC,OADqC,SAC9BC,GACL,OAAOC,YAAID,EAAME,KAAI,SAACC,EAAOC,GAAR,OAAkBD,GAASC,EAAQ,OAAOH,YAAID,IAErEK,UAJqC,SAI3BL,GACR,IAAMM,EAAQL,YAAID,GAClB,OAAOA,EAAME,KAAI,SAACC,GAAD,OAAWA,EAAQG,QAO3BC,EAAgBhC,OAAOuB,OAAO,CACzCU,UADyC,SAC/BC,GACR,OAAIA,EAAMC,aACS,IAAbD,EAAMC,aACDrB,EAAE,gBAEL,GAAN,OAAUoB,EAAMC,aAAhB,YAAsBrB,EAAE,uBAEpB,GAAN,OAAUoB,EAAME,MAAhB,YAAyBtB,EAAE,cAIlBuB,EAAmBrC,OAAOuB,OAAO,CAC5Ce,iBAD4C,SAC3BC,GACf,IAAMH,EAAQV,YAAIa,EAAKZ,KAAI,SAACa,GAAD,OAAOA,EAAEJ,UAC9BD,EAAKT,YAAIa,EAAKZ,KAAI,SAACa,GAAD,OAAOA,EAAEL,iBACjC,GAAIA,EACF,OAAW,IAAPA,EACKrB,EAAE,gBAEL,GAAN,OAAUqB,EAAV,YAAgBrB,EAAE,uBAEpB,IAAI2B,EAAM,UAAML,EAAN,YAAetB,EAAE,WAY3B,OAXIsB,GAAS,GACXK,GAAU,MAAQ3B,EAAE,4BACXsB,GAAS,GAClBK,GAAU,MAAQ3B,EAAE,sBACXsB,GAAS,EAClBK,GAAU,MAAQ3B,EAAE,gBACXsB,GAAS,EAClBK,GAAU,MAAQ3B,EAAE,gBACD,IAAVsB,IACTK,GAAU,MAAQ3B,EAAE,iBAEf2B,KA4EJ,SAASC,EACdC,EACAC,EACAC,EACAC,GAGS,IAFTC,IAEQ,yDACJN,KADI,yDAEQO,KAAKC,KAAO,SAACT,GAAD,OAAeA,KAAIG,EAAQtB,EAAgBwB,IAAS,IAAO1B,EAAW0B,GAAMD,IACtGxB,EAAWyB,GAAMD,GASnB,OARIA,IAASzB,EAAW0B,GAAMK,OAAS,GAAKH,IAC1CN,GAAUK,EAAMK,mBAOXV,EAGF,IAAMW,EAAiBpD,OAAOuB,OAAO,CAC1C8B,yBAD0C,SAExCC,EACAT,EACAC,GAGY,IAFZC,IAEW,yDADXQ,IACW,yDACLC,EAAkBF,EAASG,eAAe9B,KAAI,SAACgB,EAAOC,GAAR,OAClDF,EACEC,EACAC,EACAC,EACAC,GAASY,IAAeC,iBAAiBL,EAASR,OAClDC,EACAQ,MAGJ,OAAOC,GAETI,2BApB0C,SAoBfN,EAA0BT,EAAgBC,GAA+C,IAAhCC,IAA+B,yDAC3GS,EAAkBJ,EAAeC,yBAAyBC,EAAUT,EAAMC,EAAOC,GACjFc,EAAqBL,EAAgB7B,KAAI,SAACmC,EAAOlB,GAAR,OAAiBkB,EAAQR,EAASS,WAAWnB,MACtFoB,EAAoBH,EAAmB3D,QAAO,SAAC+D,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAQrE,OAAOF,GAETG,oBAjC0C,SAiCtBb,EAA0BT,GAI5C,IAHA,IAAMuB,EAAY,SAACtB,GAAD,OAAkBM,EAAeQ,2BAA2BN,EAAUT,EAAMC,IAC1FA,EAAQ,IAAIuB,IAAMf,EAASR,MAAMwB,IACjCC,OAAuCC,IAClC,CACP,IAAMR,EAAoBI,EAAUtB,GACpC,GAAIE,KAAKyB,IAAIT,GAAqB,KAChC,OAAOlB,EAAM4B,SAAW,OAE1B,KAAIV,GAAqB,GAMlB,CACL,GAAIO,EACF,MAAM,GAAN,OAAUA,EAAkBG,SAA5B,aAAyCN,EAAUG,GAAmBI,QAAQ,GAA9E,KAEF,MAPA,GAFAJ,EAAoBzB,IACpBA,EAAQA,EAAM8B,gBACHC,cAAchC,IAASC,IAAUyB,EAC1C,MAAM,GAAN,OAAUA,EAAkBG,SAA5B,cAA0CV,EAAkBW,QAAQ,GAApE,KASN,IAAK7B,EAAMgC,cAET,MAAM,GAAN,OAAUhC,EAAM4B,SAAhB,cAA8BN,EAAUtB,GAAO6B,QAAQ,GAAvD,KAEF,OAAS,CACP,IAAMI,EAAYjC,EAAMkC,mBACxB,IAAKD,EAAUF,cAAchC,IAASkC,IAAcjC,EAClD,MAAM,GAAN,OAAUA,EAAM4B,SAAhB,cAA8BN,EAAUtB,GAAO6B,QAAQ,GAAvD,KAIF,GAD0BP,EAD1BtB,EAAQiC,IAEiB,KACvB,MAAM,GAAN,OAAUjC,EAAM4B,SAAhB,aAA6B1B,KAAKyB,IAAIL,EAAUtB,IAAQ6B,QAAQ,GAAhE,OAINM,mBAvE0C,SAuEvBnC,GACjB,IAAMoC,EAAe,SAAU1C,GAE7B,IAAIlD,EAAIkD,EAAE2C,WAOV,OANwB,IAApB7F,EAAE8F,QAAQ,OACZ9F,GAAK,OAEHA,EAAE4D,OAAS,IACb5D,GAAK,MAEAA,EAAE+F,MAAM,EAAG/F,EAAE8F,QAAQ,KAAO,IAE/BE,EAAsBC,cAC5B,OAAIzC,GAAS,EACL,GAAN,OAAUwC,EAAoB,IAA9B,OAAmCJ,EAAapC,EAAQ,IAEtDA,GAAS,EACL,GAAN,OAAUwC,EAAoB,IAA9B,OAAmCJ,EAAapC,EAAQ,IAEpD,GAAN,OAAUwC,EAAoB,IAA9B,OAAmCJ,EAAapC,KAElD0C,yBA5F0C,SA4FjBlC,EAA0BT,GACjD,OAAO4C,KAAKpC,yBAAyBC,EAAUT,OAAM2B,GAAW,GAAO,IAEzEkB,qBA/F0C,SA+FrBpC,EAA0BT,GAC7C,GAAmC,IAA/BS,EAASS,WAAWb,OACtB,OAAOuC,KAAKtB,oBAAoBb,EAAUT,GAE5C,IAAKS,EAASS,WAAW,GACvB,MAAO,GAET,IACMtB,EADkBgD,KAAK7B,2BAA2BN,EAAUT,OAAM2B,GAAW,IACxB,GAAzBlB,EAASS,WAAW,IAAW,GACjE,OAAOX,EAAe6B,mBAAmBxC,O,iCC3RtC,IAAKkD,EAoBAC,EApBZ,oE,SAAYD,K,aAAAA,E,gBAAAA,M,cAoBAC,K,cAAAA,E,gBAAAA,E,kBAAAA,E,cAAAA,E,mBAAAA,E,qBAAAA,E,2BAAAA,E,mCAAAA,E,UAAAA,E,YAAAA,E,iBAAAA,E,mBAAAA,E,2CAAAA,E,2CAAAA,E,2CAAAA,E,2CAAAA,E,2CAAAA,E,2CAAAA,E,2CAAAA,E,kDAAAA,E,kDAAAA,E,mDAAAA,M,uCCvBZ,6DAGaC,EAAU,SAAC,GAAD,QAAGC,aAAH,MAAW,GAAX,MAAeC,cAAf,aAA+BC,gBAA/B,WAA0CxB,EAA1C,SACrB,oCACE,2BAAO3D,UAAW,kBAChB,kBAAC,IAAD,CAAOoF,GAAG,WAAWH,IAEvB,yBAAKjF,UAAS,2BAAsBkF,EAAS,cAAgB,KAAOC,M,iCCRxE,6EA+BaE,EAAalG,OAAOuB,OAAO,CACtC4E,qBADsC,SACjBC,EAAiBC,GACpC,IAAMC,GAA8B,kBAAXD,EAAsBA,EAAOE,UAAYF,GAAQlB,WACpEqB,EAAgBJ,EAAIK,QAAQ9E,KAAI,SAAC0E,EAAQxE,GAAT,MAAoB,CAAEwE,SAAQxE,YACpE2E,EAAcE,MAAK,SAACzC,EAAGC,GAAJ,OAAU,EAAIA,EAAErC,MAAQqC,EAAEmC,OAAO1D,OAAS,EAAIsB,EAAEpC,MAAQoC,EAAEoC,OAAO1D,UACpF,IAAK,IAAIgE,EAAI,EAAGA,EAAIH,EAActD,OAAQyD,IACxC,GAAIH,EAAcG,GAAGN,OAAOE,UAAUpB,aAAemB,EACnD,OAAOK,EAGX,OAAQ,GAEVC,mBAZsC,SAYnBR,EAAiBC,GAClC,OAAOQ,YAAoBX,EAAWC,qBAAqBC,EAAKC,KAAY,IAE9ES,mBAfsC,SAenBV,EAAiBC,GAClC,OAAO1G,IAAKb,WAAWoH,EAAWC,qBAAqBC,EAAKC,KAE9DU,gBAAiB,SAACjG,GAAD,OAAe,SAAY,EAAIA,EAAI,QAAW,WAC/DkG,aAAc,SAACZ,GAAD,OAAgF,KAAlC,kBAARA,EAAmBA,EAAMA,EAAIa,YACjFC,oBAAqB,SAACd,GAAD,OAA8B7H,IAAM2H,EAAWc,aAAaZ,IAAMe,OAAO,mBAC9FC,gBAAiB,SAAChB,GAAD,OAA8B7H,IAAM2H,EAAWc,aAAaZ,IAAMe,OAAO,QAC1FE,cAtBsC,SAsBxBjB,EAA0BC,GACtC,IAAMC,EAA6B,kBAAXD,EAAsBA,EAAOE,UAAYF,EAC3DiB,EAAUhB,EAAQ,YACfJ,EAAWa,gBAAoC,kBAAbT,EAAwBA,EAAWiB,SAASjB,KACnF,GACEkB,EAAsB,kBAARpB,EAAmBA,EAAMA,EAAIoB,KACjD,MAAM,GAAN,OAAUzG,IAAKD,EAAE,gCAAjB,kBAA0D0G,GAA1D,OAAiEF,O,qDC3DrE,sFAOaG,EAAS,YAQlB,IAPFpB,EAOC,EAPDA,OACAqB,EAMC,EANDA,KACAC,EAKC,EALDA,SAMQC,EAAsCvB,EAAtCuB,SAAU9E,EAA4BuD,EAA5BvD,MAAOH,EAAqB0D,EAArB1D,MAAO4D,EAAcF,EAAdE,UAC1BsB,EAA0D,IAAlD3B,aAAWC,qBAAqBuB,EAAMrB,GACpD,OACE,0BAAMxF,UAAS,iBAAYgH,GAAS,mBAArB,YAA2CF,GAAY,kBACpE,uBAAGG,KAAM5B,aAAWmB,cAAcK,EAAMrB,GAASP,MAAM,2BAAOiC,OAAO,SAASC,IAAI,uBAAlF,IACIC,sBAAYnF,GADhB,KAC0B8E,EAD1B,SAC+CpD,IAAV7B,GAAA,WAA2BA,EAA3B,MAChC,IACL,kBAAC,IAAD,CAAM9B,UAAU,cAAciF,MAAM,2BAAOoC,GAAIC,iCAAuB5B,IACpE,kBAAC,IAAD,U,um/BCrBF6B,EAAe,CAAC,6BAA8B,6BAA8B,8BAC5EC,EAAgB,KAElBC,EAAiBtL,aAAaD,QAAQ,mBAAqBqL,EAAa,GAExEG,EAAuC,aAEpC,SAASC,EAAsBC,GACpCF,EAAgBE,EAGlB,SAAeC,EAAiBC,GAAhC,+BAAA1E,EAAA2E,OAAA,uDAA6CC,EAA7C,+BAAiE,GAAIC,EAArE,+BAA+E,IACvEC,EAAkB9L,OAAO+L,gBAAkB,IAAIA,gBAAoB,CAAEC,YAAQzE,EAAW0E,MAAO,cADvG,kBAESC,QAAQC,KAAK,CAClBC,MAAMV,EAAD,eAAWE,EAAX,CAAiBI,OAAQF,EAAgBE,UAC9C,IAAIE,SAAQ,SAACG,EAAGC,GAAJ,OACVC,YAAW,WACTT,EAAgBG,QAChBK,EAAO,IAAIE,MAAM,cAChBX,SART,qCAaA,SAAeY,EAAUC,GAAzB,eAAA1F,EAAA2E,OAAA,2EAAA3E,EAAA,MAEiByE,EAAiBJ,EAAiBqB,IAFnD,wEAIIC,QAAQC,KAAR,MACAD,QAAQC,KAAR,2CAAiDvB,EAAjD,6BALJ,eAQMwB,GAAO,EARb,kBASSX,QAAQC,KACbhB,EAAazG,KAAI,SAACoI,GAAD,OACfrB,EAAiBqB,EAASJ,EAAM,GAAItB,GACjC2B,MAAK,SAAUC,GACd,OAAIH,EACKG,GAETH,GAAO,EACPxB,EAAiByB,EACjB/M,aAAakN,QAAQ,iBAAkB5B,GACvCsB,QAAQO,IAAR,cAAmBJ,EAAnB,kBACOE,MAERG,OAAM,SAACC,GAAD,OAAO,IAAIlB,SAAQ,SAACG,EAAGC,GAAJ,OAAeC,YAAW,kBAAMD,EAAOc,KAAIhC,cAtB7E,wDA2BO,SAAeiC,EAAUX,GAAzB,iBAAA1F,EAAA2E,OAAA,kEAAA3E,EAAA,MACcyF,EAAU/J,IAAKrC,UAAYqM,IADzC,WACCM,EADD,QAEKM,GAFL,sBAGGN,EAHH,yBAAAhG,EAAA,MAKcgG,EAAKO,QALnB,YAKCC,EALD,QAMIC,YANJ,wBAOHnC,EAAckC,EAAKC,aAPhB,kBAQI,IAAIvB,SAAQ,gBARhB,iCAUEsB,GAVF,wC,kHCtDP,4CAaA1J,IACG4J,IAAIC,KACJD,IAAIE,KACJC,KAAK,CACJC,YACAC,cAAc,EACdC,YAAa,UACbC,UAAW,UACXC,OAdUC,EAeVC,UAAW,CAAC,KAAM,UAAW,MAC7BC,UAAW,CACTC,MAAO,CAAC,eAAgB,aACxBC,OAAQ,CAAC,gBACTC,gBAAgB,GAGlBC,mBAAmB,EACnBC,YAAY,EAEZC,aAzBUR,EA0BVS,mBAYI,EAEJC,aAAa,EACbC,cAAc,EAEdC,cAAe,CACbC,aAAa,KAInBlL,IAAKmL,GAAG,mBAAmB,WACzBC,iBAGapL,MAAf,G,gCC3DA,sDAEe,SAASqL,EAAT,GAAsE,IAAD,IAAlDC,YAAkD,MAA3C,SAA2C,EAClF,OACE,yBAAKxL,UAAS,0CAA8C,WAATwL,EAAoB,EAAI,IACzE,yBAAKxL,UAAS,yBAA6B,WAATwL,EAAoB,GAAK,qBAAuBC,KAAK,UACrF,0BAAMzL,UAAU,WAAhB,kB,oECSF0L,EAAcC,QACW,cAA7BvP,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASsP,MAAM,2DA0CnC,SAASC,EAAgBC,EAAeC,GACtCC,UAAUC,cACPC,SAASJ,GACT3C,MAAK,SAAAgD,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfR,UAAUC,cAAcQ,YAI1B1D,QAAQO,IACN,iHAKEyC,GAAUA,EAAOW,UACnBX,EAAOW,SAASP,KAMlBpD,QAAQO,IAAI,sCAGRyC,GAAUA,EAAOY,WACnBZ,EAAOY,UAAUR,WAO5B5C,OAAM,SAAAqD,GACL7D,QAAQ6D,MAAM,4CAA6CA,M,wDCpGpDC,EAAY,SAAC,GAAD,QAAG5H,aAAH,WAAWtB,EAAX,MAAsBwB,gBAAtB,WAAiCxB,EAAjC,MAAyDmJ,aAAzD,gBACvB,yBAAK9M,UAAS,wBAAmB8M,EAAQ,SAAW,KAClD,yBAAK9M,UAAU,OACb,yBAAKA,UAAU,aACZiF,GAAS,wBAAIjF,UAAU,QAAQiF,GAC/BE,M,sBCAT,SAAS4H,IACP,OACE,oCACE,4CACA,4BACE,gRACA,4BAAKjO,IAAKf,oBACV,8MACA,yEAAYe,IAAKrB,QAAQ6I,OAAO,kCAAhC,wFACA,+QAEE,uBAAGW,KAAMnI,IAAKhB,WAAd,4BAFF,UAIA,4FACa,uBAAGmJ,KAAK,sBAAR,2BADb,UACwE,IACtE,uBAAGA,KAAK,6CAAR,sBAFF,UAIA,4CACK,uBAAGA,KAAK,iCAAR,aADL,iDAQR,SAAS+F,IACP,OACE,oCACE,qCACA,4BACE,2KAIA,2HACA,4IAGA,gEACoClO,IAAKrB,QAAQ6I,OAAO,eADxD,+DAIA,0KAEgC,uBAAGW,KAAMnI,IAAKhB,WAAd,0BAFhC,KAIA,yFAC6D,IAC3D,uBAAGmJ,KAAK,sBAAR,2BAFF,MAE8D,IAC5D,uBAAGA,KAAK,6CAAR,mBAHF,KAKA,iFACoD,uBAAGA,KAAK,6BAAR,UADpD,OACuG,IACrG,uBAAGA,KAAK,gCAAR,aAFF,gBAIA,4CACK,uBAAGA,KAAK,iCAAR,aADL,iDAQR,SAASgG,IACP,OACE,oCACE,4CACA,4BACE,8YAGA,sOACA,0TACA,yEACUnO,IAAKrB,QAAQ6I,OAAO,kCAD9B,0JAGA,4BACE,uBAAGW,KAAM,WAAanI,IAAKlB,iBAA3B,wCADF,iOAGE,uBAAGqJ,KAAMnI,IAAKhB,WAAd,wCAHF,0DAKA,sLAC4B,uBAAGmJ,KAAK,sBAAR,2BAAyD,IADrF,sBAEM,uBAAGA,KAAK,6CAAR,UAFN,2DAIA,4CACK,uBAAGA,KAAK,iCAAR,aADL,iDAQD,SAASiG,IAAa,IACnBhN,EAASiN,cAATjN,KACR,OACE,kBAAC,IAAD,CAAOkN,UAAWP,EAAWQ,UAAU,mBACJ,IAAhCnN,EAAKoN,SAAS/I,QAAQ,MACrB,kBAAC0I,EAAD,MACkC,IAAhC/M,EAAKoN,SAAS/I,QAAQ,MACxB,kBAACyI,EAAD,MAEA,kBAACD,EAAD,O,mBCtGD,SAASQ,EAAT,GAAiG,IAAnEpI,EAAkE,EAAlEA,SAAkE,EAC/EqI,mBAAS,IADsE,mBAC9FC,EAD8F,KACzFC,EADyF,KAGrG,OADA/F,YAAsB+F,GACjBD,EAIH,gBAAC,IAAD,CAAOL,UAAWP,EAAWc,UAAU,GACrC,kEACA,yBAAIF,IALCtI,E,YCHLyI,EAAY,CAChB,CAAC,2BAAQ,aACT,CAAC,qBAAO,WACR,CAAC,qBAAO,eAEPC,QAAO,gBAAI/E,EAAJ,4BAAgBA,KAAQhK,IAAKpC,WAAaoC,IAAKpC,SAASoM,MAC/DhI,KAAI,yCAAoB,CAAEgN,MAAtB,KAA6BhF,KAA7B,SAEDiF,EAAa,CACjB,CAAC,kCAAUxR,IAAeC,QAAQoB,iBAClC,CAAC,qBAAOrB,IAAe2B,IAAIN,iBAC3B,CAAC,eAAMrB,IAAe6B,MAAMR,kBAC5BkD,KAAI,mCAAEgN,EAAF,KAAS9R,EAAT,WAAsB,CAAE8R,QAAO9R,SAAQgS,OAAQlP,IAAKlB,kBAAoB5B,MAExEiS,EAAY,CAChB,CAAC,eAAM,WACP,CAAC,qBAAO,MACR,CAAC,UAAW,OACZnN,KAAI,yCAAoB,CAAEgN,MAAtB,KAA6BI,KAA7B,SAGN,SAASpH,EAAS8E,EAAYvP,GAC5B,QAAKuP,IAGGgC,EAAUO,MAAK,gBAAGrF,EAAH,EAAGA,KAAH,OAAczM,EAAS+R,SAASC,WAAW,IAAMvF,MAG3D,SAASwF,IAAU,IAAD,EACXnB,cAAZlN,EADuB,EACvBA,EAAGC,EADoB,EACpBA,KADoB,EAEWsN,oBAAS,GAFpB,mBAExBe,EAFwB,KAETC,EAFS,KAGzBC,EAAsBC,uBAC1B,SAAClF,GACCA,EAAEmF,iBACFnF,EAAEoF,kBACFJ,GAAkBD,KAEpB,CAACA,EAAeC,IAelB,OAbAK,qBAAU,WACR,GAAKN,EAAL,CAGA,IAAM3G,EAAU,SAAC4B,GACVA,EAAEtC,OAAuB4H,UAAUC,SAAS,mBAGjDP,GAAiB,IAGnB,OADA1O,SAASkP,iBAAiB,QAASpH,GAC5B,kBAAM9H,SAASmP,oBAAoB,QAASrH,OAClD,CAAC2G,EAAeC,IAEjB,yBAAKxO,UAAU,kDACb,yBAAKA,UAAU,aACb,kBAAC,IAAD,CAAMA,UAAU,eAAeqH,GAAG,KAC/BpH,EAAEnB,IAAKnB,YAEV,4BACEqC,UAAU,iBACVkP,KAAK,SACLC,cAAY,WACZC,cAAY,sBACZC,gBAAc,qBACdC,gBAAc,QACdC,aAAW,oBACXC,QAASf,GAET,0BAAMzO,UAAU,yBAElB,yBACEA,UAAS,uDAAkDuO,EAAgB,GAAK,SAAvE,eACT9K,GAAG,sBAEH,yBAAKzD,UAAU,cACb,kBAAC,IAAD,CAASA,UAAU,oBAAoByP,gBAAgB,SAASpI,GAAG,IAAIP,SAAUA,GAC9E7G,EAAE,iBAEJ2N,EAAU9M,KAAI,gBAAGgN,EAAH,EAAGA,MAAOhF,EAAV,EAAUA,KAAV,OACb,kBAAC,IAAD,CAASrJ,IAAKqJ,EAAM9I,UAAU,oBAAoByP,gBAAgB,SAASpI,GAAE,WAAMyB,IAChF7I,EAAE6N,OAGP,0BAAM9N,UAAU,QACf+N,EAAWjN,KAAI,gBAAGgN,EAAH,EAAGA,MAAO9R,EAAV,EAAUA,OAAQgS,EAAlB,EAAkBA,OAAlB,OACd,uBAAGvO,IAAKzD,EAAQgE,UAAW0P,YAAK,oBAAqB1B,GAAU,UAAW/G,KAAI,kBAAajL,EAAb,MAC3EiE,EAAE6N,OAGP,0BAAM9N,UAAU,QACfiO,EAAUnN,KAAI,gBAAGgN,EAAH,EAAGA,MAAOI,EAAV,EAAUA,KAAV,OACb,4BACEzO,IAAKyO,EACLlO,UAAW0P,YAAK,oBAAqBxP,EAAKoN,WAAaY,GAAQ,UAC/DsB,QAAS,SAAChG,GACRA,EAAEmF,iBACFzO,EAAKyP,eAAezB,KAGrBJ,U,YCtGF,SAAS8B,IACtB,IAAMC,EAAMC,cACZ,OACE,kBAACC,EAAA,OAAD,KACE,0BAAM5I,IAAI,YAAYF,KAAI,kBAAanI,IAAKlB,iBAAlB,OAAoCiS,EAAIzB,a,4BCFlE4B,EAASC,YAAS,CACtBC,OAAQ,kBAAM,yCACdC,QAAS,kBAAM,kBAAC,IAAD,SAGF,SAASC,IAEtB,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,KACE,kBAACJ,EAAD,Q,YCAFD,EAASE,YAAS,CACtBC,OAAQ,kBAAM,6CACdC,QAAS,kBAAM,wCAEXE,EAAUJ,YAAS,CACvBC,OAAQ,kBAAM,+BACdC,QAAS,kBAAM,kBAAC,IAAD,SAEXG,EAAaL,YAAS,CAC1BC,OAAQ,kBAAM,qDACdC,QAAS,kBAAM,kBAAC,IAAD,SAEXI,EAAkBN,YAAS,CAC/BC,OAAQ,kBAAM,gCACdC,QAAS,kBAAM,kBAAC,IAAD,SAEXK,EAAeP,YAAS,CAC5BC,OAAQ,kBAAM,+BACdC,QAAS,kBAAM,kBAAC,IAAD,SAyCFM,MAtCf,WAAgB,IAAD,EACOtD,cAAZlN,EADK,EACLA,EAAGC,EADE,EACFA,KACX,OACE,yBAAKF,UAAW,QAAUE,EAAKoN,UAC7B,kBAAC,IAAD,KACE,kBAAC,EAAD,CAAQoD,aAAczQ,EAAEnB,IAAKnB,WAAYgT,cAAa,eAAU1Q,EAAEnB,IAAKnB,cACvE,kBAACiS,EAAD,MACA,kBAAC,IAAD,MACA,kBAACtB,EAAD,MACA,kBAACf,EAAD,KACE,kBAAC,IAAD,KACGzO,IAAKjB,cAAgB,kBAACqP,EAAD,MAAgB,qCACtC,kBAAC,EAAD,KACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOpE,KAAK,YACV,kBAAC,IAAD,CAAc8H,SAAS,YACvB,kBAACP,EAAD,OAEF,kBAAC,IAAD,CAAOvH,KAAK,eACV,kBAAC,IAAD,CAAc8H,SAAS,eACvB,kBAACN,EAAD,OAEF,kBAAC,IAAD,CAAOxH,KAAK,cACV,kBAAC,IAAD,CAAc8H,SAAS,oBACvB,kBAACL,EAAD,OAEDzR,IAAKpC,SAASI,aAAe,kBAAC,IAAD,CAAOgM,KAAK,kBAAiB,kBAAC0H,EAAD,OAA0B,KACrF,kBAAC,IAAD,CAAO1H,KAAK,KACV,kBAACsH,EAAD,cCxDZS,EAAc/Q,SAASgR,eAAe,QAC5CC,iBAAO,gBAAC,EAAD,MAASF,GRiBT,SAAkB9E,GACvB,GAA6C,kBAAmBC,UAAW,CAGzE,GADkB,IAAIgF,IAAIzG,GAAwBnO,OAAOC,SAAS4K,MACpDgK,SAAW7U,OAAOC,SAAS4U,OAIvC,OAGF7U,OAAO4S,iBAAiB,QAAQ,WAC9B,IAAMlD,EAAK,UAAMvB,GAAN,sBAEPmB,IAgEV,SAAiCI,EAAeC,GAE9CvD,MAAMsD,EAAO,CACXoF,QAAS,CAAE,iBAAkB,YAE5B/H,MAAK,SAAAgI,GAEJ,IAAMC,EAAcD,EAASD,QAAQG,IAAI,gBACjB,MAApBF,EAASG,QAAkC,MAAfF,IAA8D,IAAvCA,EAAY7M,QAAQ,cAEzEyH,UAAUC,cAAcsF,MAAMpI,MAAK,SAAAgD,GACjCA,EAAaqF,aAAarI,MAAK,WAC7B/M,OAAOC,SAASoV,eAKpB5F,EAAgBC,EAAOC,MAG1BxC,OAAM,WACLR,QAAQO,IAAI,oEAnFVoI,CAAwB5F,EAAOC,GAI/BC,UAAUC,cAAcsF,MAAMpI,MAAK,WACjCJ,QAAQO,IACN,iHAMJuC,EAAgBC,EAAOC,OQ3C/BE,CAAuB,CACrBS,SADqB,SACZP,GACP,IAAMwF,EAAuBxF,EAAayF,SAAW5F,UAAUC,cAAcQ,WAE7E,GAAIkF,EAAsB,CACxB,GAAmC,cAA/BA,EAAqBnF,MAEvB,YADApQ,OAAOC,SAASoV,SAGlBE,EAAqB3C,iBAAiB,eAAe,SAAA6C,GAE/CA,EAAM3K,QAA0C,cAA/B2K,EAAM3K,OAAesF,OACxCpQ,OAAOC,SAASoV,YAGpBE,EAAqBG,YAAY,CAAE5C,KAAM,sB,kPCLlC6C,EAAQ5S,OAAOuB,OAAO,CACjCsR,kBADiC,SACfC,GAChB,MAAmB,WAAfA,EAAM/C,KACD,CACLA,KAAM,SACNzJ,SAAUwM,EAAMxM,SAChByM,aAAc,GACdC,UAAW,KACXC,QAAS,KACTC,WAAY,GACZtQ,KAAM,MAGH,CACLmN,UAAMvL,EACN0O,WAAY,GACZH,aAAc,GACdI,KAAM,SAONC,EAA8B,CAAErD,UAAMvL,EAAW2O,KAAM,KAAMJ,aAAc,GAAIG,WAAY,IAC3FG,EAAeC,IAAMC,cAAsD,CAACH,EAAe,eACpFI,EAAW,kBAAMC,qBAAWJ,IAezC,SAASK,EAAYzP,EAAUC,GAC7B,OAAOyP,uBAAa1P,KAAO0P,uBAAazP,GAG1C,IAAM0P,EAA6BN,IAAMC,eAAe,eAC3CM,EAAyB,kBAAMJ,qBAAWG,IAEhD,SAASE,EAAT,GAA+E,IAAtD9N,EAAqD,EAArDA,SACxB+N,EAAUC,cADmE,EAEzDC,sBACxB,SAACC,EAAUC,GACT,OAAIT,EAAYQ,EAAUC,GACjBD,EAEFlU,OAAOuB,OAAO4S,UAEvB3P,GACA,kBAAMxE,OAAOuB,OAAO6R,MAV6D,mBAE5EN,EAF4E,KAErEsB,EAFqE,KAY7EC,EAAsBC,aAC1B,SAACC,GACC,IAAMJ,EAAQ,eACPrB,EAAM/C,OAASwE,EAASxE,KAAO+C,EAAQ,GADhC,GAlCpB,SAAyByB,QACD/P,IAAlB+P,EAASxE,MACPwE,EAASpB,OACXoB,EAASpB,KAAO5U,IAAMgW,EAASpB,MAAMqB,WAGzC,cAAkBxU,OAAOI,KAAKmU,GAA9B,eAAyC,CAApC,IAAMjU,EAAG,KACA,SAARA,QAA6DkE,IAA3C+P,EAASjU,WACtBiU,EAASjU,GAGpB,OAAOiU,EAyBGE,CAAgBF,IAElBb,EAAYZ,EAAOqB,IAGvBJ,EAAQW,QAAQf,uBAAaQ,MAE/B,CAACrB,EAAOiB,IAEJnS,EAAQ+S,mBAAQ,iBAAM,CAAC7B,EAAOuB,KAAgE,CAClGvB,EACAuB,IAEF,OACE,kBAAChB,EAAauB,SAAd,CAAuBhT,MAAOA,GAC5B,kBAACgS,EAA2BgB,SAA5B,CAAqChT,MAAOwS,GAAWpO,M,8dClF7D,IAIM6O,EAAUvB,IAAMwB,MACpB,YAAyG,IAI/D,EAJvCpN,EAAqG,EAArGA,KAAMqN,EAA+F,EAA/FA,gBACuB,oBAAnBA,IACTA,EAAiBA,EAAerN,IAEJ,kBAAnBqN,KACTA,GAA+B,QAAd,EAAAA,SAAA,eAAgB5P,aAAc,IAEjD,OACE,yBAAKtE,UAAU,kBACZ6G,EAAKjB,QAAQ9E,KAAI,SAACa,GAAD,OAChB,yBAAKlC,IAAKkC,EAAE+D,UAAW1F,UAAU,wBAC/B,kBAAC,IAAD,CAAQ6G,KAAMA,EAAMrB,OAAQ7D,EAAGmF,SAAUnF,EAAE+D,UAAUpB,aAAe4P,YAQ1EC,EAAiB,SAAC,GAAD,IAxBHxS,EAwBMyS,EAAH,EAAGA,SAAH,OAxBHzS,EAwBgDyS,GAxB7B1W,IAAM2W,KAAK1S,GAAG2E,OAAO,SAAW,MAyBjEgO,EAAqB,SAAC,GAAD,IAAGC,EAAH,EAAGA,QAAH,OACzBA,EAAQpE,QAAU,GAAKqE,cAAanP,aAAWkB,gBAAgBgO,GAAWlP,aAAWgB,oBAAoBkO,IACrGE,EAAiB,SAAC,GAAD,IAAGF,EAAH,EAAGA,QAASG,EAAZ,EAAYA,WAAZ,OACpBH,IAAWA,EAAQpE,SAAYuE,EAAWR,eAGzC,0BACElU,UAAU,mBACV2U,MAAO,CAAEC,MAAOvP,aAAWY,mBAAmBsO,EAASG,EAAWR,kBAEjE7O,aAAWU,mBAAmBwO,EAASG,EAAWR,gBAAgB1P,MAAM,EAAG,IAN9E,IASEqQ,EAAqB,SAAC,GAAD,IAAGT,EAAH,EAAGA,SAAH,OAAmCA,EAAWU,oBAAUpO,SAAS0N,IAAa,IAkBlG,SAASW,EACdC,GAEA,IAAMvV,EAAM0C,KAAK8S,SAAS3Q,WAY1B,OAXmB,WAAiB,IAAD,uBAAZ4Q,EAAY,yBAAZA,EAAY,gBACjC,IAAMC,EAAQ,WACZ,IAAMC,EAAMJ,EAAO,WAAP,EAAWE,GACvB,OAAIE,EACK3C,IAAM4C,aAAaD,EAAK,CAAE3V,QAE5B2V,GAGT,OADAD,EAAM1V,IAAMA,EAAMyV,EAAKI,KAAK,KACrBH,GAKJ,IAAMI,EAAkBR,GAC7B,kBACEjW,IAAK3B,MAAMC,cACT,kBAAC,IAAD,CACEoY,QAAQ,SACR1H,MAAO0G,cAAa,GAAK,kBAAC,IAAD,qBACzBiB,aAAcZ,EACda,MAAOlB,cAAa,GAAK,GACzBxU,UAAU,sBARa+U,GAalBY,EAAcZ,GAAW,SAACb,GAAD,OACpC,kBAAC,IAAD,CACEsB,QAAQ,SACR1H,MAAO0G,cAAa,GAAK,kBAAC,IAAD,qBACzBE,WAAY,CAAER,kBACduB,aAAchB,EACdiB,MAAOlB,cAAa,GAAK,QAIhBoB,EAAiBb,GAAW,SAACb,GAAD,OACvC,kBAAC,IAAD,CACEsB,QAAQ,UACR1H,MAAO,kBAAC,IAAD,qBACP2H,aAAc,gBAAGlB,EAAH,EAAGA,QAAH,OACZA,GAAWA,EAAQ3O,QACjB,kBAACoO,EAAD,CAASnN,KAAM0N,EAASL,eAAgBA,EAAgB5G,SAAUpN,IAAKoN,WACrE,MAENoI,MAAO,IACPG,SAAU,OAIDC,EAAmBf,GAAW,kBACzC,kBAAC,IAAD,CACES,QAAQ,YACR1H,MAAO,kBAAC,IAAD,qBACP2H,aAActB,EACduB,MAAOlB,cAAa,GAAK,GACzBxU,UAAU,aACV+V,gBAAgB,iBAPYhB,GAWnBiB,EAAiBjB,GAAW,kBACvC,kBAAC,IAAD,CACES,QAAQ,UACR1H,MAAO,kBAAC,IAAD,qBACP2H,aAActB,EACduB,MAAOlB,cAAa,GAAK,GACzBuB,gBAAgB,aAChB/V,UAAU,iBAPgB+U,GAWjBkB,EAAkBlB,GAAW,kBACxC,kBAAC,IAAD,CACES,QAAQ,YACR1H,MAAO,kBAAC,IAAD,qBACP2H,aAAcnB,EACdoB,MAAOlB,cAAa,GAAK,IACzBxU,UAAU,aACV+V,gBAAgB,iBAPWhB,GAWhB,SAASmB,EAAT,GAQX,IAPFC,EAOC,EAPDA,QAOC,IANDC,wBAMC,aALDC,4BAKC,SACOnW,EAASiN,cAATjN,KACF0J,EAAO0M,cACPC,EAAgBC,cACdC,EAAiEF,EAAjEE,YAAaC,EAAoDH,EAApDG,cAAeC,EAAqCJ,EAArCI,UAAWC,EAA0BL,EAA1BK,OAAQC,EAAkBN,EAAlBM,cACjDC,EAAYpI,uBAAY,gBAAG1N,EAAH,EAAGA,MAAH,OAAsB4I,EAAK1N,QAAQ8E,KAAQ,CAAC4I,IACpEmN,EAAkBrI,uBACtB,gBAAG1N,EAAH,EAAGA,MAAH,OAAuBA,GAAS,EAAI0O,YAAK,CAAES,SAAUvG,EAAKoN,aAAahW,GAAQiW,KAAsB,KAAP,EAARjW,KAAsB,KAC5G,CAAC4I,IAEGsN,EAAiBxI,uBAAY,kBAAO9E,EAAKuN,qBAAuB,KAAO,kBAAC,IAAD,QAAc,CAACvN,IAEtFwN,IADkBxN,EAAKuN,qBAE7BtI,qBAAU,WACRvD,gBACC,CAAC8L,IAEJ,IAAMC,EAAcvD,mBAAQ,kBAAMqC,EAAQrV,KAAI,SAACa,GAAD,OAAOA,OAAKkM,QAAO,SAAClM,GAAD,OAAOA,OAA7C,CAEzB6S,cAEAtU,EAAKoN,UAJoB,mBAMtB6I,EAAQrV,KAAI,SAACa,GAAD,OAAOA,EAAElC,KAAOkC,QAEjC,OAEE,yBAAK2V,IAAKT,EAAsB7W,UAAU,kBACxC,kBAAC,IAAD,CAAWuX,eAAa,IACrB,gBAAG7B,EAAH,EAAGA,MAAH,OACC,kBAAC,IAAD,CACE8B,YAAU,EACVxX,UAAW0P,YACT0G,GAAoB,qBACpBC,GAAwB,2BAE1BoB,SAAU7N,EAAK8N,WACfZ,UAAWA,EACXa,UArJNvb,OAAOwb,WAAW,sBAAsBC,QACnC,GAEJrD,cAGE,IAFE,IAkJCsD,aAAc,GACdpC,MAAOA,EACPkB,OAAQA,EACRH,YAAaA,EACbsB,SAAUrB,EACVC,UAAWA,EACXqB,aAAcjB,EACdG,eAAgBA,GAEfG,U,8DCnNEY,IANf,SACEC,GAEA,OAAOjI,IAAQ,aAAmBkI,MAAO,KAAQD,M,+BCNnD,wEAIY5a,EAFN2C,EAFN,MAEUC,EAAKkY,UAAU,KAAM,iBAUxB,SAAStD,EAAU9S,GACxB,OAAO/B,EAAE3C,EAAS0E,GAAM6R,QAAQ,UAAM,M,SAT5BvW,O,mCAAAA,I,uBAAAA,I,sBAAAA,I,mCAAAA,I,mCAAAA,I,gDAAAA,M,sCCJZ,oEAAO,IAAM+a,EAAe,uCACfC,EAAc,CAAC,eAAM,eAAM,eAAM,iB,gHCuB9C,SAASC,EAAqB9Z,EAA8B+Z,GAC1D,OAAO/Z,EAAIf,IAAMe,EAAG,cAAgB+Z,EAGtC,IAAMC,EAAgB,CACpBjT,OADoB,SACbkT,GACL,GAAIA,EAAO3W,KAAM,CACf,IAAMA,EAAO2E,SAASgS,EAAO3W,QACxBA,GAAQA,EAAO,GAAKA,EAAOjD,IAAKb,WAAWoE,gBACvCqW,EAAO3W,KAGlB,MAAO,CACLmN,KAAM,SACNzJ,SAAUiT,EAAOjV,GACjB0O,UAAWoG,EAAkBG,EAAOvG,UAAW,MAC/CC,QAASmG,EAAkBG,EAAOtG,QAAS,MAC3CF,aAAcwG,EAAO1W,MAAQ,GAC7BqQ,WAAYqG,EAAOC,OAASD,EAAOC,OAAOnU,MAAM,GAAK,GACrDzC,KAAM2E,SAASgS,EAAO3W,MAAQ,KAAO,OAGzC6W,QAlBoB,SAkBZF,GACN,IAAMpG,EAAOiG,EAAkBG,EAAOpG,KAAM,MAC5C,OAAIA,IAASA,EAAKuG,UACT,IAEF,CACL3J,UAAMvL,EACN2O,KAAMA,EAAOA,EAAKwG,QAAQ,OAAOnF,UAAY,KAC7CzB,aAAcwG,EAAO1W,MAAQ,GAC7BqQ,WAAYqG,EAAOC,QAAU,MAM5B,SAASI,EAAT,GAAyG,IAApFC,EAAmF,EAAnFA,KAC1BnK,qBAAU,WAGR,OAFAvD,cACA2N,cACOA,MACN,IACH,IAAMC,EAAsBlG,cACtB0F,EAASS,cACT9c,EAAWyT,cACXsJ,EAAQ,IAAIC,gBAAgBhd,EAASsc,QAC3CxZ,OAAOma,OAAOZ,EAAQ,CACpB3W,KAAMqX,EAAM/H,IAAI,UAGlB,IAAMkI,EAAcd,EAAcO,GAAMN,GACxC,MAA2B,kBAAhBa,EACF,kBAAC,IAAD,CAAUlS,GAAIkS,KAEvBL,EAAoBK,GACb,sC,oBCvEHC,EAAe9b,MAAQob,QAAQ,OAE9B,SAASW,IAAe,IAAD,EACC9G,cADD,mBACrBV,EADqB,KACdyH,EADc,KAEtBC,EAA4BjL,uBAChC,SAAClF,GAAD,OAA4CkQ,EAAY,CAAErH,WAAY7I,EAAEoQ,cAAc7Y,UACtF,CAAC2Y,IAEGG,EAAUnL,uBAAY,SAAC1M,GAAD,OAAkB0X,EAAY,CAAExH,aAAclQ,MAAS,CAAC0X,IAC9EI,EAAUpL,uBAAY,SAAC4D,GAAD,OAA4BoH,EAAY,CAAEpH,WAAS,CAACoH,IAChF,YAAmB/V,IAAfsO,EAAM/C,KACD,KAGP,oCACE,kBAAC,IAAD,CAASjK,MAAM,gBACb,kBAAC,IAAD,CAAY8U,IAAKjb,IAAKrB,QAAS6U,KAAML,EAAMK,MAAQkH,EAAcQ,SAAUF,EAAS9Z,UAAU,kBAEhG,kBAAC,IAAD,CAASiF,MAAM,4BACb,2BAAOiK,KAAK,OAAOlP,UAAU,eAAee,MAAOkR,EAAMI,WAAY2H,SAAUL,KAEhF7a,IAAKzB,eAAegF,OAAS,GAC5B,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAcL,KAAMiQ,EAAMC,aAAc8H,SAAUH,M,kDCrBtDI,EAAoB,GACpBC,EAAoB,EACpBC,EAAY,GAEZC,EAAgB,SAAC3b,GAAD,OAAeA,EAAE4b,cAAcC,QAmBrD,SAASC,EAAT,GAAqE,IAAvClI,EAAsC,EAAtCA,WACpBpS,EAAMkN,cAANlN,EAD0D,EAEpCuN,mBAAS,GAF2B,mBAE3DgN,EAF2D,KAElDC,EAFkD,OAGxB3G,mBAAQ,WAChD,IAAM4G,EArBV,SAAgCC,GAC9B,IAAMC,EAAmBR,EAAcO,GAEvC,IADAA,EAASC,EACFD,GAAQ,CACb,IAAM/U,EAAUqU,EAAkBU,GAClC,GAAK/U,KAAWA,aAAmB0C,SAInC,MAAO,CACLuS,aAAcF,IAAWC,EACzBhZ,OAAQgE,GALR+U,EAASA,EAAOnW,MAAM,EAAGmW,EAAOtY,OAAS,GAQ7C,OAAO,KAOgByY,CAAuBzI,GAC5C,IAAKqI,EACH,MAAO,CAAC,IAAI,GAEd,GAAIA,EAAaG,aACf,MAAO,CAACH,EAAa9Y,QAAQ,GAE/B,IAAMgZ,EAAmBR,EAAc/H,GACnC0I,EAAcL,EAAa9Y,OAAOS,QAAU8X,EAC1Ca,EAAkB,GASxB,OARAN,EAAa9Y,OAAOpC,SAAQ,SAACgG,GACvB4U,EAAc5U,EAAOuB,UAAUsH,WAAWuM,GAC5CI,EAAgBC,KAAKzV,GACZwV,EAAgB3Y,SAEzB0Y,GAAc,MAGX,CAACC,EAAiBD,GAAeC,EAAgB3Y,OAAS6X,EAAmBa,KAEnF,CAAC1I,EAAYmI,IAxBkD,mBAG3D5U,EAH2D,KAGlDsV,EAHkD,KAGvCH,EAHuC,KAyDlE,OAhCAlM,qBAAU,WACR,IAAM8L,EAASP,EAAc/H,GAC7B,IAAI4H,EAAkBU,IAGjBO,EAAL,CAGA,IAAIC,GAAY,EACZC,EAA4CzS,YAAW,WACzDyS,OAAgBzX,EACZwX,GAGAlB,EAAkBU,KAGtBV,EAAkBU,GAAUU,YAAaV,GAAQxR,MAAK,SAAUvD,GAK9D,OAJAqU,EAAkBU,GAAU/U,EACvBuV,GACHV,GAAW,IAAIa,MAAOC,WAEjB3V,QAER,KACH,OAAO,WACLuV,GAAY,EACRC,GACFI,aAAaJ,OAGhB,CAAC/I,EAAY6I,IAEd,oCACE,wBAAIlb,UAAU,oBAAoBC,EAAE,yCACpC,wBAAID,UAAU,sBACX4F,EAAQpB,MAAM,EAAG0V,GAAmBpZ,KAAI,SAACa,GAAD,OACvC,wBAAIlC,IAAKkC,EAAE8B,IACT,kBAAC,IAAD,CAAM4D,GAAIC,EAAuB3F,EAAE8B,KACjC,kCACI2D,sBAAYzF,EAAEM,MAAMwB,IADxB,KAC+B9B,EAAEoF,gBAMvCmU,GAAa,kBAAC,IAAD,CAAS1P,KAAK,YACzB5F,EAAQvD,OAAS6X,GAAqBa,IACtC,2BAAO/a,UAAU,kCAAkCC,EAAE,0FAMxD,SAASwb,EAAT,GAAwD,IAAD,IAA/Bzb,iBAA+B,MAAnB,gBAAmB,IAC5C2S,cAATV,EADqD,oBAE5D,MAAI,aAAcA,IAAUA,EAAMI,WACzB,qCAGP,yBAAKrS,UAAWA,GACd,kBAACua,EAAD,CAAoBlI,WAAYJ,EAAMI,c,wHCnG5C,IAAMqJ,EAAgBzL,YAAS,CAC7BC,OAAQ,kBAAM,+BACdC,QAAS,kBAAM,kBAAC,IAAD,SAGXwL,EACJ,gHACIC,EAAO,uDAEN,SAAS9I,EAAab,GAC3B,GAAmB,WAAfA,EAAM/C,KAAmB,CAC3B,IAAItN,EAASia,YAAQF,EAAa,CAChClY,GAAIwO,EAAMxM,SACV0M,UAAWF,EAAME,UAAYzU,IAAMuU,EAAME,WAAW7L,OAAO,mBAAgB3C,EAC3EyO,QAASH,EAAMG,QAAU1U,IAAMuU,EAAMG,SAAS9L,OAAO,mBAAgB3C,EACrE3B,KAAMiQ,EAAMC,mBAAgBvO,EAC5BgV,OAAQ1G,EAAMI,WAAa,IAAMJ,EAAMI,gBAAa1O,IAKtD,OAHIsO,EAAMlQ,OACRH,GAAM,gBAAaqQ,EAAMlQ,OAEpBH,EAET,OAAKqQ,EAAMC,cAAiBD,EAAMI,YAAeJ,EAAMK,KAGhDuJ,YAAQD,EAAM,CACnBtJ,KAAM5U,IAAMuU,EAAMK,MAAQ,IAAIgJ,MAAQhV,OAAO,cAC7CtE,KAAMiQ,EAAMC,mBAAgBvO,EAC5BgV,OAAQ1G,EAAMI,iBAAc1O,IALrB,IAQJ,SAAS2D,EAAuB7B,GACrC,OAAOqN,EAAa,CAClB5D,KAAM,SACNzJ,SAAUA,EAASnB,WACnB6N,UAAW,KACXC,QAAS,KACTF,aAAc,GACdG,WAAY,GACZtQ,KAAM,OAIV,SAAS+Z,IAA6B,IAAD,EACnBnJ,cAATV,EAD4B,oBAEnC,MAAM,aAAcA,EAIlB,kBAAC,IAAD,CACEmE,kBAAgB,EAChBD,QAAS,CAACZ,IAAiBI,YAAY1D,EAAMxM,UAAWmQ,YAAe3D,EAAMxM,UAAWwQ,OALnF,KAkCIjG,UAxBf,WACE,OACE,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOlH,KAAM6S,GACX,kBAAC5C,EAAD,CAAWC,KAAK,WAChB,kBAAC,IAAD,CAAcpI,SAAS,WACvB,kBAAC8K,EAAD,MACA,kBAACI,EAAD,OAEF,kBAAC,IAAD,CAAOC,OAAK,EAACjT,KAAM,CAAC,IAAK8S,IACvB,kBAAC7C,EAAD,CAAWC,KAAK,YAChB,kBAAC,IAAD,CAAcpI,SAAS,YACvB,yBAAK5Q,UAAU,eACb,kBAACyZ,EAAD,MACA,kBAACgC,EAAD,OAEF,kBAAC,IAAD,CAAiBtF,QAAS,CAACZ,IAAiBK,YAAe,IAAKE,IAAkBE,QAEpF,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAU3O,GAAG,U,gCCjGrB,wHAKI2U,EAAkB,OAUf,SAASC,EAAT,GAA2D,IAAnCrL,EAAkC,EAAlCA,SAQ7B,OAPAsL,2BAAgB,WACd,IAAMC,EAAcH,EAEpB,OADAA,EAAkBpL,EACX,WACLoL,EAAkBG,KAEnB,CAACvL,IACG,KAGT,SAASwL,IACP,IAAMvM,EAAMC,cAoBZ,OAnBAjB,qBAAU,WACR,IAAIsM,GAAY,EAchB,OAbA/e,OAAOigB,uBAAsB,WAC3B,IAAIlB,EAAJ,CAGA,IACMlW,GADS8K,IAAOuM,OACArX,OAASnF,SAASmF,OAAOX,WAC/ClI,OAAOmgB,GAAG,OAAQ,CAChBC,QAAS,WACTC,KAAM5M,EAAIzB,SACVnJ,MAAM,GAAD,OAAK+W,EAAL,YAAwB/W,GAC7ByX,cAAeV,QAGZ,WACLb,GAAY,KAEb,CAACtL,EAAIzB,WACD,KAGM,SAASuO,IAItB,OAAIvgB,OAAOC,SAASugB,OAAS9d,IAAKlB,gBACzB,KAEJxB,OAAOygB,UAGZzgB,OAAOygB,WACA,kBAACT,EAAD,OAHE,O,2DCnCJ,SAASU,IASb,IARDC,EAQA,uDARgD,CAC9C7N,KAAM,WACN8N,MAAO,GACPC,SAAU,UACVC,iBAAkB,KAElBlD,SAAU,cAGJ/Z,EAAMkN,cAANlN,EACAiP,EAA0B6N,EAA1B7N,KAAM8N,EAAoBD,EAApBC,MAAOC,EAAaF,EAAbE,SAFrB,EAGoC,WAClC,GAAmB,aAAfF,EAAM7N,KAAqB,CAAC,IACtBgO,EAA+BH,EAA/BG,iBAAkBlD,EAAa+C,EAAb/C,SAC1B,MAAO,CACLmD,YADK,SACO1d,EAAa2d,GACvB,KAAIA,GAAgBF,IAAoBA,EAAiBG,IAAI5d,MAGxD2d,IAAcF,GAAqBA,EAAiBG,IAAI5d,IAA7D,CAGA,IAAM6d,EAAS,IAAIC,IAAIL,GAAoBF,EAAMlc,KAAI,SAAAa,GAAC,OAAIA,EAAElC,QACxD2d,EACFE,EAAOE,IAAI/d,GAEX6d,EAAOG,OAAOhe,GAEhBua,EAASsD,KAEXI,UAAW,SAACje,GAAD,OAAkByd,GAAoBA,EAAiBG,IAAI5d,KAElE,IACEke,EAA8BZ,EAA9BY,gBAAiB3D,EAAa+C,EAAb/C,SACzB,MAAO,CACLmD,YADK,SACO1d,EAAa2d,GAClBA,GAGLpD,EAASva,IAEXie,UAAW,SAACje,GAAD,OAAiBke,IAAoBle,IA9BlB,GAA5B0d,EAHR,EAGQA,YAAaO,EAHrB,EAGqBA,UAkCrB,OACE,kBAAC,IAAME,SAAP,KACGZ,EAAMlc,KAAI,SAAA+c,GAAI,OACb,yBAAK7d,UAAU,+BAA+BP,IAAKoe,EAAKpe,KACtD,2BACEO,UAAU,mBACVkP,KAAMA,EACNzL,GAAE,aAAQwZ,EAAR,YAAoBY,EAAKpe,KAC3Bqe,KAAI,aAAQb,EAAR,YAAoBY,EAAKpe,KAC7BsB,MAAO8c,EAAKpe,IACZse,QAASL,EAAUG,EAAKpe,KACxBua,SAAU,SAAAnI,GAAK,OAAIsL,EAAYU,EAAKpe,IAAKoS,EAAM+H,cAAcmE,YAE/D,2BAAO/d,UAAU,mBAAmBge,QAAO,aAAQf,EAAR,YAAoBY,EAAKpe,MACjEQ,EAAE4d,EAAK/P,a,oBC9Eb,SAASmQ,EAAT,GAMH,IAAD,IALD3L,YAKC,MALM5U,MAKN,MAJDsc,gBAIC,MAJW,aAIX,MAHDha,iBAGC,MAHW,GAGX,MAFD+Z,WAEC,MAFK,EAEL,MADDmE,WACC,MADKxgB,MACL,EACKygB,EAAezP,uBACnB,SAAClF,GAAD,OAA4CwQ,EAAStc,IAAM8L,EAAEoQ,cAAc7Y,MAAO,iBAClF,CAACiZ,IAEH,OACE,2BACEha,UAAWA,EACXkP,KAAK,OACLnO,MAAOrD,IAAM4U,GAAMhM,OAAO,cAC1ByT,IAAKA,EAAMrc,IAAMqc,GAAKzT,OAAO,mBAAgB3C,EAC7Cua,IAAKA,EAAMxgB,IAAMwgB,GAAK5X,OAAO,mBAAgB3C,EAC7CqW,SAAUmE,I,aCvBhB,yG,mNCIMle,EAAIC,IAAKD,EAAEE,KAAKD,KAEhBke,EAAmB,CAAC,GAAI,GAAI,IAAK,IAAK,IAAK,IAAM,KAAM,KAAM,IAAM,KAAM,KAAM,KAAM,IAAM,IAAM,KACjGC,EAAgB,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAClFC,EAAkB,CAAC,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAEpFC,EAAqD,CACzDC,IAAK,GACLC,IAAK,GACLC,IAAK,CAACphB,IAASa,QACfwgB,IAAK,CAACrhB,IAASa,OAAGb,IAASE,QAC3BohB,IAAK,CAACthB,IAASE,OAAGF,IAASC,cAC3BshB,IAAK,CAACvhB,IAASC,cACfuhB,IAAK,GACLC,IAAK,GACLC,IAAK,CAAC1hB,IAASiB,cACf0gB,IAAK,CAAC3hB,IAASiB,aAAIjB,IAASgB,cAC5B4gB,IAAK,CAAC5hB,IAASgB,aAAIhB,IAASe,oBAC5B8gB,IAAK,CAAC7hB,IAASe,qBAGV,SAASqG,IACd,IAAM0a,EAAUnf,EAAEoY,KAClB,OAAI+G,EAAQC,WAAW,GAAK,IACnBD,EAAQE,MAAM,IAEhB1f,MAAMwf,EAAQ/c,OAAS,GAC3Bkd,KAAK,IACLze,KAAI,SAAC2H,EAAGzH,GAAJ,OAAcoe,EAAQ5a,MAAc,EAARxD,EAAmB,EAARA,EAAY,MAGrD,IAAMwC,EAAb,WAIE,WAAYgc,GAAkB,yBAH9BC,gBAG6B,OAF7BC,gBAE6B,OAD7BC,kBAC6B,EAC3B,IAAMC,EAASJ,EAAU,IACzB5a,KAAK6a,WAAatd,KAAK0d,MAAMD,EAAS,KACtChb,KAAK8a,WAAaE,EAAS,IAC3Bhb,KAAK+a,aAAexd,KAAK0d,MAAML,EAAU,KAR7C,4DAUkBM,GACd,OAAOlb,KAAK6a,aAAeK,EAAML,aAXrC,6BAaSK,GACL,OAAOlb,KAAK6a,aAAeK,EAAML,YAAc7a,KAAK8a,aAAeI,EAAMJ,aAd7E,oCAgBgB1d,GACZ,OAAOuc,EAAwC,IAApB3Z,KAAK+a,aAAqB/a,KAAK6a,YAAYM,SAAS/d,KAjBnF,+BAoBI,IAAM8L,EAAQpJ,IAAyBE,KAAK6a,WAAa,GACzD,OAAI7a,KAAK6a,aAAepH,IAAahW,OAC5ByL,EAEFA,EAAQlJ,KAAK8a,aAxBxB,oCA2BI,OAAOtB,EAAyC,GAAvBxZ,KAAK6a,WAAa,GAAS7a,KAAK8a,WAAa,KA3B1E,wCA8BI,OAA8B,IAAtB9a,KAAK+a,aAAqBrB,EAAkBD,GAAuC,GAAvBzZ,KAAK6a,WAAa,GAAS7a,KAAK8a,WAAa,KA9BrH,yCAiCI,OAAwB,IAApB9a,KAAK6a,WACA,EAEL7a,KAAK6a,aAAepH,IAAahW,OAC5B,IAEFuC,KAAKX,cAAgB,IAvChC,qCA0CI,GAAIW,KAAK6a,aAAepH,IAAahW,OACnC,OAAOuC,KAET,IAAIob,EAAYpb,KAAK6a,WACjBQ,EAAYrb,KAAK8a,WAAa,EAKlC,OAJIO,EAAY,IACdD,IACAC,EAAY,GAEP,IAAIzc,EAA0B,IAApBoB,KAAK+a,aAAmC,IAAZK,EAAkBC,KAnDnE,yCAsDI,GAAwB,IAApBrb,KAAK6a,YAAwC,IAApB7a,KAAK8a,WAChC,OAAO9a,KAET,IAAIob,EAAYpb,KAAK6a,WACjBQ,EAAYrb,KAAK8a,WAAa,EAKlC,OAJIO,EAAY,IACdD,IACAC,EAAY,GAEP,IAAIzc,EAA0B,IAApBoB,KAAK+a,aAAmC,IAAZK,EAAkBC,KA/DnE,uCAiEmBne,GACf,IAAIoe,EAAYtb,KAAKX,cAEjBhC,EAAe2C,KAcnB,OAbIsb,GAAape,GAASoe,GAExBA,GADAje,EAAQ2C,KAAKb,gBACKE,cAClBnC,EAAQG,EAAMke,oBACLre,EAAQ,KACZoe,GAAkC,IAArBje,EAAMwd,YAA0C,IAArBxd,EAAMwd,YAAyC,IAArBxd,EAAMyd,WAC3E5d,EAAQ,GAGRoe,GADAje,EAAQ2C,KAAKT,oBACKF,cAClBnC,EAAQG,EAAMke,qBAGXle,IAlFX,iDAoF6BH,GACzB,IAAMG,EAAQ2C,KAAK9B,iBAAiBhB,GACpC,MAAM,GAAN,OAAUG,EAAM4B,SAAhB,cAA8Be,KAAKwb,oBAAoBte,MAtF3D,0CAwFsBA,GAClB,IAAMG,EAAQ2C,KAAK9B,iBAAiBhB,GACpC,MAAM,GAAN,OAAUG,IAAU2C,KAAOzC,KAAK+b,IAAIpc,EAAO,GAAKG,EAAMke,oBAAtD,OACEle,EAAMgC,cAAgB,IAAMhC,EAAMgC,cAAgB,QA3FxD,KA+FO,SAASmD,EAAYoY,GAC1B,OAAO,IAAIhc,EAAMgc,GAAS3b,SAOrB,IAAMhB,EAAiB1D,OAAOuB,OAAO,CAC1C4F,OAD0C,SACnCrH,GACL,OAAO,IAAIuE,EAAMvE,EAAIwE,IAAI4c,2BAA2BphB,EAAI6C,MAAQ7C,EAAIqhB,QAEtEF,oBAJ0C,SAItBnhB,GAClB,OAAO,IAAIuE,EAAMvE,EAAIwE,IAAI2c,oBAAoBnhB,EAAI6C,MAAQ7C,EAAIqhB,QAE/Dzc,OAP0C,SAOnC5E,GACL,OAAO4D,EAAeC,iBAAiB7D,GAAK4E,UAE9Cf,iBAV0C,SAUzB7D,GACf,OAAO,IAAIuE,EAAMvE,EAAIwE,IAAIX,iBAAiB7D,EAAI6C,MAAQ7C,EAAIqhB,W,6YCnJvD,SAAShV,IACd+Q,uBAAsB,kBAAMjgB,OAAOmkB,cAAc,IAAIC,QAAQ,cAC7D7X,YAAW,WACTvM,OAAOmkB,cAAc,IAAIC,QAAQ,aAChC,KAEE,SAASvH,IACd7c,OAAOqkB,SAAS,EAAG,GACnBpE,uBAAsB,kBAAMjgB,OAAOqkB,SAAS,EAAG,MAG1C,IAAMC,EAAgB,SAAC/e,GAC5B,OAAKA,EAGDA,EAAI,KACC,SAEH,GAAN,QAAe,IAAJA,GAASmC,QAAQ,GAA5B,KALS,IAQE6c,EAAe,SAAChf,GAAD,OAAeA,EAAEmC,QAAQ,IACxC8c,EAAiB,SAACjf,GAAD,OAAeA,EAAE2C,YAExC,SAASmP,EAAsCoN,EAA0BC,GAC9E,IAAMxJ,EAAMyJ,kBAA6B,WACvC,MAAM,IAAInY,MAAM,oDAQlB,OALAiG,qBAAU,WACRyI,EAAI0J,QAAUH,IADP,CAGLA,GAHK,mBAGEC,KAEJpS,uBACL,WAAa,IACX,IAAMmS,EAAKvJ,EAAI0J,QADJ,mBAAT9L,EAAS,yBAATA,EAAS,gBAEX,OAAO2L,EAAE,WAAF,cAAO3L,MAEhB,CAACoC,IAKL,IAAM2J,EAAe,CAAEC,YAAa,OAG9BC,EAAkB,GAEjB,SAASC,EAAYC,EAA8BC,GACpDA,GAAYH,EAAgBG,KAC9BD,EAAeF,EAAgBG,IAFyD,MAI9C9T,mBAC1C6T,aAAwB/Y,QAAU2Y,EAAeI,GALuC,mBAInFE,EAJmF,KAInEC,EAJmE,KA2B1F,GApBA3S,qBAAU,WACR,IAAIsM,GAAY,EAehB,OAdIkG,aAAwB/Y,SAC1BkZ,EAAkBP,GAClBI,EAAalY,MAAK,SAACvH,GACbuZ,IAGAmG,IACFH,EAAgBG,GAAY1f,GAE9B4f,EAAkB5f,QAGpB4f,EAAkBH,GAEb,WACLlG,GAAY,KAEb,CAACkG,EAAcC,IACdC,IAAmBN,EACrB,OAAOM,EAIJ,SAASE,EACdC,EACAC,EACAL,GAGA,OAAOF,EADStN,kBAAQ4N,EAASC,GACRL,EAAQ,UAAMA,EAAN,YAAkBK,EAAKrM,KAAK,WAAS3R,GAGjE,SAAS9C,EAAI+gB,GAClB,OAAOA,EAAQviB,QAAO,SAAC+D,EAAGC,GAAJ,OAAUD,EAAIC,IAAG,GAGlC,SAASmR,IACd,QAASpY,OAAOwb,WAAW,yBAAyBC,U,wOCpFhDgK,EAAqB,CAAE1R,SAAS,GA6BzB2R,EAAqB,I,mGAhB9B,OAAO,I,2CAGP,OAAO,I,oCAGP,OAAO,O,gCAGP,OAAOD,I,qCAGP,OAAO,M,MAOLE,EAAO,aAEPC,E,WAKJ,WAAYC,GAA8C,IAAtBC,EAAqB,uDAANH,EAAM,yBAJzDI,eAIyD,OAHzDC,mBAGyD,OAFzDC,uBAEyD,EACvDzd,KAAKud,UAAYF,EACjBrd,KAAKwd,cAAgBF,EACrBtd,KAAKyd,mBAAoB,E,yDAEXC,GAAsB,IAAD,OAC/B1d,KAAKyd,oBAGTzd,KAAKyd,mBAAoB,EACzBC,EAAQnZ,MAAK,kBAAM,EAAKoZ,WAAU,MAAQhZ,OAAM,kBAAM,EAAKgZ,WAAU,S,gCAE7DC,GACR5d,KAAKwd,cAAcI,K,iCAGnB,IAAMC,EAAa7d,KAAKud,UAAUO,oBAClC,OAAID,aAAsBna,SACxB1D,KAAK+d,aAAaF,GACX,GAEFA,I,2CAGP,OAAO7d,KAAKud,UAAUS,0BAA4B,I,oCAGlD,OAAOhe,KAAKud,UAAUU,oB,8BAEhB7hB,GACN,OAAIA,GAAS4D,KAAK8S,WACTmK,EAELjd,KAAKud,UAAUnL,aAAahW,GACvB4D,KAAKud,UAAUjmB,QAAQ8E,IAE3B4D,KAAKyd,mBACRzd,KAAK+d,aAAa/d,KAAKud,UAAUjmB,QAAQ8E,IAEpC6gB,K,mCAEI7gB,GACX,QAAIA,EAAQ,IAGL4D,KAAKud,UAAUnL,aAAahW,K,oCAEvB8hB,GACZle,KAAKwd,cAAgBU,I,yCAGrBle,KAAKwd,cAAgBL,M,KAInBgB,EAAqBtQ,IAAMC,cAAcoP,GAElCxL,EAAiB,kBAAM1D,qBAAWmQ,IACZA,EAAmBC,SAoDtD,SAASC,EAAqBC,EAA4BC,EAAqBxB,GAA6B,IAAD,EACnEnU,oBAAS,kBAAMsU,KADoD,mBAClGsB,EADkG,KACrFC,EADqF,KAEnGC,EAAqB5U,uBACzB,SAAC8T,GACC,GAAIA,EACFW,QADF,CAIA,IAAMI,EAAU,IAAIvB,EAAYkB,GAChCG,EAAeE,MAPmB,CAUnCL,EAAcC,GAVqB,mBAUTxB,KAkB7B,OAhBA9S,oBAAUyU,EAAoB,CAACA,IAC/BzU,qBAAU,WACR,IAAM0U,EAAUH,EAChB,GAAIG,aAAmBvB,EACrB,OAAO,kBAAMuB,EAAQC,sBAEtB,CAACJ,IACJvU,qBAAU,WACQuU,aACOpB,GADPoB,EAENK,cAAcH,KAEvB,CAACF,EAAaE,IACjBzU,qBAAU,WACRqU,EAAaR,sBACZ,CAACQ,IACG,CACLE,eAIG,SAASM,EAAT,GAAqF,IAAtDve,EAAqD,EAArDA,SAAqD,EAC5DwN,cAD4D,mBAClFV,EADkF,KAC3EyH,EAD2E,OAEjElM,oBAAS,iBAAO,MAAjCmW,EAFkF,oBAGnFC,EAlER,SAAsB3R,GACpB,IAAI4R,EACAC,EACEzR,GAAcJ,EAAMI,YAAc,IAAIiI,OAAOD,eAAiB,GAC9D0J,EAAgB1R,GAAcJ,EAAMC,aAqB1C,OApBA2R,EAAW,kBACTE,EACI,SAACld,GACC,QAAIoL,EAAMC,cAAgBD,EAAMC,eAAiBrL,EAAKmd,OAAO1f,gBAGxDuC,EAAKjB,QAAQuI,MAAK,SAAC3I,GAAD,OAAYA,EAAOuB,SAASsT,cAAc9V,QAAQ8N,IAAe,QAItF,SAAUJ,GACVA,EAAMlQ,MACNsD,aAAWC,qBAAqBuB,EAAMoL,EAAMxM,YAAcwM,EAAMlQ,KAAO,KAM3E,MACN+hB,EAAW,MAAiBngB,IAAfsO,EAAM/C,MAAsB+C,EAAMC,cAAiB,KAAMG,EAAY,SAAUJ,GAASA,EAAMlQ,MACpG+R,kBAAQ+P,EAAUC,GAyCDG,CAAahS,GAC/BiR,EAAepP,mBAAQ,WAC3B,IAAMrU,EA1FV,SAAwBwS,GACtB,QAAmBtO,IAAfsO,EAAM/C,KACR,OAAOxR,IAAMuU,EAAMK,MAAQ5U,OACxBob,QAAQ,OACRnF,UACArP,WACE,GAAmB,WAAf2N,EAAM/C,KACf,OAAO4D,uBAAab,GAEtB,MAAM,IAAIrJ,MAAM,sBAiFFsb,CAAejS,GAI3B,OAHK0R,EAAclkB,KACjBkkB,EAAclkB,GAhFpB,SAAwBwS,GACtB,QAAmBtO,IAAfsO,EAAM/C,KACR,OAAOiV,IAAaC,cAAcnS,EAAMK,MAAQ5U,MAAQob,QAAQ,QAElE,GAAmB,WAAf7G,EAAM/C,KACR,OAAOiV,IAAaE,aAAapS,EAAMxM,SAAUwM,EAAME,UAAWF,EAAMG,QAASH,EAAMC,cAEzF,MAAM,IAAItJ,MAAM,mBAyES0b,CAAerS,IAE/B0R,EAAclkB,KACpB,CAACwS,EAAO0R,IACX9U,qBAAU,kBAAMqU,EAAaqB,mBAAmBX,KAAkB,CAACV,EAAcU,IACjF,IAAMT,EAAUzU,uBAAY,kBAAMgL,EAAY3H,IAAMC,kBAAkBC,MAAS,CAACA,EAAOyH,IAC/E0J,EAAgBH,EAAqBC,EAAcC,EAAS,CAAClR,EAAO2R,IAApER,YACR,OAAO,kBAACL,EAAmBhP,SAApB,CAA6BhT,MAAOqiB,GAAcje,GAGpD,SAASqf,EAAT,GAMH,IALFvC,EAKC,EALDA,SACA9c,EAIC,EAJDA,SAKQie,EAAgBH,EAAqBhB,EAAUF,EAAM,IAArDqB,YACR,OAAO,kBAACL,EAAmBhP,SAApB,CAA6BhT,MAAOqiB,GAAcje,K,+BC9N3D,+yB,oGCKO,SAASsf,EAAT,GAOH,IAAD,IANDzkB,iBAMC,MANW,GAMX,MALDkP,YAKC,MALM,OAKN,MAJD9B,iBAIC,MAJWqF,IAAMmL,SAIjB,MAHDvQ,iBAGC,MAHW,GAGX,MAFDM,gBAEC,aADDxI,gBACC,WADUxB,EACV,EACK+gB,EAAQ,qBAAiBrX,GAD9B,EAE2BG,oBAAS,kBAAMH,KAAelR,aAAaD,QAAQwoB,MAF9E,mBAEMC,EAFN,KAEcC,EAFd,KAQD,GALA/V,qBAAU,WACJxB,GAAasX,GACfxoB,aAAakN,QAAQqb,EAAU,UAEhC,CAACC,EAAQtX,EAAWqX,IACnBC,GAAUhX,EACZ,OAAO,KAET,IAAMkX,EAAOzX,EACb,OACE,kBAACyX,EAAD,KACE,yBAAK7kB,UAAS,sBAAiBkP,EAAjB,wCAAqDlP,GAAayL,KAAK,SAClFtG,EACAwI,GACC,4BACEuB,KAAK,SACLlP,UAAU,QACV8kB,eAAa,QACbvV,aAAW,QACXC,QAAS,SAAAqC,GACPA,EAAMlD,iBACNiW,GAAU,GACVtZ,gBAGF,0BAAMyZ,cAAY,QAAlB,a,gCCxCZ,sDAGM9kB,EAAIC,IAAKD,EAAEE,KAAKD,KAEf,SAAS8F,EAAoBhF,GAClC,OAAOf,EAAEqY,IAAYtX,M,gCCNvB,+DAKMgkB,EAAkBvS,IAAMC,cAAwC,IAEzD8D,EAAmB,kBAAM5D,qBAAWoS,IASlCC,IAPf,YAA0E,IAAtD9f,EAAqD,EAArDA,SAClB,OACE,kBAAC,IAAD,MACG,SAAAoR,GAAa,OAAI,kBAACyO,EAAgBjR,SAAjB,CAA0BhT,MAAOwV,GAAgBpR,Q,0MCA5D+f,EAAb,WAEE,aAA6B,IAAjBC,EAAgB,uDAAL,IAAK,yBAD5BC,WAC4B,EAC1BxgB,KAAKwgB,MAAQ3b,YAAM,uCAAwD0b,IACxEhc,MAAK,SAACS,GACL,OAAIA,EAAKyb,OAAM,SAAC1jB,GAAD,OAAOA,EAAEgF,QACfiD,EAEFH,YAAM,sBAAuCG,EAAK9I,KAAI,SAACa,GAAD,OAAOA,EAAE2jB,OAAKhQ,KAAK,OAAQnM,MAAK,SAACoc,GAC5F,IAAMC,EAAY,GAElB,OADAD,EAAQ/lB,SAAQ,SAACmC,GAAD,OAAQ6jB,EAAU7jB,EAAE2jB,KAAO,IAAM3jB,KAC1CiI,EAAK9I,KAAI,SAACa,GAAD,sBAAaA,EAAb,GAAmB6jB,EAAU7jB,EAAE2jB,KAAO,cAGzDnc,MAAK,SAACS,GAAD,OAAUA,EAAK/D,MAAK,SAACzC,EAAGC,GAAJ,OAAUD,EAAEgD,UAAY/C,EAAE+C,gBAd1D,qJAiBWxB,KAAKwgB,MAAMjc,MAAK,SAACxH,GAAD,MAAQ,CAAEJ,MAAOI,EAAEU,YAjB9C,kFAmBmBojB,EAAcC,GAnBjC,2FAoBW9gB,KAAKwgB,MAAMjc,MAAK,SAACS,GAAD,OAAUA,EAAKpF,MAAMihB,EAAMA,EAAOC,OApB7D,wDAwBaC,EAAb,WAEE,WAAYrT,GAAyB,yBADrCsT,WACoC,EAClChhB,KAAKghB,MAAQloB,IAAM4U,GAAMwG,QAAQ,OAHrC,sJAMiBrP,YAAM,gBAAoB7E,KAAKghB,MAAMjS,aANtD,0HAQmB8R,EAAcC,GARjC,2FAQgDG,EARhD,+BAQ2D,GAR3D,mBASiBpc,YAAM,gBAAwB7E,KAAKghB,MAAMjS,UAAnC,iBAAqD8R,EAArD,kBAAmEC,EAAnE,gBAAgFG,KATvG,gGAaaC,EAAb,WAKE,WAAYrgB,EAAkB0M,EAAyBC,GAAmC,IAAZpQ,EAAW,uDAAJ,GAAI,yBAJzF+jB,eAIyF,OAHzFC,gBAGyF,OAFzFC,cAEyF,OADzFC,WACyF,EACvFthB,KAAKmhB,UAAYtgB,EACjBb,KAAKohB,WAAa7T,EAClBvN,KAAKqhB,SAAW7T,EAChBxN,KAAKshB,MAAQlkB,EATjB,2DAYI,IAAIJ,EAAS,GAOb,OANIgD,KAAKohB,aACPpkB,GAAM,WAAQgD,KAAKohB,WAAWrS,WAC1B/O,KAAKqhB,WACPrkB,GAAM,WAAQgD,KAAKqhB,SAAStS,aAGzB/R,IAnBX,mCAsBI,MAAM,GAAN,OAAUgD,KAAKmhB,WAAf,OAA2BnhB,KAAKuhB,eAAhC,iBAAuDvhB,KAAKshB,SAtBhE,2IAyBiBzc,YAAM,uBAAiC7E,KAAKwhB,eAAgBjd,MAAK,SAACkd,GAI7E,OAHAA,EAAMC,eAAiB7c,YAAM,gCAA+C,EAAK2c,eAAgBjd,MAC/F,SAACod,GAAD,OAAoBF,EAAMC,eAAiBC,KAEtCF,MA7Bb,0HAgCmBZ,EAAcC,GAhCjC,2FAgCgDG,EAhChD,+BAgC2D,GAhC3D,mBAiCiBpc,YAAM,yBACC7E,KAAKmhB,WADN,OACkBnhB,KAAKuhB,eADvB,iBAC8CV,EAD9C,kBAC4DC,EAD5D,iBAEf9gB,KAAKshB,MAFU,gBAGTL,KApCd,iG,8HC1CMW,E,WAUJ,WAAYtW,GAA8D,IAAtBuW,EAAqB,uDAAL,IAAK,yBATzEC,aASyE,OARzEC,eAQyE,OAPzEC,mBAOyE,OANzEC,aAMyE,OALzEC,oBAKyE,OAJzEC,sBAIyE,OAHzEC,sBAGyE,OAFzEC,wBAEyE,EACvEriB,KAAK8hB,QAAUxW,EACftL,KAAK+hB,UAAY,KACjB/hB,KAAKgiB,cAAgB,KACrBhiB,KAAKiiB,QAAU,GACfjiB,KAAKkiB,eAAiBL,EACtB7hB,KAAKmiB,iBAAmB,KACxBniB,KAAKoiB,iBAAmB,KACxBpiB,KAAKqiB,mBAAqB,G,+DAETC,GACbtiB,KAAKmiB,mBAAqBG,IAG9BtiB,KAAKmiB,iBAAmBG,EACxBtiB,KAAKqiB,mBAAqB,GAC1BriB,KAAKuiB,2B,8CAIL,GADAviB,KAAKoiB,iBAAmB,KACnBpiB,KAAKmiB,iBAAV,CAGA,IAAMtkB,EAAWmC,KAAKie,kBACtB,GAAKpgB,EAAL,CAOA,IAJA,IAAMlB,EAAQkB,EAASlB,MACnB6lB,EAAgB,EAEdC,EAAU,GACPvhB,EAAI,EAAGA,EAAIvE,EAAOuE,IAAK,CAC9B,IAAMwhB,EAAQ1iB,KAAKiiB,QAAQ1kB,KAAK0d,MAAM/Z,EAAIlB,KAAKkiB,iBAC/C,IAAKQ,GAASA,aAAiBhf,QAC7B+e,EAAQpM,KAAKnV,OADf,CAIAyhB,EACA,IAAM1gB,EAAOygB,EAAMxhB,EAAIlB,KAAKkiB,gBACxBllB,EAASgD,KAAKqiB,mBAAmBpgB,EAAKF,WAC3BhD,IAAX/B,IACFgD,KAAKqiB,mBAAmBpgB,EAAKF,MAAQ/E,EAASgD,KAAKmiB,iBAAiBlgB,IAElEjF,IACFylB,EAAQpM,KAAKnV,GACbshB,MAGJxiB,KAAKoiB,iBAAmBK,EACpBD,EAAgB,IAAwBxiB,KAAKkiB,mB,wCAKjD,OAAOliB,KAAK+hB,WAAe/hB,KAAK+hB,qBAAqBre,QAA4B,KAAjB1D,KAAK+hB,Y,0CAGrE,IAAMlkB,EAAWmC,KAAKie,kBACtB,OAAIpgB,EACKmC,KAAKoiB,iBAAmBpiB,KAAKoiB,iBAAiB3kB,OAASI,EAASlB,MAElEqD,KAAK8S,a,kHAGK9S,KAAKie,kB,yCAEbje,KAAK8d,qB,UAET9d,KAAK+hB,YACR/hB,KAAK+hB,UAAY/hB,KAAK8hB,QAAQc,cAAcre,MAAK,SAAA1G,GAC/C,IAAKA,EAEH,MADAsG,QAAQO,IAAI,wBACN,IAAIV,MAAM,wBAKlB,OAHA,EAAK+d,UAAYlkB,EACjB,EAAK0kB,wBACL,EAAKP,cAAgB,KACdnkB,OAGPmC,KAAKgiB,c,yCACAhiB,KAAKgiB,e,cAEdhiB,KAAKgiB,cAAgBte,QAAQmf,QAAQ7iB,KAAK+hB,WACvCxd,MAAK,kBAAM,IAAIb,SAAQ,SAAAmf,GAAO,OAAI9e,WAAW8e,EAAS,WACtDte,MAAK,kBAAM,EAAKuZ,uB,kBACZ9d,KAAKgiB,e,gGAGZ,IAAMnkB,EAAWmC,KAAKie,kBACtB,OAAKpgB,EAGEA,EAASlB,MAFP,O,mCAIEP,GACX,IAAM0mB,EAAc9iB,KAAK+iB,cAAc3mB,GACvC,GAAoB,OAAhB0mB,EACF,OAAO,EAET,IAAME,EAAczlB,KAAK0d,MAAM6H,EAAc9iB,KAAKkiB,gBAClD,QAASliB,KAAKiiB,QAAQe,MAAkBhjB,KAAKiiB,QAAQe,aAAwBtf,W,8BAEvEtH,GAAwE,IAAD,OAAxD6mB,EAAwD,wDACvEH,EAAc9iB,KAAK+iB,cAAc3mB,GACvC,GAAoB,OAAhB0mB,EACF,OAAO9iB,KAAK8S,WAAWvO,MAAK,SAAA5H,GAC1B,OAAIP,EAAQO,EAAQ,GAAmC,OAA9B,EAAKomB,cAAc3mB,GACnC,KAEF,EAAK9E,QAAQ8E,MAGxB,IAAM4mB,EAAczlB,KAAK0d,MAAM6H,EAAc9iB,KAAKkiB,gBAC5CgB,EAAaJ,EAAc9iB,KAAKkiB,eAChCQ,EAAQ1iB,KAAKiiB,QAAQe,GAC3B,OAAKN,GAASA,aAAiBhf,QACtB1D,KAAKmjB,UAAUH,GAAaze,MAAK,SAAAme,GAAK,OAAIA,EAAMQ,OAEpDD,GAAgBjjB,KAAKoiB,kBACxBpiB,KAAKojB,QAAQhnB,EAAQ4D,KAAKkiB,gBAErBQ,EAAMQ,M,8BAEP9mB,GACN,IAAMO,EAAQqD,KAAK8d,oBACfnhB,aAAiB+G,SAGjBtH,GAASO,GAGbqD,KAAK1I,QAAQ8E,GAAO,K,oCAERinB,GACZ,IAAM1mB,EAAQqD,KAAK8d,oBACnB,GAAInhB,aAAiB+G,QACnB,OAAO,KAET,GAAI2f,EAAiB,EACnB,OAAO,KAGT,IAAMC,EAAW3mB,EAAQ0mB,EAAiB,EAC1C,OAAIC,EAAW,EACN,KAEFtjB,KAAKoiB,iBAAmBpiB,KAAKoiB,iBAAiBkB,GAAYA,I,gCAEnDC,G,yEACTvjB,KAAKiiB,QAAQsB,KAChBvjB,KAAKiiB,QAAQsB,GAAcvjB,KAAKwjB,WAAWD,I,kBAEtCvjB,KAAKiiB,QAAQsB,I,0FAGpB,IAAM5mB,EAAQqD,KAAK8d,oBACnB,GAAqB,kBAAVnhB,EAIX,IADA,IAAM8mB,EAAYlmB,KAAKC,KAAKb,EAAQqD,KAAKkiB,gBAChChhB,EAAI,EAAGA,EAAIuiB,EAAWviB,IACzBlB,KAAKiiB,QAAQ/gB,IAGjBlB,KAAKmjB,UAAUjiB,K,iCAGFqiB,G,sGACKvjB,KAAK8S,Y,UAAnBnW,E,OACA8mB,EAAYlmB,KAAKC,KAAKb,EAAQqD,KAAKkiB,gB,yCAEhC,I,YAELqB,GAAcE,G,uBAChBtf,QAAQC,KAAR,sCAA4Cmf,EAA5C,8BAA4E5mB,I,kBACrE,I,kCAEWqD,KAAK8hB,QAAQ4B,WAC/B1jB,KAAKkiB,eAAiBqB,EACtBvjB,KAAKkiB,eACLqB,IAAeE,EAAY,EAAI9mB,EAAM+C,WAAa,K,eAH9CgjB,E,QAKIjlB,OAASuC,KAAKkiB,gBAAkBqB,EAAaE,EAAY,GACjEtf,QAAQC,KAAK,uCAAwCse,EAAMjlB,QAE7DuC,KAAKiiB,QAAQsB,GAAcb,EAC3B1iB,KAAKuiB,wB,kBACEG,G,yDAQEnD,EAAehlB,OAAOuB,OAAO,CACxC0jB,cADwC,SAC1B9R,GACZ,OAAO,IAAIkU,EAAiB,IAAIb,IAAkBrT,KAEpDiW,iBAJwC,WAKtC,OAAO,IAAI/B,EAAiB,IAAItB,MAElCb,aAPwC,SAQtC5e,EACA0M,EACAC,EACApQ,GAEA,OAAO,IAAIwkB,EACT,IAAIV,IACFrgB,EACA0M,EAAYzU,IAAMyU,GAAW2G,QAAQ,YAASnV,EAC9CyO,EAAU1U,IAAM0U,GAASoW,MAAM,YAAS7kB,EACxC3B,Q,sRC3ND,SAAeqZ,EAAaV,GAA5B,2BAAAvX,EAAA2E,OAAA,mDAA4C2d,EAA5C,+BAAoD,GACzD/K,EAASA,EAAOL,OADX,yCAGI,IAHJ,gCAKE7Q,YAAM,wBAAwCgf,mBAAmB9N,GAA3D,kBAA4E+K,KALpF,qCAwBA,SAAegD,EAAgBC,GAA/B,SAAAvlB,EAAA2E,OAAA,kEAAA3E,EAAA,MACQqG,YAAM,+BAA+Ckf,KAD7D,6EAIA,SAAeC,EAAiB1Z,EAAyB8U,GAAzD,SAAA5gB,EAAA2E,OAAA,kEAAA3E,EAAA,MACQqG,YAAM,yBAAwCyF,EAAxC,iBAAqD8U,GAAU,MAD7E,6EAIA,SAAe6E,IAAf,SAAAzlB,EAAA2E,OAAA,kEAAA3E,EAAA,MACQqG,YAAyB,sBADjC,6EAGA,SAAeqf,IAAf,SAAA1lB,EAAA2E,OAAA,kEAAA3E,EAAA,MACQqG,YAAiB,cADzB,6EAIA,SAAesf,IAAf,uEAAA3lB,EAAA2E,OAAA,kEAAA3E,EAAA,MAEiBqG,YAAoB,sBAFrC,OAOL,IALMuf,EAFD,OAGCC,EAEF,GACAC,EAAU,EANT,4BAOL,EAAsCF,EAAtC,+CAAgD,EAAD,iDAAlChF,EAAkC,KAA1BjiB,EAA0B,KAAnBR,EAAmB,KACzC2nB,EAAUnnB,IACZmnB,EAAUnnB,GAENonB,EAAYnF,EAAO1f,WACzB2kB,EAAOE,GAAaF,EAAOE,IAAc,GACzCF,EAAOE,GAAWpnB,GAAQknB,EAAOE,GAAWpnB,IAAS,EACrDknB,EAAOE,GAAWpnB,IAASR,EAdxB,yOAiBL,IADMK,EAAyB,GAhB1B,6BAiBL,EAA8ConB,EAA9C,+CAAwD,EAAD,iDAA1ChF,EAA0C,KAAlCjiB,EAAkC,KAA5BqnB,EAA4B,KAAnB7nB,EAAmB,KAC/C4nB,EAAYnF,EAAO1f,WACzB1C,EAAOunB,GAAavnB,EAAOunB,IAAc,GACzCvnB,EAAOunB,GAAWE,SAAWJ,EAAOE,GAAWpnB,GAC/CH,EAAOunB,GAAWpnB,GAAQH,EAAOunB,GAAWpnB,IAASnC,MAAMspB,GAAS3J,KAAK,GACzE3d,EAAOunB,GAAWpnB,GAAMqnB,GAAU7nB,EAAQ0nB,EAAOE,GAAWpnB,GAtBzD,mQAwBEH,GAxBF,uG,gCCnDP,qEAMM0nB,EANN,KAMwBxqB,EAAKzB,eAAeyD,KAAI,SAAAa,GAAC,MAAK,CACpDlC,IAAK8pB,OAAO5nB,GACZmM,MAAOgH,oBAAUnT,OAOZ,SAAS6nB,EAAT,GAA4F,IAApExnB,EAAmE,EAAnEA,KAAMgY,EAA6D,EAA7DA,SACnC,OAAIsP,EAAgBjnB,OAAS,EACpB,KAGP,kBAAC,IAAD,CACE6M,KAAK,QACL+N,SAAS,eACTD,MAAOsM,EACP3L,gBAAiB3b,GAAQ,GACzBgY,SAAUA,IAfhBsP,EAAgBG,QAAQ,CACtBhqB,IAAK,GACLqO,MAAO,mB","file":"static/js/main.20f08a43.chunk.js","sourcesContent":["import { GameMode } from \"../data/types\";\nimport dayjs from \"dayjs\";\n\nconst domain =\n  sessionStorage.getItem(\"overrideDomain\") || localStorage.getItem(\"overrideDomain\") || window.location.hostname;\n\nexport const CONFIGURATIONS = {\n  DEFAULT: {\n    apiSuffix: process.env.NODE_ENV === \"development\" ? \"api-test/\" : \"api/\",\n    features: {\n      ranking: true,\n      statistics: true,\n      estimatedStableLevel: true,\n      contestTools: false,\n      statisticsSubPages: {\n        rankBySeat: true,\n        dataByRank: true,\n        fanStats: true,\n      },\n    },\n    table: {\n      showGameMode: true,\n    },\n    availableModes: [GameMode.王座, GameMode.玉],\n    dateMin: dayjs(\"2019-08-23\", \"YYYY-MM-DD\"),\n    siteTitle: \"雀魂牌谱屋\",\n    canonicalDomain: \"amae-koromo.sapk.ch\",\n    showTopNotice: true,\n    mirrorUrl: \"https://saki.sapk.ch/\",\n    siteSpecificNotice: \"记录包含雀魂四人半庄段位战玉之间及王座之间的牌谱。\",\n    rootClassName: \"koromo\",\n    rankColors: [\"#28a745\", \"#17a2b8\", \"#6c757d\", \"#dc3545\"],\n  },\n  ako: {\n    apiSuffix: \"api/2_9/\",\n    features: {\n      ranking: false,\n      statistics: true,\n      estimatedStableLevel: false,\n      contestTools: false,\n      statisticsSubPages: {\n        rankBySeat: true,\n        dataByRank: false,\n        fanStats: true,\n      },\n    },\n    table: {\n      showGameMode: false,\n    },\n    availableModes: [GameMode.金],\n    dateMin: dayjs(\"2019-11-29\", \"YYYY-MM-DD\"),\n    siteTitle: \"雀魂牌谱屋·金\",\n    canonicalDomain: \"ako.sapk.ch\",\n    mirrorUrl: \"https://kuro.sapk.ch/\",\n    siteSpecificNotice: \"记录包含雀魂四人半庄段位战金之间的牌谱。\",\n    rootClassName: \"achiga\",\n  },\n  ikeda: {\n    apiSuffix: \"api/12/\",\n    features: {\n      ranking: false,\n      statistics: true,\n      estimatedStableLevel: true,\n      contestTools: false,\n      statisticsSubPages: {\n        rankBySeat: true,\n        dataByRank: true,\n        fanStats: true,\n      },\n    },\n    availableModes: [GameMode.三王座, GameMode.三玉, GameMode.三金],\n    dateMin: dayjs(\"2019-11-29\", \"YYYY-MM-DD\"),\n    siteTitle: \"雀魂牌谱屋·三麻\",\n    canonicalDomain: \"ikeda.sapk.ch\",\n    mirrorUrl: \"https://momoko.sapk.ch/\",\n    siteSpecificNotice: \"记录包含雀魂三人半庄段位战金之间、玉之间及王座之间的牌谱。\",\n    rankColors: [\"#28a745\", \"#6c757d\", \"#dc3545\"],\n    rootClassName: \"yuuki\",\n  },\n  contest: {\n    apiSuffix: (s: string) => `api/contest/${s}/`,\n    features: {\n      ranking: false,\n      statistics: true,\n      estimatedStableLevel: false,\n      contestTools: true,\n      statisticsSubPages: {\n        rankBySeat: true,\n        dataByRank: false,\n        fanStats: true,\n      },\n    },\n    table: {\n      showGameMode: true,\n    },\n    availableModes: [],\n    canonicalDomain: domain,\n    showTopNotice: false,\n  },\n};\n\ntype Configuration = typeof CONFIGURATIONS.DEFAULT;\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction mergeDeep<T extends { [key: string]: any }>(...objects: Partial<T>[]): T {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const isObject = <T>(obj: T) => obj && typeof obj === \"object\" && (obj as any).constructor === Object;\n\n  return objects.reduce((prev: T, obj: Partial<T>) => {\n    Object.keys(obj).forEach((key: keyof T) => {\n      const pVal = prev[key];\n      const oVal = obj[key];\n\n      if (Array.isArray(pVal) && Array.isArray(oVal)) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        prev[key] = oVal as any;\n      } else if (isObject(pVal) && isObject(oVal)) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        prev[key] = mergeDeep(pVal, oVal as any);\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        prev[key] = oVal as any;\n      }\n    });\n\n    return prev;\n  }, {} as T) as T;\n}\n\nconst ConfBase: Partial<Configuration> = (() => {\n  if (/^(ako|kuro)\\./i.test(domain)) {\n    return CONFIGURATIONS.ako;\n  }\n  if (/^(ikeda|momoko)\\./i.test(domain)) {\n    return CONFIGURATIONS.ikeda;\n  }\n  const m = /^([^.]+)\\.contest\\./i.exec(domain);\n  if (m) {\n    return { ...CONFIGURATIONS.contest, apiSuffix: CONFIGURATIONS.contest.apiSuffix(m[1]) };\n  }\n  return CONFIGURATIONS.DEFAULT;\n})();\n\nconst Conf = mergeDeep<Configuration>(CONFIGURATIONS.DEFAULT, ConfBase);\n\ndocument.documentElement.className += \" \" + Conf.rootClassName;\n\nexport default Conf;\n","/* eslint-disable @typescript-eslint/camelcase */\nimport { LevelWithDelta, Level, getTranslatedLevelTags } from \"./level\";\nimport { GameMode } from \"./gameMode\";\nimport { FanStatEntry } from \"./statistics\";\nimport { sum } from \"../../utils\";\nimport i18n from \"../../i18n\";\n\nconst t = i18n.t.bind(i18n);\n\nconst RANK_DELTA_4 = [15, 5, -5, -15];\nconst RANK_DELTA_3 = [15, 0, -15];\nconst RANK_DELTA = {\n  [GameMode.金]: RANK_DELTA_4,\n  [GameMode.玉]: RANK_DELTA_4,\n  [GameMode.王座]: RANK_DELTA_4,\n  [GameMode.三金]: RANK_DELTA_3,\n  [GameMode.三玉]: RANK_DELTA_3,\n  [GameMode.三王座]: RANK_DELTA_3,\n};\nconst MODE_DELTA = {\n  [GameMode.金]: [80, 40, 0, 0],\n  [GameMode.玉]: [110, 55, 0, 0],\n  [GameMode.王座]: [120, 60, 0, 0],\n  [GameMode.三金]: [105, 0, 0],\n  [GameMode.三玉]: [160, 0, 0],\n  [GameMode.三王座]: [240, 0, 0],\n};\nconst MODE_BASE_POINT = {\n  [GameMode.金]: 25000,\n  [GameMode.玉]: 25000,\n  [GameMode.王座]: 25000,\n  [GameMode.三金]: 35000,\n  [GameMode.三玉]: 35000,\n  [GameMode.三王座]: 35000,\n};\n\nexport type RankRates = [number, number, number, number] | [number, number, number];\nexport const RankRates = Object.freeze({\n  getAvg(rates: RankRates): number {\n    return sum(rates.map((value, index) => value * (index + 1))) / sum(rates);\n  },\n  normalize(rates: RankRates): RankRates {\n    const total = sum(rates);\n    return rates.map((value) => value / total) as RankRates;\n  },\n});\n\nexport type FanStatEntry2 = FanStatEntry & {\n  役满: number;\n};\nexport const FanStatEntry2 = Object.freeze({\n  formatFan(entry: FanStatEntry2): string {\n    if (entry.役满) {\n      if (entry.役满 === 1) {\n        return t(\"役满\");\n      }\n      return `${entry.役满} ${t(\"倍役满\")}`;\n    }\n    return `${entry.count} ${t(\"番\")}`;\n  },\n});\nexport type FanStatEntryList = FanStatEntry2[];\nexport const FanStatEntryList = Object.freeze({\n  formatFanSummary(list: FanStatEntryList): string {\n    const count = sum(list.map((x) => x.count));\n    const 役满 = sum(list.map((x) => x.役满));\n    if (役满) {\n      if (役满 === 1) {\n        return t(\"役满\");\n      }\n      return `${役满} ${t(\"倍役满\")}`;\n    }\n    let result = `${count} ${t(\"番\")}`;\n    if (count >= 13) {\n      result += \" - \" + t(\"累计役满\");\n    } else if (count >= 11) {\n      result += \" - \" + t(\"三倍满\");\n    } else if (count >= 8) {\n      result += \" - \" + t(\"倍满\");\n    } else if (count >= 6) {\n      result += \" - \" + t(\"跳满\");\n    } else if (count === 5) {\n      result += \" - \" + t(\"满贯\");\n    }\n    return result;\n  },\n});\n\nexport interface PlayerExtendedStats {\n  count: number;\n  和牌率: number;\n  自摸率: number;\n  默听率: number;\n  放铳率: number;\n  副露率: number;\n  立直率: number;\n  平均打点: number;\n  最大连庄?: number;\n  和了巡数: number;\n  平均铳点: number;\n  流局率: number;\n  流听率: number;\n  里宝率: number;\n  一发率: number;\n  被炸率: number;\n  平均被炸点数: number;\n  放铳时立直率: number;\n  放铳时副露率: number;\n  立直后放铳率: number;\n  副露后放铳率: number;\n  立直后和牌率: number;\n  副露后和牌率: number;\n  立直后流局率: number;\n  副露后流局率: number;\n  役满?: number;\n  累计役满?: number;\n  最大累计番数?: number;\n  W立直?: number;\n  流满?: number;\n  平均起手向听: number;\n  放铳至立直: number;\n  放铳至副露: number;\n  放铳至默听: number;\n  立直和了: number;\n  副露和了: number;\n  默听和了: number;\n  立直巡目: number;\n  立直流局: number;\n  立直收支: number;\n  立直收入: number;\n  立直支出: number;\n  先制率: number;\n  追立率: number;\n  被追率: number;\n  振听立直率: number;\n  最近大铳?: {\n    id: string;\n    start_time: number;\n    fans: FanStatEntryList;\n  };\n}\nexport interface Metadata {\n  count: number;\n}\nexport interface PlayerMetadataLite extends Metadata {\n  id: number;\n  nickname: string;\n  level: LevelWithDelta;\n}\nexport interface PlayerMetadataLite2 extends Metadata {\n  rank_rates: RankRates;\n  avg_rank: number;\n  negative_rate: number;\n}\nexport interface PlayerMetadata extends PlayerMetadataLite, PlayerMetadataLite2 {\n  rank_avg_score: RankRates;\n  max_level: LevelWithDelta;\n  extended_stats?: PlayerExtendedStats | Promise<PlayerExtendedStats>;\n}\n\nexport function calculateDeltaPoint(\n  score: number,\n  rank: number,\n  mode: GameMode,\n  level: Level,\n  includePenalty = true,\n  trimNumber = true\n): number {\n  let result =\n    (trimNumber ? Math.ceil : (x: number) => x)((score - MODE_BASE_POINT[mode]) / 1000 + RANK_DELTA[mode][rank]) +\n    MODE_DELTA[mode][rank];\n  if (rank === RANK_DELTA[mode].length - 1 && includePenalty) {\n    result -= level.getPenaltyPoint();\n  }\n  /*\n  console.log(\n    `calculateDeltaPoint: score=${score}, rank=${rank}, mode=${mode}, level=${level.getTag()}, result=${result}`\n  );\n  */\n  return result;\n}\n\nexport const PlayerMetadata = Object.freeze({\n  calculateRankDeltaPoints(\n    metadata: PlayerMetadata,\n    mode: GameMode,\n    level?: Level,\n    includePenalty = true,\n    trimNumber = true\n  ): RankRates {\n    const rankDeltaPoints = metadata.rank_avg_score.map((score, rank) =>\n      calculateDeltaPoint(\n        score,\n        rank,\n        mode,\n        level || LevelWithDelta.getAdjustedLevel(metadata.level),\n        includePenalty,\n        trimNumber\n      )\n    ) as typeof metadata.rank_avg_score;\n    return rankDeltaPoints;\n  },\n  calculateExpectedGamePoint(metadata: PlayerMetadata, mode: GameMode, level?: Level, includePenalty = true): number {\n    const rankDeltaPoints = PlayerMetadata.calculateRankDeltaPoints(metadata, mode, level, includePenalty);\n    const rankWeightedPoints = rankDeltaPoints.map((point, rank) => point * metadata.rank_rates[rank]);\n    const expectedGamePoint = rankWeightedPoints.reduce((a, b) => a + b, 0);\n    /*\n    console.log(rankDeltaPoints);\n    console.log(rankWeightedPoints);\n    console.log(\n      `calculateExpectedGamePoint: mode=${mode}, level=${level ? level.getTag() : \"\"}, result=${expectedGamePoint}`\n    );\n    */\n    return expectedGamePoint;\n  },\n  estimateStableLevel(metadata: PlayerMetadata, mode: GameMode): string {\n    const calcPoint = (level: Level) => PlayerMetadata.calculateExpectedGamePoint(metadata, mode, level);\n    let level = new Level(metadata.level.id);\n    let lastPositiveLevel: Level | undefined = undefined;\n    for (;;) {\n      const expectedGamePoint = calcPoint(level);\n      if (Math.abs(expectedGamePoint) < 0.001) {\n        return level.getTag() + \" (0)\";\n      }\n      if (expectedGamePoint >= 0) {\n        lastPositiveLevel = level;\n        level = level.getNextLevel();\n        if (!level.isAllowedMode(mode) || level === lastPositiveLevel) {\n          return `${lastPositiveLevel.getTag()}+ (${expectedGamePoint.toFixed(2)})`;\n        }\n      } else {\n        if (lastPositiveLevel) {\n          return `${lastPositiveLevel.getTag()} (${calcPoint(lastPositiveLevel).toFixed(2)})`;\n        }\n        break;\n      }\n    }\n    if (!level.getMaxPoint()) {\n      // 魂天不会掉段\n      return `${level.getTag()}- (${calcPoint(level).toFixed(2)})`;\n    }\n    for (;;) {\n      const prevLevel = level.getPreviousLevel();\n      if (!prevLevel.isAllowedMode(mode) || prevLevel === level) {\n        return `${level.getTag()}- (${calcPoint(level).toFixed(2)})`;\n      }\n      level = prevLevel;\n      const expectedGamePoint = calcPoint(level);\n      if (expectedGamePoint > -0.001) {\n        return `${level.getTag()} (${Math.abs(calcPoint(level)).toFixed(2)})`;\n      }\n    }\n  },\n  formatStableLevel2(level: number): string {\n    const formatNumber = function (x: number): string {\n      // Trim after the second digit after decimal point\n      let s = x.toString();\n      if (s.indexOf(\".\") === -1) {\n        s += \".00\";\n      }\n      if (s.length < 8) {\n        s += \"00\";\n      }\n      return s.slice(0, s.indexOf(\".\") + 3);\n    };\n    const translatedLevelTags = getTranslatedLevelTags();\n    if (level >= 7) {\n      return `${translatedLevelTags[5]}${formatNumber(level - 6)}`;\n    }\n    if (level >= 4) {\n      return `${translatedLevelTags[4]}${formatNumber(level - 3)}`;\n    }\n    return `${translatedLevelTags[3]}${formatNumber(level)}`;\n  },\n  getStableLevelComponents(metadata: PlayerMetadata, mode: GameMode): RankRates {\n    return this.calculateRankDeltaPoints(metadata, mode, undefined, false, false);\n  },\n  estimateStableLevel2(metadata: PlayerMetadata, mode: GameMode): string {\n    if (metadata.rank_rates.length === 3) {\n      return this.estimateStableLevel(metadata, mode);\n    }\n    if (!metadata.rank_rates[3]) {\n      return \"\";\n    }\n    const estimatedPoints = this.calculateExpectedGamePoint(metadata, mode, undefined, false);\n    const result = estimatedPoints / (metadata.rank_rates[3] * 15) - 10;\n    return PlayerMetadata.formatStableLevel2(result);\n  },\n});\n","import { LevelWithDelta } from \"./level\";\nimport { PlayerMetadata } from \"./metadata\";\n\nexport enum RankingTimeSpan {\n  OneWeek = \"1w\",\n  FourWeeks = \"4w\"\n}\nexport type DeltaRankingItem = {\n  id: number;\n  nickname: string;\n  level: LevelWithDelta;\n  delta: number;\n};\nexport type DeltaRankingResponse = {\n  [modeId: string]: {\n    top: DeltaRankingItem[];\n    bottom: DeltaRankingItem[];\n  };\n};\nexport interface CareerRankingItem extends PlayerMetadata {\n  rank_key: number;\n  count: number;\n}\nexport enum CareerRankingType {\n  Rank1 = \"rank1\",\n  Rank12 = \"rank12\",\n  Rank123 = \"rank123\",\n  Rank4 = \"rank4\",\n  AvgRank = \"avg_rank\",\n  NumGames = \"num_games\",\n  StableLevel = \"stable_level\",\n  PointEfficiency = \"point_efficiency\",\n  Win = \"win\",\n  Lose = \"lose\",\n  WinRev = \"win_rev\",\n  LoseRev = \"lose_rev\",\n  ExpectedGamePoint0 = \"expected_game_point_0\",\n  ExpectedGamePoint1 = \"expected_game_point_1\",\n  ExpectedGamePoint2 = \"expected_game_point_2\",\n  ExpectedGamePoint3 = \"expected_game_point_3\",\n  里宝率 = \"里宝率\",\n  被炸率 = \"被炸率\",\n  一发率 = \"一发率\",\n  里宝率Rev = \"里宝率_rev\",\n  被炸率Rev = \"被炸率_rev\",\n  一发率Rev = \"一发率_rev\"\n}\n","import React, { ReactNode } from \"react\";\r\nimport { Trans } from \"react-i18next\";\r\n\r\nexport const FormRow = ({ title = \"\", inline = false, children = undefined as ReactNode }) => (\r\n  <>\r\n    <label className={\"col-form-label\"}>\r\n      <Trans ns=\"formRow\">{title}</Trans>\r\n    </label>\r\n    <div className={`col-form-control ${inline ? \"form-inline\" : \"\"}`}>{children}</div>\r\n  </>\r\n);\r\n","import dayjs from \"dayjs\";\n\nimport { GameMode } from \"./gameMode\";\nimport { getRankLabelByIndex } from \"./utils\";\nimport Conf from \"../../utils/conf\";\n\nimport i18n from \"../../i18n\";\nimport { FanStatEntryList } from \"./metadata\";\n\nexport interface PlayerRecord {\n  accountId: number;\n  nickname: string;\n  level: number;\n  score: number;\n}\nexport interface GameRecord {\n  _id?: string;\n  modeId: GameMode;\n  uuid: string;\n  startTime: number;\n  endTime: number;\n  players: PlayerRecord[];\n}\nexport type HighlightEvent = {\n  type: \"役满\";\n  fan: FanStatEntryList;\n  player: number;\n};\nexport type GameRecordWithEvent = GameRecord & {\n  event: HighlightEvent;\n};\nexport const GameRecord = Object.freeze({\n  getRankIndexByPlayer(rec: GameRecord, player: number | string | PlayerRecord): number {\n    const playerId = (typeof player === \"object\" ? player.accountId : player).toString();\n    const sortedPlayers = rec.players.map((player, index) => ({ player, index }));\n    sortedPlayers.sort((a, b) => 5 - b.index + b.player.score - (5 - a.index + a.player.score));\n    for (let i = 0; i < sortedPlayers.length; i++) {\n      if (sortedPlayers[i].player.accountId.toString() === playerId) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  getPlayerRankLabel(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return getRankLabelByIndex(GameRecord.getRankIndexByPlayer(rec, player)) || \"\";\n  },\n  getPlayerRankColor(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return Conf.rankColors[GameRecord.getRankIndexByPlayer(rec, player)];\n  },\n  encodeAccountId: (t: number) => 1358437 + ((7 * t + 1117113) ^ 86216345),\n  getStartTime: (rec: GameRecord | number) => (typeof rec === \"number\" ? rec : rec.startTime) * 1000,\n  formatFullStartTime: (rec: GameRecord | number) => dayjs(GameRecord.getStartTime(rec)).format(\"YYYY/M/D HH:mm\"),\n  formatStartDate: (rec: GameRecord | number) => dayjs(GameRecord.getStartTime(rec)).format(\"M/D\"),\n  getRecordLink(rec: GameRecord | string, player?: PlayerRecord | number | string) {\n    const playerId = typeof player === \"object\" ? player.accountId : player;\n    const trailer = playerId\n      ? `_a${GameRecord.encodeAccountId(typeof playerId === \"number\" ? playerId : parseInt(playerId))}`\n      : \"\";\n    const uuid = typeof rec === \"string\" ? rec : rec.uuid;\n    return `${i18n.t(\"https://game.maj-soul.com/1/\")}?paipu=${uuid}${trailer}`;\n  },\n});\n","import React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { IoMdBook } from \"react-icons/io\";\n\nimport { GameRecord, PlayerRecord, getLevelTag } from \"../../data/types\";\nimport { generatePlayerPathById } from \"./routes\";\n\nexport const Player = function({\n  player,\n  game,\n  isActive\n}: {\n  player: PlayerRecord;\n  game: GameRecord;\n  isActive: boolean;\n}) {\n  const { nickname, level, score, accountId } = player;\n  const isTop = GameRecord.getRankIndexByPlayer(game, player) === 0;\n  return (\n    <span className={`player ${isTop && \"font-weight-bold\"} ${isActive && \"active-player\"}`}>\n      <a href={GameRecord.getRecordLink(game, player)} title=\"查看牌谱\" target=\"_blank\" rel=\"noopener noreferrer\">\n        [{getLevelTag(level)}] {nickname} {score !== undefined && `[${score}]`}\n      </a>{\" \"}\n      <Link className=\"detail-link\" title=\"玩家记录\" to={generatePlayerPathById(accountId)}>\n        <IoMdBook />\n      </Link>\n    </span>\n  );\n};\n","/* eslint-disable @typescript-eslint/no-empty-function */\nimport Conf from \"../../utils/conf\";\n\nconst DATA_MIRRORS = [\"https://ak-data-2.sapk.ch/\", \"https://ak-data-1.sapk.ch/\", \"https://ak-data-3.sapk.ch/\"];\nconst PROBE_TIMEOUT = 15000;\n\nlet selectedMirror = localStorage.getItem(\"selectedMirror\") || DATA_MIRRORS[0];\n\nlet onMaintenance: (msg: string) => void = () => {};\n\nexport function setMaintenanceHandler(handler: (msg: string) => void) {\n  onMaintenance = handler;\n}\n\nasync function fetchWithTimeout(url: string, opts: RequestInit = {}, timeout = 5000): Promise<Response> {\n  const abortController = window.AbortController ? new AbortController() : { signal: undefined, abort: () => {} };\n  return Promise.race([\n    fetch(url, { ...opts, signal: abortController.signal }),\n    new Promise((_, reject) =>\n      setTimeout(function () {\n        abortController.abort();\n        reject(new Error(\"Timeout\"));\n      }, timeout)\n    ),\n  ]) as Promise<Response>;\n}\n\nasync function fetchData(path: string): Promise<Response> {\n  try {\n    return await fetchWithTimeout(selectedMirror + path);\n  } catch (e) {\n    console.warn(e);\n    console.warn(`Failed to fetch data from mirror ${selectedMirror}, trying other mirror...`);\n  }\n\n  let done = false;\n  return Promise.race(\n    DATA_MIRRORS.map((mirror) =>\n      fetchWithTimeout(mirror + path, {}, PROBE_TIMEOUT)\n        .then(function (resp) {\n          if (done) {\n            return resp;\n          }\n          done = true;\n          selectedMirror = mirror;\n          localStorage.setItem(\"selectedMirror\", selectedMirror);\n          console.log(`Set ${mirror} as preferred`);\n          return resp;\n        })\n        .catch((e) => new Promise((_, reject) => setTimeout(() => reject(e), PROBE_TIMEOUT)))\n    )\n  ) as Promise<Response>;\n}\n\nexport async function apiGet<T>(path: string): Promise<T> {\n  const resp = await fetchData(Conf.apiSuffix + path);\n  if (!resp.ok) {\n    throw resp;\n  }\n  const data = await resp.json();\n  if (data.maintenance) {\n    onMaintenance(data.maintenance);\n    return new Promise(() => {}) as Promise<T>; // Freeze all other components\n  }\n  return data as T;\n}\n","import i18n from \"i18next\";\nimport { initReactI18next } from \"react-i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\n\nimport resources from \"./translations.json\";\nimport { triggerRelayout } from \"./utils\";\n\nconst DEBUG = process.env.NODE_ENV === \"development\";\n\nif (DEBUG) {\n  sessionStorage.removeItem(\"__i18nMissingKeys\");\n}\n\ni18n\n  .use(LanguageDetector)\n  .use(initReactI18next) // passes i18n down to react-i18next\n  .init({\n    resources,\n    lowerCaseLng: true,\n    fallbackLng: \"zh-hans\",\n    defaultNS: \"default\",\n    debug: DEBUG,\n    whitelist: [\"ja\", \"zh-hans\", \"en\"],\n    detection: {\n      order: [\"localStorage\", \"navigator\"],\n      caches: [\"localStorage\"],\n      checkWhitelist: true\n    },\n\n    returnEmptyString: false,\n    returnNull: false,\n\n    saveMissing: DEBUG,\n    missingKeyHandler: DEBUG\n      ? function(lng, ns, key) {\n          const missingKeys = JSON.parse(sessionStorage.getItem(\"__i18nMissingKeys\") || \"{}\") || {};\n          const l = i18n.language;\n          if (l === \"zh-hans\") {\n            return;\n          }\n          missingKeys[l] = missingKeys[l] || {};\n          missingKeys[l][ns] = missingKeys[l][ns] || {};\n          missingKeys[l][ns][key] = \"\";\n          sessionStorage.setItem(\"__i18nMissingKeys\", JSON.stringify(missingKeys));\n        }\n      : false,\n\n    nsSeparator: false,\n    keySeparator: false,\n\n    interpolation: {\n      escapeValue: false\n    }\n  });\n\ni18n.on(\"languageChanged\", function() {\n  triggerRelayout();\n});\n\nexport default i18n;\n","import React from \"react\";\n\nexport default function Loading({ size = \"normal\" }: { size?: \"normal\" | \"small\" }) {\n  return (\n    <div className={`d-flex justify-content-center m-${size === \"normal\" ? 5 : 1}`}>\n      <div className={`spinner-border ${size === \"normal\" ? \"\" : \"spinner-border-sm\"}`} role=\"status\">\n        <span className=\"sr-only\">Loading...</span>\n      </div>\n    </div>\n  );\n}\n","/* eslint-disable no-eq-null */\n/* eslint-disable @typescript-eslint/no-use-before-define */\n/* eslint-disable no-use-before-define */\n// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === \"localhost\" ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === \"[::1]\" ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener(\"load\", () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            \"This web app is being served cache-first by a service \" +\n              \"worker. To learn more, visit https://bit.ly/CRA-PWA\"\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === \"installed\") {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                \"New content is available and will be used when all \" +\n                  \"tabs for this page are closed. See https://bit.ly/CRA-PWA.\"\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log(\"Content is cached for offline use.\");\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error(\"Error during service worker registration:\", error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { \"Service-Worker\": \"script\" }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get(\"content-type\");\n      if (response.status === 404 || (contentType != null && contentType.indexOf(\"javascript\") === -1)) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\"No internet connection found. App is running in offline mode.\");\n    });\n}\n\nexport function unregister() {\n  if (\"serviceWorker\" in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { ReactNode } from \"react\";\r\n\r\nexport const Container = ({ title = undefined, children = undefined as ReactNode, fluid = false }) => (\r\n  <div className={`my-5 container${fluid ? \"-fluid\" : \"\"}`}>\r\n    <div className=\"row\">\r\n      <div className=\"col-sm-12\">\r\n        {title && <h2 className=\"mb-4\">{title}</h2>}\r\n        {children}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n","import React from \"react\";\r\n\r\nimport { Container } from \"../layout\";\r\nimport { Alert } from \"../misc/alert\";\r\nimport Conf from \"../../utils/conf\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nfunction AlertDefault() {\r\n  return (\r\n    <>\r\n      <h4>说明</h4>\r\n      <ul>\r\n        <li>本页面数据由第三方维护，不能绝对保证完整和正确，信息仅供参考，请勿用于不良用途。</li>\r\n        <li>{Conf.siteSpecificNotice}</li>\r\n        <li>页面不是实时更新，对局一般会在结束后数分钟至数小时内出现。</li>\r\n        <li>对局数据收集从{Conf.dateMin.format(\" YYYY 年 M 月 D 日\")}开始，之前的对局已无法获取。</li>\r\n        <li>\r\n          网站主线路会收集少量匿名浏览数据作后续改进及优化之用，如不希望被收集数据，请使用\r\n          <a href={Conf.mirrorUrl}>镜像线路</a>。\r\n        </li>\r\n        <li>\r\n          如有问题或建议，请戳 <a href=\"mailto:i@sapika.ch\">SAPikachu (i@sapika.ch)</a> 或{\" \"}\r\n          <a href=\"https://github.com/SAPikachu/amae-koromo/\">提交 Issue</a>。\r\n        </li>\r\n        <li>\r\n          感谢 <a href=\"https://github.com/kamicloud/\">Kamicloud</a> 提供部分数据。\r\n        </li>\r\n      </ul>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction AlertEn() {\r\n  return (\r\n    <>\r\n      <h4>Notes</h4>\r\n      <ul>\r\n        <li>\r\n          This is a fan site, data accuracy can&apos;t be fully guaranteed, please use the data for reference only and\r\n          don&apos;t use it for malicious purpose.\r\n        </li>\r\n        <li>At this moment, only south matches are recorded, east matches are not included in the data.</li>\r\n        <li>\r\n          Data is not updated in real-time, finished matches will show up on the site in a few minutes to a few hours.\r\n        </li>\r\n        <li>\r\n          Data collection was started from {Conf.dateMin.format(\" YYYY-MM-DD\")}, matches finished before then could no\r\n          longer be retrived.\r\n        </li>\r\n        <li>\r\n          Main mirror of the site collects small amount of anonymous usage data for improving the site. If you wish to\r\n          opt-out from this, please use <a href={Conf.mirrorUrl}>the alternative mirror</a>.\r\n        </li>\r\n        <li>\r\n          If you have any question or suggestion, feel free to email{\" \"}\r\n          <a href=\"mailto:i@sapika.ch\">SAPikachu (i@sapika.ch)</a> or{\" \"}\r\n          <a href=\"https://github.com/SAPikachu/amae-koromo/\">submit an issue</a>.\r\n        </li>\r\n        <li>\r\n          English translation of the site is contributed by <a href=\"https://github.com/Mjonir\">Mjonir</a> and{\" \"}\r\n          <a href=\"https://github.com/kator-278\">kator-278</a>. Thank you!\r\n        </li>\r\n        <li>\r\n          感谢 <a href=\"https://github.com/kamicloud/\">Kamicloud</a> 提供部分数据。\r\n        </li>\r\n      </ul>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction AlertJa() {\r\n  return (\r\n    <>\r\n      <h4>説明</h4>\r\n      <ul>\r\n        <li>\r\n          当サイトは非公式サイトで、データの完全性と正確性が保証できません、予めご了承ください。サイトの内容を悪用しないでください。\r\n        </li>\r\n        <li>現時点では半荘戦だけ記録しています。東風戦のデータは含まれません。</li>\r\n        <li>データの更新はリアルタイムではありません。対局がサイトに載せるまで数分から数時間がかかります。</li>\r\n        <li>\r\n          データの収集は{Conf.dateMin.format(\" YYYY 年 M 月 D 日\")}からです。収集が始まるまでの対戦は検索できません。\r\n        </li>\r\n        <li>\r\n          <a href={\"https://\" + Conf.canonicalDomain}>メーンサイト</a>\r\n          はサービス向上のため、少しの匿名使用情報を収集しています。希望しない方は、\r\n          <a href={Conf.mirrorUrl}>ミラーサイト</a>を使ってください。\r\n        </li>\r\n        <li>\r\n          内容の誤り・誤植等はご報告いただけますと幸いです。 <a href=\"mailto:i@sapika.ch\">SAPikachu (i@sapika.ch)</a>{\" \"}\r\n          または <a href=\"https://github.com/SAPikachu/amae-koromo/\">GitHub</a> でご連絡ください。\r\n        </li>\r\n        <li>\r\n          感谢 <a href=\"https://github.com/kamicloud/\">Kamicloud</a> 提供部分数据。\r\n        </li>\r\n      </ul>\r\n    </>\r\n  );\r\n}\r\n\r\nexport function AppHeader() {\r\n  const { i18n } = useTranslation();\r\n  return (\r\n    <Alert container={Container} stateName=\"topNote20200501\">\r\n      {i18n.language.indexOf(\"ja\") === 0 ? (\r\n        <AlertJa />\r\n      ) : i18n.language.indexOf(\"en\") === 0 ? (\r\n        <AlertEn />\r\n      ) : (\r\n        <AlertDefault />\r\n      )}\r\n    </Alert>\r\n  );\r\n}\r\n","import * as React from \"react\";\nimport { useState } from \"react\";\n\nimport { Alert } from \"../misc/alert\";\nimport { Container } from \"../layout/container\";\nimport { setMaintenanceHandler } from \"../../data/source/api\";\n\nexport function MaintenanceHandler({ children }: { children: React.ReactElement }): React.ReactElement {\n  const [msg, setMsg] = useState(\"\");\n  setMaintenanceHandler(setMsg);\n  if (!msg) {\n    return children;\n  }\n  return (\n    <Alert container={Container} closable={false}>\n      <h4>临时维护公告</h4>\n      <p>{msg}</p>\n    </Alert>\n  );\n}\n","import React from \"react\";\nimport { Location } from \"history\";\nimport { Link, NavLink } from \"react-router-dom\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport Conf, { CONFIGURATIONS } from \"../../utils/conf\";\nimport { useTranslation } from \"react-i18next\";\nimport clsx from \"clsx\";\n\nconst NAV_ITEMS = [\n  [\"最近役满\", \"highlight\"],\n  [\"排行榜\", \"ranking\"],\n  [\"大数据\", \"statistics\"],\n]\n  .filter(([, path]) => !(path in Conf.features) || Conf.features[path as keyof typeof Conf.features])\n  .map(([label, path]) => ({ label, path }));\n\nconst SITE_LINKS = [\n  [\"四麻玉/王座\", CONFIGURATIONS.DEFAULT.canonicalDomain],\n  [\"四麻金\", CONFIGURATIONS.ako.canonicalDomain],\n  [\"三麻\", CONFIGURATIONS.ikeda.canonicalDomain],\n].map(([label, domain]) => ({ label, domain, active: Conf.canonicalDomain === domain }));\n\nconst LANGUAGES = [\n  [\"中文\", \"zh-hans\"],\n  [\"日本語\", \"ja\"],\n  [\"English\", \"en\"],\n].map(([label, code]) => ({ label, code }));\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction isActive(match: any, location: Location): boolean {\n  if (!match) {\n    return false;\n  }\n  return !NAV_ITEMS.some(({ path }) => location.pathname.startsWith(\"/\" + path));\n}\n\nexport default function Navbar() {\n  const { t, i18n } = useTranslation();\n  const [mobileVisible, setMobileVisible] = useState(false);\n  const onToggleButtonClick = useCallback(\n    (e: React.MouseEvent<HTMLButtonElement>) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setMobileVisible(!mobileVisible);\n    },\n    [mobileVisible, setMobileVisible]\n  );\n  useEffect(() => {\n    if (!mobileVisible) {\n      return;\n    }\n    const handler = (e: MouseEvent) => {\n      if ((e.target as HTMLElement).classList.contains(\"navbar-toggler\")) {\n        return;\n      }\n      setMobileVisible(false);\n    };\n    document.addEventListener(\"click\", handler);\n    return () => document.removeEventListener(\"click\", handler);\n  }, [mobileVisible, setMobileVisible]);\n  return (\n    <nav className=\"navbar navbar-expand-lg navbar-light fixed-top\">\n      <div className=\"container\">\n        <Link className=\"navbar-brand\" to=\"/\">\n          {t(Conf.siteTitle)}\n        </Link>\n        <button\n          className=\"navbar-toggler\"\n          type=\"button\"\n          data-toggle=\"collapse\"\n          data-target=\"#navbarNavAltMarkup\"\n          aria-controls=\"navbarNavAltMarkup\"\n          aria-expanded=\"false\"\n          aria-label=\"Toggle navigation\"\n          onClick={onToggleButtonClick}\n        >\n          <span className=\"navbar-toggler-icon\"></span>\n        </button>\n        <div\n          className={`collapse navbar-collapse justify-content-end ${mobileVisible ? \"\" : \"d-none\"} d-lg-block`}\n          id=\"navbarNavAltMarkup\"\n        >\n          <div className=\"navbar-nav\">\n            <NavLink className=\"nav-item nav-link\" activeClassName=\"active\" to=\"/\" isActive={isActive}>\n              {t(\"主页\")}\n            </NavLink>\n            {NAV_ITEMS.map(({ label, path }) => (\n              <NavLink key={path} className=\"nav-item nav-link\" activeClassName=\"active\" to={`/${path}`}>\n                {t(label)}\n              </NavLink>\n            ))}\n            <span className=\"sep\"></span>\n            {SITE_LINKS.map(({ label, domain, active }) => (\n              <a key={domain} className={clsx(\"nav-item nav-link\", active && \"active\")} href={`https://${domain}/`}>\n                {t(label)}\n              </a>\n            ))}\n            <span className=\"sep\"></span>\n            {LANGUAGES.map(({ label, code }) => (\n              <button\n                key={code}\n                className={clsx(\"nav-item nav-link\", i18n.language === code && \"active\")}\n                onClick={(e) => {\n                  e.preventDefault();\n                  i18n.changeLanguage(code);\n                }}\n              >\n                {label}\n              </button>\n            ))}\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","import React from \"react\";\nimport { Helmet } from \"react-helmet\";\nimport { useLocation } from \"react-router\";\nimport Conf from \"../../utils/conf\";\n\nexport default function CanonicalLink() {\n  const loc = useLocation();\n  return (\n    <Helmet>\n      <link rel=\"canonical\" href={`https://${Conf.canonicalDomain}${loc.pathname}`} />\n    </Helmet>\n  );\n}\n","import React from \"react\";\r\n\r\nimport { ModelProvider } from \"./model\";\r\nimport { DataAdapterProvider } from \"./dataAdapterProvider\";\r\nimport Loadable from \"../misc/customizedLoadable\";\r\nimport Loading from \"../misc/loading\";\r\n\r\nconst Routes = Loadable({\r\n  loader: () => import(\"./routes\"),\r\n  loading: () => <Loading />\r\n});\r\n\r\nexport default function GameRecords() {\r\n  // This makes data load in parallel with subcomponents\r\n  return (\r\n    <ModelProvider>\r\n      <DataAdapterProvider>\r\n        <Routes />\r\n      </DataAdapterProvider>\r\n    </ModelProvider>\r\n  );\r\n}\r\n","import React from \"react\";\n\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport Loadable from \"../misc/customizedLoadable\";\nimport Scroller from \"../misc/scroller\";\n\nimport { Container } from \"../layout\";\nimport { AppHeader } from \"./appHeader\";\nimport { MaintenanceHandler } from \"./maintenance\";\nimport Navbar from \"./navbar\";\nimport CanonicalLink from \"../misc/canonicalLink\";\nimport Loading from \"../misc/loading\";\nimport GameRecords from \"../gameRecords\";\nimport Tracker, { PageCategory } from \"../misc/tracker\";\nimport Conf from \"../../utils/conf\";\nimport { useTranslation } from \"react-i18next\";\n\nconst Helmet = Loadable({\n  loader: () => import(\"react-helmet\"),\n  loading: () => <></>,\n});\nconst Ranking = Loadable({\n  loader: () => import(\"../ranking\"),\n  loading: () => <Loading />,\n});\nconst Statistics = Loadable({\n  loader: () => import(\"../statistics\"),\n  loading: () => <Loading />,\n});\nconst RecentHighlight = Loadable({\n  loader: () => import(\"../recentHighlight\"),\n  loading: () => <Loading />,\n});\nconst ContestTools = Loadable({\n  loader: () => import(\"../contestTools\"),\n  loading: () => <Loading />,\n});\n\nfunction App() {\n  const { t, i18n } = useTranslation();\n  return (\n    <div className={\"lang-\" + i18n.language}>\n      <Router>\n        <Helmet defaultTitle={t(Conf.siteTitle)} titleTemplate={`%s | ${t(Conf.siteTitle)}`} />\n        <CanonicalLink />\n        <Tracker />\n        <Navbar />\n        <MaintenanceHandler>\n          <Scroller>\n            {Conf.showTopNotice ? <AppHeader /> : <></>}\n            <Container>\n              <Switch>\n                <Route path=\"/ranking\">\n                  <PageCategory category=\"Ranking\" />\n                  <Ranking />\n                </Route>\n                <Route path=\"/statistics\">\n                  <PageCategory category=\"Statistics\" />\n                  <Statistics />\n                </Route>\n                <Route path=\"/highlight\">\n                  <PageCategory category=\"RecentHighlight\" />\n                  <RecentHighlight />\n                </Route>\n                {Conf.features.contestTools ? <Route path=\"/contest-tools\"><ContestTools/></Route> : null}\n                <Route path=\"/\">\n                  <GameRecords />\n                </Route>\n              </Switch>\n            </Container>\n          </Scroller>\n        </MaintenanceHandler>\n      </Router>\n    </div>\n  );\n}\nexport default App;\n","import * as React from \"react\";\nimport { render } from \"react-dom\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport \"./i18n\";\n\nimport \"./styles/bootstrap-custom.scss\";\nimport \"./styles/styles.scss\";\n\nimport App from \"./components/app\";\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n\nserviceWorker.register({\n  onUpdate(registration) {\n    const waitingServiceWorker = registration.waiting || navigator.serviceWorker.controller;\n\n    if (waitingServiceWorker) {\n      if (waitingServiceWorker.state === \"activated\") {\n        window.location.reload();\n        return;\n      }\n      waitingServiceWorker.addEventListener(\"statechange\", event => {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        if (event.target && (event.target as any).state === \"activated\") {\n          window.location.reload();\n        }\n      });\n      waitingServiceWorker.postMessage({ type: \"SKIP_WAITING\" });\n    }\n  }\n});\n","/* eslint-disable @typescript-eslint/no-empty-function */\r\nimport dayjs from \"dayjs\";\r\nimport React, { useReducer, useContext, ReactChild, useMemo } from \"react\";\r\nimport { useHistory } from \"react-router\";\r\nimport { useEventCallback } from \"../../utils\";\r\nimport { generatePath } from \"./routes\";\r\n\r\nexport interface ListingModel {\r\n  type: undefined;\r\n  date: dayjs.ConfigType | null;\r\n  selectedMode: string;\r\n  searchText: string;\r\n}\r\nexport interface PlayerModel {\r\n  type: \"player\";\r\n  playerId: string;\r\n  startDate: dayjs.ConfigType | null;\r\n  endDate: dayjs.ConfigType | null;\r\n  selectedMode: string;\r\n  searchText: string;\r\n  rank: number | null;\r\n}\r\nexport type Model = ListingModel | PlayerModel;\r\nexport const Model = Object.freeze({\r\n  removeExtraParams(model: Model): Model {\r\n    if (model.type === \"player\") {\r\n      return {\r\n        type: \"player\",\r\n        playerId: model.playerId,\r\n        selectedMode: \"\",\r\n        startDate: null,\r\n        endDate: null,\r\n        searchText: \"\",\r\n        rank: null,\r\n      };\r\n    }\r\n    return {\r\n      type: undefined,\r\n      searchText: \"\",\r\n      selectedMode: \"\",\r\n      date: null,\r\n    };\r\n  },\r\n});\r\ntype ModelUpdate = Partial<ListingModel> | ({ type: \"player\" } & Partial<PlayerModel>);\r\ntype DispatchModelUpdate = (props: ModelUpdate) => void;\r\n\r\nconst DEFAULT_MODEL: ListingModel = { type: undefined, date: null, selectedMode: \"\", searchText: \"\" };\r\nconst ModelContext = React.createContext<[Readonly<Model>, DispatchModelUpdate]>([DEFAULT_MODEL, () => {}]);\r\nexport const useModel = () => useContext(ModelContext);\r\n\r\nfunction normalizeUpdate(newProps: ModelUpdate): ModelUpdate {\r\n  if (newProps.type === undefined) {\r\n    if (newProps.date) {\r\n      newProps.date = dayjs(newProps.date).valueOf();\r\n    }\r\n  }\r\n  for (const key of Object.keys(newProps)) {\r\n    if (key !== \"type\" && newProps[key as keyof typeof newProps] === undefined) {\r\n      delete newProps[key as keyof typeof newProps];\r\n    }\r\n  }\r\n  return newProps;\r\n}\r\nfunction isSameModel(a: Model, b: Model): boolean {\r\n  return generatePath(a) === generatePath(b);\r\n}\r\n\r\nconst OnRouteModelUpdatedContext = React.createContext((() => {}) as (model: Model) => void);\r\nexport const useOnRouteModelUpdated = () => useContext(OnRouteModelUpdatedContext);\r\n\r\nexport function ModelProvider({ children }: { children: ReactChild | ReactChild[] }) {\r\n  const history = useHistory();\r\n  const [model, setModel] = useReducer(\r\n    (oldModel, newModel: Model): Readonly<Model> => {\r\n      if (isSameModel(oldModel, newModel)) {\r\n        return oldModel;\r\n      }\r\n      return Object.freeze(newModel);\r\n    },\r\n    undefined,\r\n    () => Object.freeze(DEFAULT_MODEL as Model)\r\n  );\r\n  const dispatchModelUpdate = useEventCallback(\r\n    (newProps: ModelUpdate) => {\r\n      const newModel = {\r\n        ...((model.type === newProps.type ? model : {}) as Model),\r\n        ...(normalizeUpdate(newProps) as Model),\r\n      };\r\n      if (isSameModel(model, newModel)) {\r\n        return;\r\n      }\r\n      history.replace(generatePath(newModel));\r\n    },\r\n    [model, history]\r\n  );\r\n  const value = useMemo(() => [model, dispatchModelUpdate] as [Readonly<Model>, DispatchModelUpdate], [\r\n    model,\r\n    dispatchModelUpdate,\r\n  ]);\r\n  return (\r\n    <ModelContext.Provider value={value}>\r\n      <OnRouteModelUpdatedContext.Provider value={setModel}>{children}</OnRouteModelUpdatedContext.Provider>\r\n    </ModelContext.Provider>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { useCallback, useEffect, useMemo } from \"react\";\nimport { TableCellProps, Index } from \"react-virtualized\";\nimport { Table, Column } from \"react-virtualized/dist/es/Table\";\nimport { AutoSizer } from \"react-virtualized/dist/es/AutoSizer\";\nimport dayjs from \"dayjs\";\nimport clsx from \"clsx\";\n\nimport { GameRecord, modeLabel } from \"../../data/types\";\nimport { Player } from \"./player\";\nimport { useScrollerProps } from \"../misc/scroller\";\nimport { useDataAdapter } from \"./dataAdapterProvider\";\nimport { triggerRelayout, isMobile } from \"../../utils/index\";\nimport Loading from \"../misc/loading\";\nimport Conf from \"../../utils/conf\";\nimport { Trans, useTranslation } from \"react-i18next\";\nimport i18n from \"../../i18n\";\n\nexport { Column } from \"react-virtualized/dist/es/Table\";\n\nconst formatTime = (x: number) => (x ? dayjs.unix(x).format(\"HH:mm\") : null);\n\ntype ActivePlayerId = number | string | ((x: GameRecord) => number | string);\n\nconst Players = React.memo(\n  ({ game, activePlayerId }: { game: GameRecord; activePlayerId?: ActivePlayerId; language?: string }) => {\n    if (typeof activePlayerId === \"function\") {\n      activePlayerId = activePlayerId(game);\n    }\n    if (typeof activePlayerId !== \"string\") {\n      activePlayerId = activePlayerId?.toString() || \"\";\n    }\n    return (\n      <div className=\"row no-gutters\">\n        {game.players.map((x) => (\n          <div key={x.accountId} className=\"col-12 col-md-6 pr-1\">\n            <Player game={game} player={x} isActive={x.accountId.toString() === activePlayerId} />\n          </div>\n        ))}\n      </div>\n    );\n  }\n);\n\nconst cellFormatTime = ({ cellData }: TableCellProps) => formatTime(cellData);\nconst cellFormatFullTime = ({ rowData }: TableCellProps) =>\n  rowData.loading ? \"\" : isMobile() ? GameRecord.formatStartDate(rowData) : GameRecord.formatFullStartTime(rowData);\nconst cellFormatRank = ({ rowData, columnData }: TableCellProps) =>\n  !rowData || rowData.loading || !columnData.activePlayerId ? (\n    \"\"\n  ) : (\n    <span\n      className=\"font-weight-bold\"\n      style={{ color: GameRecord.getPlayerRankColor(rowData, columnData.activePlayerId) }}\n    >\n      {GameRecord.getPlayerRankLabel(rowData, columnData.activePlayerId).slice(0, 1)}\n    </span>\n  );\nconst cellFormatGameMode = ({ cellData }: TableCellProps) => (cellData ? modeLabel(parseInt(cellData)) : \"\");\n\nfunction getRowHeight() {\n  if (window.matchMedia(\"(min-width: 768px)\").matches) {\n    return 70;\n  }\n  if (!isMobile()) {\n    return 140;\n  }\n  return 100;\n}\n\ntype TableColumnDefKey = {\n  key?: string;\n};\nexport type TableColumn = React.FunctionComponentElement<Column> | false | undefined | null;\nexport type TableColumnDef = TableColumnDefKey & (() => TableColumn);\n\nexport function makeColumn<T extends (string | number | Function)[]>(\n  builder: (...args: T) => TableColumn\n): (...args: T) => TableColumnDef {\n  const key = Math.random().toString();\n  const newBuilder = (...args: T) => {\n    const outer = () => {\n      const ret = builder(...args);\n      if (ret) {\n        return React.cloneElement(ret, { key });\n      }\n      return ret;\n    };\n    outer.key = key + args.join(\"-\");\n    return outer;\n  };\n  return newBuilder;\n}\n\nexport const COLUMN_GAMEMODE = makeColumn(\n  () =>\n    Conf.table.showGameMode && (\n      <Column\n        dataKey=\"modeId\"\n        label={isMobile() ? \"\" : <Trans>等级</Trans>}\n        cellRenderer={cellFormatGameMode}\n        width={isMobile() ? 20 : 40}\n        className=\"mobile-vertical\"\n      />\n    )\n)();\n\nexport const COLUMN_RANK = makeColumn((activePlayerId: number | string) => (\n  <Column\n    dataKey=\"modeId\"\n    label={isMobile() ? \"\" : <Trans>顺位</Trans>}\n    columnData={{ activePlayerId }}\n    cellRenderer={cellFormatRank}\n    width={isMobile() ? 20 : 40}\n  />\n));\n\nexport const COLUMN_PLAYERS = makeColumn((activePlayerId: ActivePlayerId) => (\n  <Column\n    dataKey=\"players\"\n    label={<Trans>玩家</Trans>}\n    cellRenderer={({ rowData }: TableCellProps) =>\n      rowData && rowData.players ? (\n        <Players game={rowData} activePlayerId={activePlayerId} language={i18n.language} />\n      ) : null\n    }\n    width={120}\n    flexGrow={1}\n  />\n));\n\nexport const COLUMN_STARTTIME = makeColumn(() => (\n  <Column\n    dataKey=\"startTime\"\n    label={<Trans>开始</Trans>}\n    cellRenderer={cellFormatTime}\n    width={isMobile() ? 40 : 50}\n    className=\"text-right\"\n    headerClassName=\"text-right\"\n  />\n))();\n\nexport const COLUMN_ENDTIME = makeColumn(() => (\n  <Column\n    dataKey=\"endTime\"\n    label={<Trans>结束</Trans>}\n    cellRenderer={cellFormatTime}\n    width={isMobile() ? 40 : 50}\n    headerClassName=\"text-right\"\n    className=\"text-right\"\n  />\n))();\n\nexport const COLUMN_FULLTIME = makeColumn(() => (\n  <Column\n    dataKey=\"startTime\"\n    label={<Trans>时间</Trans>}\n    cellRenderer={cellFormatFullTime}\n    width={isMobile() ? 40 : 150}\n    className=\"text-right\"\n    headerClassName=\"text-right\"\n  />\n))();\n\nexport default function GameRecordTable({\n  columns,\n  withActivePlayer = false,\n  alwaysShowDetailLink = false,\n}: {\n  columns: TableColumnDef[];\n  withActivePlayer?: boolean;\n  alwaysShowDetailLink?: boolean;\n}) {\n  const { i18n } = useTranslation();\n  const data = useDataAdapter();\n  const scrollerProps = useScrollerProps();\n  const { isScrolling, onChildScroll, scrollTop, height, registerChild } = scrollerProps;\n  const rowGetter = useCallback(({ index }: Index) => data.getItem(index), [data]);\n  const getRowClassName = useCallback(\n    ({ index }: Index) => (index >= 0 ? clsx({ loading: !data.isItemLoaded(index), even: (index & 1) === 0 }) : \"\"),\n    [data]\n  );\n  const noRowsRenderer = useCallback(() => (data.getUnfilteredCount() ? null : <Loading />), [data]);\n  const unfilteredCount = data.getUnfilteredCount();\n  const shouldTriggerLayout = !!unfilteredCount;\n  useEffect(() => {\n    triggerRelayout();\n  }, [shouldTriggerLayout]);\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const memoColumns = useMemo(() => columns.map((x) => x()).filter((x) => x), [\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    isMobile(),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    i18n.language,\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    ...columns.map((x) => x.key || x),\n  ]);\n  return (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    <div ref={registerChild as any} className=\"font-xs-adjust\">\n      <AutoSizer disableHeight>\n        {({ width }) => (\n          <Table\n            autoHeight\n            className={clsx(\n              withActivePlayer && \"with-active-player\",\n              alwaysShowDetailLink && \"always-show-detail-link\"\n            )}\n            rowCount={data.getCount()}\n            rowGetter={rowGetter}\n            rowHeight={getRowHeight()}\n            headerHeight={50}\n            width={width}\n            height={height}\n            isScrolling={isScrolling}\n            onScroll={onChildScroll}\n            scrollTop={scrollTop}\n            rowClassName={getRowClassName}\n            noRowsRenderer={noRowsRenderer}\n          >\n            {memoColumns}\n          </Table>\n        )}\n      </AutoSizer>\n    </div>\n  );\n}\n","import Loadable from \"react-loadable\";\nimport { LoadableComponent, Options } from \"react-loadable\";\n\nfunction CustomizedLoadable<Props, Exports extends object>(\n  options: Options<Props, Exports>\n): React.ComponentType<Props> & LoadableComponent {\n  return Loadable<Props, Exports>({ delay: 200, ...options });\n}\n\nexport default CustomizedLoadable;\n","import i18n from \"../../i18n\";\n\nconst t = i18n.getFixedT(null, \"gameModeShort\");\n\nexport enum GameMode {\n  王座 = 16,\n  玉 = 12,\n  金 = 9,\n  三金 = 22,\n  三玉 = 24,\n  三王座 = 26,\n}\nexport function modeLabel(mode: GameMode) {\n  return t(GameMode[mode].replace(/^三/, \"\"));\n}\n","export const PLAYER_RANKS = \"初士杰豪圣魂\";\nexport const RANK_LABELS = [\"一位\", \"二位\", \"三位\", \"四位\"];\n","import React from \"react\";\nimport dayjs from \"dayjs\";\n\nimport { useParams, useLocation, Redirect } from \"react-router\";\nimport { Model, useOnRouteModelUpdated } from \"./model\";\nimport { useEffect } from \"react\";\nimport { scrollToTop, triggerRelayout } from \"../../utils/index\";\nimport Conf from \"../../utils/conf\";\n\ntype ListingRouteParams = {\n  date?: string;\n  mode?: string;\n  search?: string;\n};\n\ntype PlayerRouteParams = {\n  id: string;\n  startDate?: string;\n  endDate?: string;\n  mode?: string;\n  search?: string;\n  rank?: string;\n};\n\nfunction parseOptionalDate<T>(s: string | null | undefined, defaultValue: T): dayjs.Dayjs | T {\n  return s ? dayjs(s, \"YYYY-MM-DD\") : defaultValue;\n}\n\nconst ModelBuilders = {\n  player(params: PlayerRouteParams): Model | string {\n    if (params.rank) {\n      const rank = parseInt(params.rank);\n      if (!rank || rank < 1 || rank > Conf.rankColors.length) {\n        delete params.rank;\n      }\n    }\n    return {\n      type: \"player\",\n      playerId: params.id,\n      startDate: parseOptionalDate(params.startDate, null),\n      endDate: parseOptionalDate(params.endDate, null),\n      selectedMode: params.mode || \"\",\n      searchText: params.search ? params.search.slice(1) : \"\",\n      rank: parseInt(params.rank || \"\") || null\n    };\n  },\n  listing(params: ListingRouteParams): Model | string {\n    const date = parseOptionalDate(params.date, null);\n    if (date && !date.isValid()) {\n      return \"/\";\n    }\n    return {\n      type: undefined,\n      date: date ? date.startOf(\"day\").valueOf() : null,\n      selectedMode: params.mode || \"\",\n      searchText: params.search || \"\"\n    };\n  },\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function RouteSync({ view }: { view: keyof typeof ModelBuilders }): React.FunctionComponentElement<any> {\n  useEffect(() => {\n    triggerRelayout();\n    scrollToTop();\n    return scrollToTop;\n  }, []);\n  const onRouteModelUpdated = useOnRouteModelUpdated();\n  const params = useParams();\n  const location = useLocation();\n  const query = new URLSearchParams(location.search);\n  Object.assign(params, {\n    rank: query.get(\"rank\"),\n  });\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const modelResult = ModelBuilders[view](params as any);\n  if (typeof modelResult === \"string\") {\n    return <Redirect to={modelResult} />;\n  }\n  onRouteModelUpdated(modelResult);\n  return <></>;\n}\n","import { useCallback } from \"react\";\r\nimport React from \"react\";\r\n\r\nimport { FormRow, DatePicker } from \"../form\";\r\nimport { useModel } from \"./model\";\r\nimport dayjs from \"dayjs\";\r\nimport { ModeSelector } from \"./modeSelector\";\r\nimport Conf from \"../../utils/conf\";\r\n\r\nconst DEFAULT_DATE = dayjs().startOf(\"day\");\r\n\r\nexport function FilterPanel() {\r\n  const [model, updateModel] = useModel();\r\n  const updateSearchTextFromEvent = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => updateModel({ searchText: e.currentTarget.value }),\r\n    [updateModel]\r\n  );\r\n  const setMode = useCallback((mode: string) => updateModel({ selectedMode: mode }), [updateModel]);\r\n  const setDate = useCallback((date: dayjs.ConfigType) => updateModel({ date }), [updateModel]);\r\n  if (model.type !== undefined) {\r\n    return null;\r\n  }\r\n  return (\r\n    <>\r\n      <FormRow title=\"日期\">\r\n        <DatePicker min={Conf.dateMin} date={model.date || DEFAULT_DATE} onChange={setDate} className=\"form-control\" />\r\n      </FormRow>\r\n      <FormRow title=\"查找玩家\">\r\n        <input type=\"text\" className=\"form-control\" value={model.searchText} onChange={updateSearchTextFromEvent} />\r\n      </FormRow>\r\n      {Conf.availableModes.length > 1 && (\r\n        <FormRow>\r\n          <ModeSelector mode={model.selectedMode} onChange={setMode} />\r\n        </FormRow>\r\n      )}\r\n    </>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { useEffect, useState, useMemo } from \"react\";\n\nimport { useModel } from \"./model\";\nimport Loading from \"../misc/loading\";\nimport { PlayerMetadataLite, getLevelTag } from \"../../data/types\";\nimport { searchPlayer } from \"../../data/source/misc\";\nimport { Link } from \"react-router-dom\";\nimport { generatePlayerPathById } from \"./routes\";\nimport { useTranslation } from \"react-i18next\";\n\nconst playerSearchCache = {} as { [prefix: string]: PlayerMetadataLite[] | Promise<PlayerMetadataLite[]> };\nconst NUM_RESULTS_SHOWN = 6;\nconst NUM_FETCH = 20;\n\nconst normalizeName = (s: string) => s.toLowerCase().trim();\n\nfunction findRawResultFromCache(prefix: string): { result: PlayerMetadataLite[]; isExactMatch: boolean } | null {\n  const normalizedPrefix = normalizeName(prefix);\n  prefix = normalizedPrefix;\n  while (prefix) {\n    const players = playerSearchCache[prefix];\n    if (!players || players instanceof Promise) {\n      prefix = prefix.slice(0, prefix.length - 1);\n      continue;\n    }\n    return {\n      isExactMatch: prefix === normalizedPrefix,\n      result: players,\n    };\n  }\n  return null;\n}\n\nfunction PlayerSearchResult({ searchText }: { searchText: string }) {\n  const { t } = useTranslation();\n  const [version, setVersion] = useState(0);\n  const [players, isLoading, mayHaveMore] = useMemo(() => {\n    const cachedResult = findRawResultFromCache(searchText);\n    if (!cachedResult) {\n      return [[], true];\n    }\n    if (cachedResult.isExactMatch) {\n      return [cachedResult.result, false];\n    }\n    const normalizedPrefix = normalizeName(searchText);\n    let mayHaveMore = cachedResult.result.length >= NUM_FETCH;\n    const filteredPlayers = [] as PlayerMetadataLite[];\n    cachedResult.result.forEach((player) => {\n      if (normalizeName(player.nickname).startsWith(normalizedPrefix)) {\n        filteredPlayers.push(player);\n      } else if (filteredPlayers.length) {\n        // Result covers all players who have the specified prefix\n        mayHaveMore = false;\n      }\n    });\n    return [filteredPlayers, mayHaveMore && filteredPlayers.length < NUM_RESULTS_SHOWN, mayHaveMore];\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchText, version]);\n  useEffect(() => {\n    const prefix = normalizeName(searchText);\n    if (playerSearchCache[prefix]) {\n      return;\n    }\n    if (!isLoading) {\n      return;\n    }\n    let cancelled = false;\n    let debounceToken: NodeJS.Timeout | undefined = setTimeout(() => {\n      debounceToken = undefined;\n      if (cancelled) {\n        return;\n      }\n      if (playerSearchCache[prefix]) {\n        return;\n      }\n      playerSearchCache[prefix] = searchPlayer(prefix).then(function (players) {\n        playerSearchCache[prefix] = players;\n        if (!cancelled) {\n          setVersion(new Date().getTime());\n        }\n        return players;\n      });\n    }, 500);\n    return () => {\n      cancelled = true;\n      if (debounceToken) {\n        clearTimeout(debounceToken);\n      }\n    };\n  }, [searchText, isLoading]);\n  return (\n    <>\n      <h6 className=\"text-center mb-2\">{t(\"玩家前缀搜索\")}</h6>\n      <ul className=\"list-unstyled mb-2\">\n        {players.slice(0, NUM_RESULTS_SHOWN).map((x) => (\n          <li key={x.id}>\n            <Link to={generatePlayerPathById(x.id)}>\n              <span>\n                [{getLevelTag(x.level.id)}] {x.nickname}\n              </span>\n            </Link>\n          </li>\n        ))}\n      </ul>\n      {(isLoading && <Loading size=\"small\" />) ||\n        ((players.length > NUM_RESULTS_SHOWN || mayHaveMore) && (\n          <small className=\"d-block text-center text-muted\">{t(\"（输入更长名字显示其它结果）\")}</small>\n        ))}\n    </>\n  );\n}\n\nexport function PlayerSearch({ className = \"player-search\" }) {\n  const [model] = useModel();\n  if (\"playerId\" in model || !model.searchText) {\n    return <></>;\n  }\n  return (\n    <div className={className}>\n      <PlayerSearchResult searchText={model.searchText} />\n    </div>\n  );\n}\n","import React from \"react\";\n\nimport { Switch, Route, Redirect, generatePath as genPath } from \"react-router-dom\";\n\nimport { Model, useModel } from \"./model\";\nimport dayjs from \"dayjs\";\nimport { RouteSync } from \"./routeSync\";\nimport { FilterPanel } from \"./filterPanel\";\nimport Loadable from \"../misc/customizedLoadable\";\nimport Loading from \"../misc/loading\";\nimport { PlayerSearch } from \"./playerSearch\";\nimport { COLUMN_RANK } from \"./table\";\nimport {\n  default as GameRecordTable,\n  COLUMN_GAMEMODE,\n  COLUMN_PLAYERS,\n  COLUMN_STARTTIME,\n  COLUMN_ENDTIME,\n  COLUMN_FULLTIME,\n} from \"./table\";\nimport { PageCategory } from \"../misc/tracker\";\nconst PlayerDetails = Loadable({\n  loader: () => import(\"../playerDetails/playerDetails\"),\n  loading: () => <Loading />,\n});\n\nconst PLAYER_PATH =\n  \"/player/:id/:mode([0-9]+)?/:search(-[^/]+)?/:startDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?/:endDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?\";\nconst PATH = \"/:date(\\\\d{4}-\\\\d{2}-\\\\d{2})/:mode([0-9]+)?/:search?\";\n\nexport function generatePath(model: Model): string {\n  if (model.type === \"player\") {\n    let result = genPath(PLAYER_PATH, {\n      id: model.playerId,\n      startDate: model.startDate ? dayjs(model.startDate).format(\"YYYY-MM-DD\") : undefined,\n      endDate: model.endDate ? dayjs(model.endDate).format(\"YYYY-MM-DD\") : undefined,\n      mode: model.selectedMode || undefined,\n      search: model.searchText ? \"-\" + model.searchText : undefined,\n    });\n    if (model.rank) {\n      result += `?rank=${model.rank}`;\n    }\n    return result;\n  }\n  if (!model.selectedMode && !model.searchText && !model.date) {\n    return \"/\";\n  }\n  return genPath(PATH, {\n    date: dayjs(model.date || new Date()).format(\"YYYY-MM-DD\"),\n    mode: model.selectedMode || undefined,\n    search: model.searchText || undefined,\n  });\n}\nexport function generatePlayerPathById(playerId: number | string): string {\n  return generatePath({\n    type: \"player\",\n    playerId: playerId.toString(),\n    startDate: null,\n    endDate: null,\n    selectedMode: \"\",\n    searchText: \"\",\n    rank: null,\n  });\n}\n\nfunction GameRecordTablePlayerView() {\n  const [model] = useModel();\n  if (!(\"playerId\" in model)) {\n    return null;\n  }\n  return (\n    <GameRecordTable\n      withActivePlayer\n      columns={[COLUMN_GAMEMODE, COLUMN_RANK(model.playerId), COLUMN_PLAYERS(model.playerId), COLUMN_FULLTIME]}\n    />\n  );\n}\n\nfunction Routes() {\n  return (\n    <Switch>\n      <Route path={PLAYER_PATH}>\n        <RouteSync view=\"player\" />\n        <PageCategory category=\"Player\" />\n        <PlayerDetails />\n        <GameRecordTablePlayerView />\n      </Route>\n      <Route exact path={[\"/\", PATH]}>\n        <RouteSync view=\"listing\" />\n        <PageCategory category=\"Listing\" />\n        <div className=\"home-header\">\n          <FilterPanel />\n          <PlayerSearch />\n        </div>\n        <GameRecordTable columns={[COLUMN_GAMEMODE, COLUMN_PLAYERS(\"\"), COLUMN_STARTTIME, COLUMN_ENDTIME]} />\n      </Route>\n      <Route>\n        <Redirect to=\"/\" />\n      </Route>\n    </Switch>\n  );\n}\nexport default Routes;\n","import { useLocation } from \"react-router\";\nimport React, { useEffect, useLayoutEffect } from \"react\";\nimport Helmet from \"react-helmet\";\nimport Conf from \"../../utils/conf\";\n\nlet currentCategory = \"Home\";\n\ntype Ga = NonNullable<typeof window.ga>;\n\ndeclare global {\n  interface Window {\n    __loadGa?: () => Ga;\n  }\n}\n\nexport function PageCategory({ category }: { category: string }) {\n  useLayoutEffect(() => {\n    const oldCategory = currentCategory;\n    currentCategory = category;\n    return () => {\n      currentCategory = oldCategory;\n    };\n  }, [category]);\n  return null;\n}\n\nfunction TrackerImpl() {\n  const loc = useLocation();\n  useEffect(() => {\n    let cancelled = false;\n    window.requestAnimationFrame(() => {\n      if (cancelled) {\n        return;\n      }\n      const helmet = Helmet.peek();\n      const title = (helmet.title || document.title).toString();\n      window.ga(\"send\", {\n        hitType: \"pageview\",\n        page: loc.pathname,\n        title: `${currentCategory} ${title}`,\n        contentGroup1: currentCategory\n      });\n    });\n    return () => {\n      cancelled = true;\n    };\n  }, [loc.pathname]);\n  return null;\n}\n\nexport default function Tracker() {\n  if (process.env.NODE_ENV !== \"production\") {\n    return null;\n  }\n  if (window.location.host !== Conf.canonicalDomain) {\n    return null;\n  }\n  if (!window.__loadGa) {\n    return null;\n  }\n  window.__loadGa();\n  return <TrackerImpl />;\n}\n","import React from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport interface CheckboxItem {\r\n  key: string;\r\n  label: string;\r\n}\r\n\r\ntype CommonGroupParams = {\r\n  items: CheckboxItem[];\r\n  groupKey: string;\r\n};\r\ntype CheckboxGroupParams = CommonGroupParams & {\r\n  type: \"checkbox\";\r\n  selectedItemKeys: Set<string> | null;\r\n  onChange: (selectedItemKeys: Set<string>) => void;\r\n};\r\ntype RadioGroupParams = CommonGroupParams & {\r\n  type: \"radio\";\r\n  selectedItemKey: string;\r\n  onChange: (selectedItemKey: string) => void;\r\n};\r\n\r\nexport function CheckboxGroup(\r\n  props: CheckboxGroupParams | RadioGroupParams = {\r\n    type: \"checkbox\",\r\n    items: [],\r\n    groupKey: \"default\",\r\n    selectedItemKeys: null,\r\n    // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n    onChange: () => {}\r\n  }\r\n) {\r\n  const { t } = useTranslation();\r\n  const { type, items, groupKey } = props;\r\n  const { setSelected, isChecked } = (() => {\r\n    if (props.type === \"checkbox\") {\r\n      const { selectedItemKeys, onChange } = props;\r\n      return {\r\n        setSelected(key: string, isSelected: boolean) {\r\n          if (isSelected && (!selectedItemKeys || selectedItemKeys.has(key))) {\r\n            return;\r\n          }\r\n          if (!isSelected && selectedItemKeys && !selectedItemKeys.has(key)) {\r\n            return;\r\n          }\r\n          const newSet = new Set(selectedItemKeys || items.map(x => x.key));\r\n          if (isSelected) {\r\n            newSet.add(key);\r\n          } else {\r\n            newSet.delete(key);\r\n          }\r\n          onChange(newSet);\r\n        },\r\n        isChecked: (key: string) => !selectedItemKeys || selectedItemKeys.has(key)\r\n      };\r\n    } else {\r\n      const { selectedItemKey, onChange } = props;\r\n      return {\r\n        setSelected(key: string, isSelected: boolean) {\r\n          if (!isSelected) {\r\n            return;\r\n          }\r\n          onChange(key);\r\n        },\r\n        isChecked: (key: string) => selectedItemKey === key\r\n      };\r\n    }\r\n  })();\r\n  return (\r\n    <React.Fragment>\r\n      {items.map(item => (\r\n        <div className=\"form-check form-check-inline\" key={item.key}>\r\n          <input\r\n            className=\"form-check-input\"\r\n            type={type}\r\n            id={`CG_${groupKey}_${item.key}`}\r\n            name={`CG_${groupKey}_${item.key}`}\r\n            value={item.key}\r\n            checked={isChecked(item.key)}\r\n            onChange={event => setSelected(item.key, event.currentTarget.checked)}\r\n          />\r\n          <label className=\"form-check-label\" htmlFor={`CG_${groupKey}_${item.key}`}>\r\n            {t(item.label)}\r\n          </label>\r\n        </div>\r\n      ))}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nimport dayjs from \"dayjs\";\r\nimport { useCallback } from \"react\";\r\n\r\nexport function DatePicker({\r\n  date = dayjs() as dayjs.ConfigType,\r\n  onChange = (() => {}) as (_: dayjs.Dayjs) => void,\r\n  className = \"\",\r\n  min = 0 as dayjs.ConfigType,\r\n  max = dayjs() as dayjs.ConfigType\r\n}) {\r\n  const handleChange = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => onChange(dayjs(e.currentTarget.value, \"YYYY-MM-DD\")),\r\n    [onChange]\r\n  );\r\n  return (\r\n    <input\r\n      className={className}\r\n      type=\"date\"\r\n      value={dayjs(date).format(\"YYYY-MM-DD\")}\r\n      min={min ? dayjs(min).format(\"YYYY-MM-DD\") : undefined}\r\n      max={max ? dayjs(max).format(\"YYYY-MM-DD\") : undefined}\r\n      onChange={handleChange}\r\n    />\r\n  );\r\n}\r\n","export * from \"./checkboxGroup\";\r\nexport * from \"./datePicker\";\r\nexport * from \"./formRow\";\r\n","import { GameMode } from \"./gameMode\";\nimport { PLAYER_RANKS } from \"./constants\";\nimport i18n from \"../../i18n\";\n\nconst t = i18n.t.bind(i18n);\n\nconst LEVEL_MAX_POINTS = [20, 80, 200, 600, 800, 1000, 1200, 1400, 2000, 2800, 3200, 3600, 4000, 6000, 9000];\nconst LEVEL_PENALTY = [0, 0, 0, 20, 40, 60, 80, 100, 120, 165, 180, 195, 210, 225, 240, 255];\nconst LEVEL_PENALTY_3 = [0, 0, 0, 20, 40, 60, 80, 100, 120, 165, 190, 215, 240, 265, 290, 320];\n\nconst LEVEL_ALLOWED_MODES: { [key: number]: GameMode[] } = {\n  101: [],\n  102: [],\n  103: [GameMode.金],\n  104: [GameMode.金, GameMode.玉],\n  105: [GameMode.玉, GameMode.王座],\n  106: [GameMode.王座],\n  201: [],\n  202: [],\n  203: [GameMode.三金],\n  204: [GameMode.三金, GameMode.三玉],\n  205: [GameMode.三玉, GameMode.三王座],\n  206: [GameMode.三王座],\n};\n\nexport function getTranslatedLevelTags(): string[] {\n  const rawTags = t(PLAYER_RANKS) as string;\n  if (rawTags.charCodeAt(0) > 127) {\n    return rawTags.split(\"\");\n  }\n  return Array(rawTags.length / 2)\n    .fill(\"\")\n    .map((_, index) => rawTags.slice(index * 2, index * 2 + 2));\n}\n\nexport class Level {\n  _majorRank: number;\n  _minorRank: number;\n  _numPlayerId: number;\n  constructor(levelId: number) {\n    const realId = levelId % 10000;\n    this._majorRank = Math.floor(realId / 100);\n    this._minorRank = realId % 100;\n    this._numPlayerId = Math.floor(levelId / 10000);\n  }\n  isSameMajorRank(other: Level): boolean {\n    return this._majorRank === other._majorRank;\n  }\n  isSame(other: Level): boolean {\n    return this._majorRank === other._majorRank && this._minorRank === other._minorRank;\n  }\n  isAllowedMode(mode: GameMode): boolean {\n    return LEVEL_ALLOWED_MODES[this._numPlayerId * 100 + this._majorRank].includes(mode);\n  }\n  getTag(): string {\n    const label = getTranslatedLevelTags()[this._majorRank - 1];\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return label;\n    }\n    return label + this._minorRank;\n  }\n  getMaxPoint(): number {\n    return LEVEL_MAX_POINTS[(this._majorRank - 1) * 3 + this._minorRank - 1];\n  }\n  getPenaltyPoint(): number {\n    return (this._numPlayerId === 2 ? LEVEL_PENALTY_3 : LEVEL_PENALTY)[(this._majorRank - 1) * 3 + this._minorRank - 1];\n  }\n  getStartingPoint(): number {\n    if (this._majorRank === 1) {\n      return 0;\n    }\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return 10000;\n    }\n    return this.getMaxPoint() / 2;\n  }\n  getNextLevel(): Level {\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank + 1;\n    if (minorRank > 3) {\n      majorRank++;\n      minorRank = 1;\n    }\n    return new Level(this._numPlayerId * 10000 + majorRank * 100 + minorRank);\n  }\n  getPreviousLevel(): Level {\n    if (this._majorRank === 1 && this._minorRank === 1) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank - 1;\n    if (minorRank < 1) {\n      majorRank--;\n      minorRank = 3;\n    }\n    return new Level(this._numPlayerId * 10000 + majorRank * 100 + minorRank);\n  }\n  getAdjustedLevel(score: number): Level {\n    let maxPoints = this.getMaxPoint();\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let level: Level = this;\n    if (maxPoints && score >= maxPoints) {\n      level = this.getNextLevel();\n      maxPoints = level.getMaxPoint();\n      score = level.getStartingPoint();\n    } else if (score < 0) {\n      if (!maxPoints || level._majorRank === 1 || (level._majorRank === 2 && level._minorRank === 1)) {\n        score = 0;\n      } else {\n        level = this.getPreviousLevel();\n        maxPoints = level.getMaxPoint();\n        score = level.getStartingPoint();\n      }\n    }\n    return level;\n  }\n  formatAdjustedScoreWithTag(score: number) {\n    const level = this.getAdjustedLevel(score);\n    return `${level.getTag()} - ${this.formatAdjustedScore(score)}`;\n  }\n  formatAdjustedScore(score: number) {\n    const level = this.getAdjustedLevel(score);\n    return `${level === this ? Math.max(score, 0) : level.getStartingPoint()}${\n      level.getMaxPoint() ? \"/\" + level.getMaxPoint() : \"\"\n    }`;\n  }\n}\nexport function getLevelTag(levelId: number) {\n  return new Level(levelId).getTag();\n}\nexport type LevelWithDelta = {\n  id: number;\n  score: number;\n  delta: number;\n};\nexport const LevelWithDelta = Object.freeze({\n  format(obj: LevelWithDelta): string {\n    return new Level(obj.id).formatAdjustedScoreWithTag(obj.score + obj.delta);\n  },\n  formatAdjustedScore(obj: LevelWithDelta): string {\n    return new Level(obj.id).formatAdjustedScore(obj.score + obj.delta);\n  },\n  getTag(obj: LevelWithDelta): string {\n    return LevelWithDelta.getAdjustedLevel(obj).getTag();\n  },\n  getAdjustedLevel(obj: LevelWithDelta): Level {\n    return new Level(obj.id).getAdjustedLevel(obj.score + obj.delta);\n  },\n});\n","import { useState, useEffect, useMemo, useRef, useCallback } from \"react\";\n\nexport function triggerRelayout() {\n  requestAnimationFrame(() => window.dispatchEvent(new UIEvent(\"resize\")));\n  setTimeout(function () {\n    window.dispatchEvent(new UIEvent(\"resize\"));\n  }, 200);\n}\nexport function scrollToTop() {\n  window.scrollTo(0, 0);\n  requestAnimationFrame(() => window.scrollTo(0, 0));\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const formatPercent = (x: any) => {\n  if (!x) {\n    return \"\";\n  }\n  if (x < 0.0001) {\n    return \"<0.01%\";\n  }\n  return `${(x * 100).toFixed(2)}%`;\n};\n\nexport const formatFixed3 = (x: number) => x.toFixed(3);\nexport const formatIdentity = (x: number) => x.toString();\n\nexport function useEventCallback<T extends unknown[]>(fn: (...args: T) => void, dependencies: React.DependencyList) {\n  const ref = useRef<(...args: T) => void>(() => {\n    throw new Error(\"Cannot call an event handler while rendering.\");\n  });\n\n  useEffect(() => {\n    ref.current = fn;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [fn, ...dependencies]);\n\n  return useCallback(\n    (...args) => {\n      const fn = ref.current;\n      return fn(...(args as T));\n    },\n    [ref]\n  );\n}\n\ntype NotFinished = { notFinished: string };\nconst NOT_FINISHED = { notFinished: \"yes\" };\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst __useAsyncCache = {} as { [key: string]: any };\n\nexport function useAsync<T>(maybePromise: T | Promise<T>, cacheKey?: string): T | undefined {\n  if (cacheKey && __useAsyncCache[cacheKey]) {\n    maybePromise = __useAsyncCache[cacheKey];\n  }\n  const [fulfilledValue, setFulfilledValue] = useState<T | NotFinished>(\n    maybePromise instanceof Promise ? NOT_FINISHED : maybePromise\n  );\n  useEffect(() => {\n    let cancelled = false;\n    if (maybePromise instanceof Promise) {\n      setFulfilledValue(NOT_FINISHED);\n      maybePromise.then((result) => {\n        if (cancelled) {\n          return;\n        }\n        if (cacheKey) {\n          __useAsyncCache[cacheKey] = result;\n        }\n        setFulfilledValue(result);\n      });\n    } else {\n      setFulfilledValue(maybePromise);\n    }\n    return () => {\n      cancelled = true;\n    };\n  }, [maybePromise, cacheKey]);\n  if (fulfilledValue !== NOT_FINISHED) {\n    return fulfilledValue as T;\n  }\n  return undefined;\n}\nexport function useAsyncFactory<T>(\n  factory: () => Promise<T>,\n  deps: React.DependencyList,\n  cacheKey?: string\n): T | undefined {\n  const promise = useMemo(factory, deps);\n  return useAsync(promise, cacheKey ? `${cacheKey}-${deps.join(\",\")}` : undefined);\n}\n\nexport function sum(numbers: number[]): number {\n  return numbers.reduce((a, b) => a + b, 0);\n}\n\nexport function isMobile() {\n  return !!window.matchMedia(\"(max-width: 575.75px)\").matches;\n}\n","import { useState, useEffect, useMemo, useCallback, useContext } from \"react\";\nimport React, { ReactChild } from \"react\";\nimport dayjs from \"dayjs\";\n\nimport { DataProvider, FilterPredicate } from \"../../data/source/records/provider\";\nimport { useModel, Model } from \"./model\";\nimport { Metadata, GameRecord } from \"../../data/types\";\nimport { generatePath } from \"./routes\";\n\ninterface ItemLoadingPlaceholder {\n  loading: boolean;\n}\n\nconst loadingPlaceholder = { loading: true };\n\n// eslint-disable-next-line @typescript-eslint/interface-name-prefix\nexport interface IDataAdapter {\n  getCount(): number;\n  getUnfilteredCount(): number;\n  getMetadata<T extends Metadata>(): T | null;\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder;\n  isItemLoaded(index: number): boolean;\n}\n\nclass DummyDataAdapter implements IDataAdapter {\n  getCount(): number {\n    return 0;\n  }\n  getUnfilteredCount(): number {\n    return 0;\n  }\n  getMetadata<T extends Metadata>(): T | null {\n    return null;\n  }\n  getItem(): GameRecord | ItemLoadingPlaceholder {\n    return loadingPlaceholder;\n  }\n  isItemLoaded(): boolean {\n    return false;\n  }\n}\n\nexport const DUMMY_DATA_ADAPTER = new DummyDataAdapter() as IDataAdapter;\n\n// eslint-disable-next-line @typescript-eslint/no-empty-function\nconst noop = () => {};\n\nclass DataAdapter implements IDataAdapter {\n  _provider: DataProvider;\n  _onDataUpdate: (isError: boolean) => void;\n  _triggeredRequest: boolean;\n\n  constructor(provider: DataProvider, onDataUpdate = noop) {\n    this._provider = provider;\n    this._onDataUpdate = onDataUpdate;\n    this._triggeredRequest = false;\n  }\n  _installHook<T>(promise: Promise<T>) {\n    if (this._triggeredRequest) {\n      return;\n    }\n    this._triggeredRequest = true;\n    promise.then(() => this._callHook(false)).catch(() => this._callHook(true));\n  }\n  _callHook(isError: boolean) {\n    this._onDataUpdate(isError);\n  }\n  getCount(): number {\n    const maybeCount = this._provider.getCountMaybeSync();\n    if (maybeCount instanceof Promise) {\n      this._installHook(maybeCount);\n      return 0;\n    }\n    return maybeCount;\n  }\n  getUnfilteredCount(): number {\n    return this._provider.getUnfilteredCountSync() || 0;\n  }\n  getMetadata<T extends Metadata>(): T | null {\n    return this._provider.getMetadataSync() as T | null;\n  }\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder {\n    if (index >= this.getCount()) {\n      return loadingPlaceholder;\n    }\n    if (this._provider.isItemLoaded(index)) {\n      return this._provider.getItem(index) as GameRecord;\n    }\n    if (!this._triggeredRequest) {\n      this._installHook(this._provider.getItem(index) as Promise<GameRecord>);\n    }\n    return loadingPlaceholder;\n  }\n  isItemLoaded(index: number): boolean {\n    if (index < 0) {\n      return false;\n    }\n    return this._provider.isItemLoaded(index);\n  }\n  setUpdateHook(hook: () => void) {\n    this._onDataUpdate = hook;\n  }\n  cancelUpdateHook() {\n    this._onDataUpdate = noop;\n  }\n}\n\nconst DataAdapterContext = React.createContext(DUMMY_DATA_ADAPTER);\n\nexport const useDataAdapter = () => useContext(DataAdapterContext);\nexport const DataAdapterConsumer = DataAdapterContext.Consumer;\n\nfunction getProviderKey(model: Model): string {\n  if (model.type === undefined) {\n    return dayjs(model.date || dayjs())\n      .startOf(\"day\")\n      .valueOf()\n      .toString();\n  } else if (model.type === \"player\") {\n    return generatePath(model);\n  }\n  throw new Error(\"Unknown model type\");\n}\n\nfunction createProvider(model: Model): DataProvider {\n  if (model.type === undefined) {\n    return DataProvider.createListing(model.date || dayjs().startOf(\"day\"));\n  }\n  if (model.type === \"player\") {\n    return DataProvider.createPlayer(model.playerId, model.startDate, model.endDate, model.selectedMode);\n  }\n  throw new Error(\"Not implemented\");\n}\n\nfunction usePredicate(model: Model): FilterPredicate {\n  let memoFunc: () => FilterPredicate = () => null;\n  let memoDeps: React.DependencyList = [null, \"\", false];\n  const searchText = (model.searchText || \"\").trim().toLowerCase() || \"\";\n  const needPredicate = searchText || model.selectedMode;\n  memoFunc = () =>\n    needPredicate\n      ? (game) => {\n          if (model.selectedMode && model.selectedMode !== game.modeId.toString()) {\n            return false;\n          }\n          if (!game.players.some((player) => player.nickname.toLowerCase().indexOf(searchText) > -1)) {\n            return false;\n          }\n          if (\n            \"rank\" in model &&\n            model.rank &&\n            GameRecord.getRankIndexByPlayer(game, model.playerId) !== model.rank - 1\n          ) {\n            return false;\n          }\n          return true;\n        }\n      : null;\n  memoDeps = [(model.type === undefined && model.selectedMode) || null, searchText, \"rank\" in model && model.rank];\n  return useMemo(memoFunc, memoDeps);\n}\n\nfunction useDataAdapterCommon(dataProvider: DataProvider, onError: () => void, deps: React.DependencyList) {\n  const [dataAdapter, setDataAdapter] = useState(() => DUMMY_DATA_ADAPTER);\n  const refreshDataAdapter = useCallback(\n    (isError?: boolean) => {\n      if (isError) {\n        onError();\n        return;\n      }\n      const adapter = new DataAdapter(dataProvider);\n      setDataAdapter(adapter);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [dataProvider, onError, ...deps]\n  );\n  useEffect(refreshDataAdapter, [refreshDataAdapter]);\n  useEffect(() => {\n    const adapter = dataAdapter;\n    if (adapter instanceof DataAdapter) {\n      return () => adapter.cancelUpdateHook();\n    }\n  }, [dataAdapter]);\n  useEffect(() => {\n    const adapter = dataAdapter;\n    if (adapter instanceof DataAdapter) {\n      adapter.setUpdateHook(refreshDataAdapter);\n    }\n  }, [dataAdapter, refreshDataAdapter]);\n  useEffect(() => {\n    dataProvider.getCountMaybeSync(); // Preload metadata\n  }, [dataProvider]);\n  return {\n    dataAdapter,\n  };\n}\n\nexport function DataAdapterProvider({ children }: { children: ReactChild | ReactChild[] }) {\n  const [model, updateModel] = useModel();\n  const [dataProviders] = useState(() => ({} as { [key: string]: DataProvider }));\n  const searchPredicate = usePredicate(model);\n  const dataProvider = useMemo(() => {\n    const key = getProviderKey(model);\n    if (!dataProviders[key]) {\n      dataProviders[key] = createProvider(model);\n    }\n    return dataProviders[key];\n  }, [model, dataProviders]);\n  useEffect(() => dataProvider.setFilterPredicate(searchPredicate), [dataProvider, searchPredicate]);\n  const onError = useCallback(() => updateModel(Model.removeExtraParams(model)), [model, updateModel]);\n  const { dataAdapter } = useDataAdapterCommon(dataProvider, onError, [model, searchPredicate]);\n  return <DataAdapterContext.Provider value={dataAdapter}>{children}</DataAdapterContext.Provider>;\n}\n\nexport function DataAdapterProviderCustom({\n  provider,\n  children,\n}: {\n  provider: DataProvider;\n  children: ReactChild | ReactChild[];\n}) {\n  const { dataAdapter } = useDataAdapterCommon(provider, noop, []);\n  return <DataAdapterContext.Provider value={dataAdapter}>{children}</DataAdapterContext.Provider>;\n}\n","export * from \"./constants\";\nexport * from \"./gameMode\";\nexport * from \"./level\";\nexport * from \"./metadata\";\nexport * from \"./record\";\nexport * from \"./ranking\";\nexport * from \"./statistics\";\nexport * from \"./utils\";\n","import { useState, useEffect, ReactNode } from \"react\";\r\nimport React from \"react\";\r\nimport { ReactComponentLike } from \"prop-types\";\r\nimport { triggerRelayout } from \"../../utils/index\";\r\n\r\nexport function Alert({\r\n  className = \"\",\r\n  type = \"info\",\r\n  container = React.Fragment as ReactComponentLike,\r\n  stateName = \"\",\r\n  closable = true,\r\n  children = undefined as ReactNode\r\n}) {\r\n  const stateKey = `alertState_${stateName}`;\r\n  const [closed, setClosed] = useState(() => stateName && !!localStorage.getItem(stateKey));\r\n  useEffect(() => {\r\n    if (stateName && closed) {\r\n      localStorage.setItem(stateKey, \"true\");\r\n    }\r\n  }, [closed, stateName, stateKey]);\r\n  if (closed && closable) {\r\n    return null;\r\n  }\r\n  const Cont = container;\r\n  return (\r\n    <Cont>\r\n      <div className={`alert alert-${type} alert-dismissible fade show ${className}`} role=\"alert\">\r\n        {children}\r\n        {closable && (\r\n          <button\r\n            type=\"button\"\r\n            className=\"close\"\r\n            data-dismiss=\"alert\"\r\n            aria-label=\"Close\"\r\n            onClick={event => {\r\n              event.preventDefault();\r\n              setClosed(true);\r\n              triggerRelayout();\r\n            }}\r\n          >\r\n            <span aria-hidden=\"true\">×</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n    </Cont>\r\n  );\r\n}\r\n","import i18n from \"../../i18n\";\nimport { RANK_LABELS } from \"./constants\";\n\nconst t = i18n.t.bind(i18n);\n\nexport function getRankLabelByIndex(index: number): string {\n  return t(RANK_LABELS[index]);\n}\n","import React, { ReactChild, useContext } from \"react\";\r\n\r\nimport { WindowScrollerChildProps } from \"react-virtualized\";\r\nimport { WindowScroller } from \"react-virtualized/dist/es/WindowScroller\";\r\n\r\nconst ScrollerContext = React.createContext<WindowScrollerChildProps>({} as any);\r\n\r\nexport const useScrollerProps = () => useContext(ScrollerContext);\r\n\r\nfunction Scroller({ children }: { children: ReactChild | ReactChild[] }) {\r\n  return (\r\n    <WindowScroller>\r\n      {scrollerProps => <ScrollerContext.Provider value={scrollerProps}>{children}</ScrollerContext.Provider>}\r\n    </WindowScroller>\r\n  );\r\n}\r\nexport default Scroller;\r\n","/* eslint-disable @typescript-eslint/camelcase */\nimport dayjs from \"dayjs\";\n\nimport { GameRecord, GameRecordWithEvent } from \"../../types/record\";\nimport { Metadata, PlayerMetadata, PlayerExtendedStats } from \"../../types/metadata\";\nimport { apiGet } from \"../api\";\n\nexport interface DataLoader<T extends Metadata, TRecord = GameRecord> {\n  getMetadata(): Promise<T>;\n  getRecords(skip: number, limit: number, cacheTag?: string): Promise<TRecord[]>;\n}\n\nexport class RecentHighlightDataLoader implements DataLoader<Metadata> {\n  _data: Promise<GameRecord[]>;\n  constructor(numItems = 100) {\n    this._data = apiGet<GameRecordWithEvent[]>(`recent_highlight_games?limit=${numItems}`)\n      .then((data) => {\n        if (data.every((x) => x.uuid)) {\n          return data; // Old API\n        }\n        return apiGet<GameRecordWithEvent[]>(`games_by_id/${data.map((x) => x._id).join(\",\")}`).then((records) => {\n          const recordMap = {} as { [key: string]: GameRecordWithEvent };\n          records.forEach((x) => (recordMap[x._id || \"\"] = x));\n          return data.map((x) => ({ ...x, ...recordMap[x._id || \"\"] }));\n        });\n      })\n      .then((data) => data.sort((a, b) => a.startTime - b.startTime));\n  }\n  async getMetadata(): Promise<Metadata> {\n    return this._data.then((x) => ({ count: x.length }));\n  }\n  async getRecords(skip: number, limit: number): Promise<GameRecord[]> {\n    return this._data.then((data) => data.slice(skip, skip + limit));\n  }\n}\n\nexport class ListingDataLoader implements DataLoader<Metadata> {\n  _date: dayjs.Dayjs;\n  constructor(date: dayjs.ConfigType) {\n    this._date = dayjs(date).startOf(\"day\");\n  }\n  async getMetadata(): Promise<Metadata> {\n    return await apiGet<Metadata>(`count/${this._date.valueOf()}`);\n  }\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\n    return await apiGet<GameRecord[]>(`games/${this._date.valueOf()}?skip=${skip}&limit=${limit}&tag=${cacheTag}`);\n  }\n}\n\nexport class PlayerDataLoader implements DataLoader<PlayerMetadata> {\n  _playerId: string;\n  _startDate?: dayjs.Dayjs;\n  _endDate?: dayjs.Dayjs;\n  _mode: string;\n  constructor(playerId: string, startDate?: dayjs.Dayjs, endDate?: dayjs.Dayjs, mode = \"\") {\n    this._playerId = playerId;\n    this._startDate = startDate;\n    this._endDate = endDate;\n    this._mode = mode;\n  }\n  _getDatePath(): string {\n    let result = \"\";\n    if (this._startDate) {\n      result += `/${this._startDate.valueOf()}`;\n      if (this._endDate) {\n        result += `/${this._endDate.valueOf()}`;\n      }\n    }\n    return result;\n  }\n  _getParams(): string {\n    return `${this._playerId}${this._getDatePath()}?mode=${this._mode}`;\n  }\n  async getMetadata(): Promise<PlayerMetadata> {\n    return await apiGet<PlayerMetadata>(`player_stats/${this._getParams()}`).then((stats) => {\n      stats.extended_stats = apiGet<PlayerExtendedStats>(`player_extended_stats/${this._getParams()}`).then(\n        (extendedStats) => (stats.extended_stats = extendedStats)\n      );\n      return stats;\n    });\n  }\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\n    return await apiGet<GameRecord[]>(\n      `player_records/${this._playerId}${this._getDatePath()}?skip=${skip}&limit=${limit}&mode=${\n        this._mode\n      }&tag=${cacheTag}`\n    );\n  }\n}\n","import dayjs from \"dayjs\";\n\nimport { GameRecord } from \"../../types/record\";\nimport { Metadata, PlayerMetadata } from \"../../types/metadata\";\nimport { ListingDataLoader, PlayerDataLoader, DataLoader, RecentHighlightDataLoader } from \"./loader\";\n\nexport type FilterPredicate<TRecord = GameRecord> = ((record: TRecord) => boolean) | null;\nclass DataProviderImpl<TMetadata extends Metadata, TRecord extends { uuid: string } = GameRecord> {\n  _loader: DataLoader<TMetadata, TRecord>;\n  _metadata: TMetadata | Promise<TMetadata> | null;\n  _countPromise: Promise<number> | null;\n  _chunks: (TRecord[] | Promise<TRecord[]>)[];\n  _itemsPerChunk: number;\n  _filterPredicate: FilterPredicate<TRecord>;\n  _filteredIndices: number[] | null;\n  _filterResultCache: { [uuid: string]: boolean };\n\n  constructor(loader: DataLoader<TMetadata, TRecord>, itemsPerChunk = 100) {\n    this._loader = loader;\n    this._metadata = null;\n    this._countPromise = null;\n    this._chunks = [];\n    this._itemsPerChunk = itemsPerChunk;\n    this._filterPredicate = null;\n    this._filteredIndices = null;\n    this._filterResultCache = {};\n  }\n  setFilterPredicate(predicate: FilterPredicate<TRecord>) {\n    if (this._filterPredicate === predicate) {\n      return;\n    }\n    this._filterPredicate = predicate;\n    this._filterResultCache = {};\n    this.updateFilteredIndices();\n  }\n  updateFilteredIndices() {\n    this._filteredIndices = null;\n    if (!this._filterPredicate) {\n      return;\n    }\n    const metadata = this.getMetadataSync();\n    if (!metadata) {\n      return;\n    }\n    const count = metadata.count;\n    let numShownItems = 0;\n    let numLoadedItems = 0;\n    const indices = [];\n    for (let i = 0; i < count; i++) {\n      const chunk = this._chunks[Math.floor(i / this._itemsPerChunk)];\n      if (!chunk || chunk instanceof Promise) {\n        indices.push(i);\n        continue;\n      }\n      numLoadedItems++;\n      const game = chunk[i % this._itemsPerChunk];\n      let result = this._filterResultCache[game.uuid];\n      if (result === undefined) {\n        this._filterResultCache[game.uuid] = result = this._filterPredicate(game);\n      }\n      if (result) {\n        indices.push(i);\n        numShownItems++;\n      }\n    }\n    this._filteredIndices = indices;\n    if (numShownItems < 10 && numLoadedItems >= this._itemsPerChunk) {\n      // this._triggerFullLoad();\n    }\n  }\n  getMetadataSync(): TMetadata | null {\n    return this._metadata && !(this._metadata instanceof Promise) ? this._metadata : null;\n  }\n  getCountMaybeSync(): number | Promise<number> {\n    const metadata = this.getMetadataSync();\n    if (metadata) {\n      return this._filteredIndices ? this._filteredIndices.length : metadata.count;\n    }\n    return this.getCount();\n  }\n  async getCount(): Promise<number> {\n    const metadata = this.getMetadataSync();\n    if (metadata) {\n      return this.getCountMaybeSync();\n    }\n    if (!this._metadata) {\n      this._metadata = this._loader.getMetadata().then(metadata => {\n        if (!metadata) {\n          console.log(\"No metadata returned\");\n          throw new Error(\"No metadata returned\");\n        }\n        this._metadata = metadata;\n        this.updateFilteredIndices();\n        this._countPromise = null;\n        return metadata;\n      });\n    }\n    if (this._countPromise) {\n      return this._countPromise;\n    }\n    this._countPromise = Promise.resolve(this._metadata)\n      .then(() => new Promise(resolve => setTimeout(resolve, 100)))\n      .then(() => this.getCountMaybeSync());\n    return this._countPromise;\n  }\n  getUnfilteredCountSync(): number | null {\n    const metadata = this.getMetadataSync();\n    if (!metadata) {\n      return null;\n    }\n    return metadata.count;\n  }\n  isItemLoaded(index: number): boolean {\n    const mappedIndex = this._mapItemIndex(index);\n    if (mappedIndex === null) {\n      return false;\n    }\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\n    return !!this._chunks[chunkNumber] && !(this._chunks[chunkNumber] instanceof Promise);\n  }\n  getItem(index: number, skipPreload = false): TRecord | Promise<TRecord | null> {\n    const mappedIndex = this._mapItemIndex(index);\n    if (mappedIndex === null) {\n      return this.getCount().then(count => {\n        if (index > count - 1 || this._mapItemIndex(index) === null) {\n          return null;\n        }\n        return this.getItem(index);\n      });\n    }\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\n    const innerIndex = mappedIndex % this._itemsPerChunk;\n    const chunk = this._chunks[chunkNumber];\n    if (!chunk || chunk instanceof Promise) {\n      return this._getChunk(chunkNumber).then(chunk => chunk[innerIndex]);\n    }\n    if (!skipPreload && !this._filteredIndices) {\n      this.preload(index + this._itemsPerChunk);\n    }\n    return chunk[innerIndex];\n  }\n  preload(index: number) {\n    const count = this.getCountMaybeSync();\n    if (count instanceof Promise) {\n      return;\n    }\n    if (index >= count) {\n      return;\n    }\n    this.getItem(index, true);\n  }\n  _mapItemIndex(requestedIndex: number): number | null {\n    const count = this.getCountMaybeSync();\n    if (count instanceof Promise) {\n      return null;\n    }\n    if (requestedIndex < 0) {\n      return null;\n    }\n    // Descending order\n    const reversed = count - requestedIndex - 1;\n    if (reversed < 0) {\n      return null;\n    }\n    return this._filteredIndices ? this._filteredIndices[reversed] : reversed;\n  }\n  async _getChunk(chunkIndex: number): Promise<TRecord[]> {\n    if (!this._chunks[chunkIndex]) {\n      this._chunks[chunkIndex] = this._loadChunk(chunkIndex);\n    }\n    return this._chunks[chunkIndex];\n  }\n  _triggerFullLoad() {\n    const count = this.getCountMaybeSync();\n    if (typeof count !== \"number\") {\n      return;\n    }\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\n    for (let i = 0; i < numChunks; i++) {\n      if (this._chunks[i]) {\n        continue;\n      }\n      this._getChunk(i);\n    }\n  }\n  async _loadChunk(chunkIndex: number): Promise<TRecord[]> {\n    const count = await this.getCount();\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\n    if (!numChunks) {\n      return [];\n    }\n    if (chunkIndex >= numChunks) {\n      console.warn(`Loading out-of-index chunk: ${chunkIndex}, number of items: ${count}`);\n      return [];\n    }\n    const chunk = await this._loader.getRecords(\n      this._itemsPerChunk * chunkIndex,\n      this._itemsPerChunk,\n      chunkIndex === numChunks - 1 ? count.toString() : \"\"\n    );\n    if (chunk.length < this._itemsPerChunk && chunkIndex < numChunks - 1) {\n      console.warn(\"Unexpected number of items in chunk:\", chunk.length);\n    }\n    this._chunks[chunkIndex] = chunk;\n    this.updateFilteredIndices();\n    return chunk;\n  }\n}\n\nexport type ListingDataProvider = DataProviderImpl<Metadata>;\nexport type PlayerDataProvider = DataProviderImpl<PlayerMetadata>;\n\nexport type DataProvider = ListingDataProvider | PlayerDataProvider;\nexport const DataProvider = Object.freeze({\n  createListing(date: dayjs.ConfigType): ListingDataProvider {\n    return new DataProviderImpl(new ListingDataLoader(date));\n  },\n  createHightlight(): ListingDataProvider {\n    return new DataProviderImpl(new RecentHighlightDataLoader());\n  },\n  createPlayer(\n    playerId: string,\n    startDate: dayjs.ConfigType | null,\n    endDate: dayjs.ConfigType | null,\n    mode: string\n  ): PlayerDataProvider {\n    return new DataProviderImpl(\n      new PlayerDataLoader(\n        playerId,\n        startDate ? dayjs(startDate).startOf(\"day\") : undefined,\n        endDate ? dayjs(endDate).endOf(\"day\") : undefined,\n        mode\n      )\n    );\n  }\n});\n","/* eslint-disable @typescript-eslint/camelcase */\n/* eslint-disable @typescript-eslint/no-use-before-define */\n/* eslint-disable no-use-before-define */\nimport dayjs from \"dayjs\";\n\nimport { apiGet } from \"./api\";\nimport { PlayerMetadataLite, PlayerExtendedStats } from \"../types\";\nimport { RankingTimeSpan, DeltaRankingResponse } from \"../types\";\nimport { RankRateBySeat } from \"../types\";\nimport { CareerRankingItem, CareerRankingType } from \"../types/ranking\";\nimport { GlobalStatistics, FanStats } from \"../types/statistics\";\n\nexport async function searchPlayer(prefix: string, limit = 20): Promise<PlayerMetadataLite[]> {\n  prefix = prefix.trim();\n  if (!prefix) {\n    return [];\n  }\n  return apiGet<PlayerMetadataLite[]>(`search_player/${encodeURIComponent(prefix)}?limit=${limit}`);\n}\n\nexport async function getExtendedStats(\n  playerId: number,\n  startDate?: dayjs.ConfigType,\n  endDate?: dayjs.ConfigType,\n  mode = \"\"\n): Promise<PlayerExtendedStats> {\n  let datePath = \"\";\n  if (startDate) {\n    datePath += `/${dayjs(startDate).valueOf()}`;\n    if (endDate) {\n      datePath += `/${dayjs(endDate).valueOf()}`;\n    }\n  }\n  return await apiGet<PlayerExtendedStats>(`player_extended_stats/${playerId}${datePath}?mode=${mode}`);\n}\n\nexport async function getDeltaRanking(timespan: RankingTimeSpan): Promise<DeltaRankingResponse> {\n  return await apiGet<DeltaRankingResponse>(`player_delta_ranking/${timespan}`);\n}\n\nexport async function getCareerRanking(type: CareerRankingType, modeId?: string): Promise<CareerRankingItem[]> {\n  return await apiGet<CareerRankingItem[]>(`career_ranking/${type}?mode=${modeId || \"\"}`);\n}\n\nexport async function getGlobalStatistics(): Promise<GlobalStatistics> {\n  return await apiGet<GlobalStatistics>(\"global_statistics\");\n}\nexport async function getFanStats(): Promise<FanStats> {\n  return await apiGet<FanStats>(\"fan_stats\");\n}\n\nexport async function getRankRateBySeat(): Promise<RankRateBySeat> {\n  type RawResponse = [[number, number, number], number][];\n  const rawResp = await apiGet<RawResponse>(\"rank_rate_by_seat\");\n  const counts: {\n    [modeId: string]: { [rank: number]: number };\n  } = {};\n  let maxRank = 0;\n  for (const [[modeId, rank], count] of rawResp) {\n    if (maxRank < rank) {\n      maxRank = rank;\n    }\n    const modeIdStr = modeId.toString();\n    counts[modeIdStr] = counts[modeIdStr] || [];\n    counts[modeIdStr][rank] = counts[modeIdStr][rank] || 0;\n    counts[modeIdStr][rank] += count;\n  }\n  const result: RankRateBySeat = {};\n  for (const [[modeId, rank, seatId], count] of rawResp) {\n    const modeIdStr = modeId.toString();\n    result[modeIdStr] = result[modeIdStr] || [];\n    result[modeIdStr].numGames = counts[modeIdStr][rank];\n    result[modeIdStr][rank] = result[modeIdStr][rank] || Array(maxRank).fill(0);\n    result[modeIdStr][rank][seatId] = count / counts[modeIdStr][rank];\n  }\n  return result;\n}\n","import React from \"react\";\n\nimport { CheckboxGroup } from \"../form\";\nimport { modeLabel } from \"../../data/types\";\nimport Conf from \"../../utils/conf\";\n\nconst MODE_CHECKBOXES = Conf.availableModes.map(x => ({\n  key: String(x),\n  label: modeLabel(x)\n}));\nMODE_CHECKBOXES.unshift({\n  key: \"\",\n  label: \"全部\"\n});\n\nexport function ModeSelector({ mode, onChange }: { mode: string; onChange: (x: string) => void }) {\n  if (MODE_CHECKBOXES.length < 3) {\n    return null;\n  }\n  return (\n    <CheckboxGroup\n      type=\"radio\"\n      groupKey=\"ModeSelector\"\n      items={MODE_CHECKBOXES}\n      selectedItemKey={mode || \"\"}\n      onChange={onChange}\n    />\n  );\n}\n"],"sourceRoot":""}