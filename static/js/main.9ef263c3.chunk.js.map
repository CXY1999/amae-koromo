{"version":3,"sources":["utils/dataSource.ts","components/layout/container.tsx","components/misc/alert.tsx","components/app/appHeader.tsx","components/app/index.tsx","index.tsx","utils/gameMode.ts","utils/constants.ts","utils/index.ts","components/misc/loading.tsx","components/gameRecords/routeSync.tsx","components/form/checkboxGroup.tsx","components/form/datePicker.tsx","components/form/formRow.tsx","components/gameRecords/filterPanel.tsx","components/gameRecords/playerSearch.tsx","components/gameRecords/routes.tsx","utils/dataTypes.ts","components/gameRecords/dataAdapterProvider.tsx","components/misc/scroller.tsx","components/gameRecords/model.tsx"],"names":["apiGet","_callee8","path","resp","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","wrap","_context8","prev","next","fetch","API_ROOT","sent","ok","json","abrupt","stop","searchPlayer","_x2","_searchPlayer","apply","this","arguments","_callee9","prefix","limit","_args9","_context9","length","undefined","trim","concat","encodeURIComponent","ListingDataLoader","date","Object","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_date","dayjs","startOf","valueOf","skip","cacheTag","PlayerDataLoader","playerId","startDate","endDate","_playerId","_startDate","_endDate","result","_getDatePath","ListingDataProvider","freeze","create","_DataProvider","PlayerDataProvider","endOf","loader","itemsPerChunk","_loader","_metadata","_countPromise","_chunks","_itemsPerChunk","_filterPredicate","_filteredIndices","_filterResultCache","predicate","updateFilteredIndices","metadata","getMetadataSync","count","numShownItems","numLoadedItems","indices","i","chunk","Math","floor","Promise","push","game","uuid","_triggerFullLoad","getCount","getCountMaybeSync","getMetadata","then","console","log","Error","_this","resolve","setTimeout","index","mappedIndex","_mapItemIndex","chunkNumber","_this2","skipPreload","getItem","innerIndex","_getChunk","preload","requestedIndex","reversed","chunkIndex","_loadChunk","numChunks","ceil","warn","getRecords","toString","Container","_ref","_ref$title","title","_ref$children","children","_ref$fluid","fluid","react_default","createElement","className","Alert","_ref$className","_ref$type","type","_ref$container","container","React","Fragment","_ref$stateName","stateName","stateKey","_useState","useState","localStorage","_useState2","slicedToArray","closed","setClosed","useEffect","setItem","Cont","role","data-dismiss","aria-label","onClick","event","preventDefault","triggerRelayout","aria-hidden","AppHeader","container_Container","react_router_dom","to","TITLE_PREFIX","href","Helmet","Loadable","__webpack_require__","e","t","bind","loading","App","scroller","routes","rootElement","document","getElementById","render","react","app","GameMode","NUMBER_OF_GAME_MODE","keys","filter","x","d","__webpack_exports__","requestAnimationFrame","window","dispatchEvent","UIEvent","scrollToTop","scrollTo","formatPercent","toFixed","Loading","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","_ref$size","size","parseOptionalDate","s","defaultValue","ModelBuilders","player","params","id","version","listing","isValid","modes","Set","split","map","selectedModes","searchText","search","RouteSync","view","useParams","_useModel","useModel","_useModel2","model","updateModel","location","useLocation","state","pendingRouteUpdate","pathname","react_router","modelResult","newModel","objectSpread","Model","toPlain","newPath","generatePath","fromPlain","CheckboxGroup","_ref$items","items","_ref$selectedItemKeys","selectedItemKeys","_ref$groupKey","groupKey","_ref$onChange","onChange","setSelected","key","isSelected","has","newSet","add","delete","item","value","checked","currentTarget","htmlFor","label","DatePicker","_ref$date","_","_ref$min","min","_ref$max","max","handleChange","useCallback","format","FormRow","MODE_CHECKBOXES","String","DEFAULT_DATE","FilterPanel","updateSearchTextFromEvent","setSelectedItems","setDate","formRow_FormRow","playerSearchCache","NUM_RESULTS_SHOWN","NUM_FETCH","normalizeName","toLowerCase","PlayerSearchResult","setVersion","_useMemo","useMemo","cachedResult","normalizedPrefix","players","isExactMatch","slice","findRawResultFromCache","mayHaveMore","filteredPlayers","forEach","nickname","startsWith","_useMemo2","isLoading","cancelled","debounceToken","Date","getTime","clearTimeout","getLevelTag","level","misc_loading","PlayerSearch","_ref2","_ref2$className","PlayerDetails","all","GameRecordTable","PLAYER_PATH","PATH","genPath","Array","from","join","Routes","gameRecords_model","dataAdapterProvider","exact","showFullTime","showStartEnd","LEVEL_MAX_POINTS","RANK_LABELS","RANK_COLORS","GameRecord","getRankIndexByPlayer","rec","accountId","sortedPlayers","sort","b","score","getPlayerRankLabel","getPlayerRankColor","encodeAccountId","formatFullStartTime","startTime","getRecordLink","trailer","parseInt","Level","levelId","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_majorRank","_minorRank","realId","getMaxPoint","majorRank","minorRank","maxPoints","getNextLevel","getStartingPoint","getPreviousLevel","getTag","LevelWithDelta","obj","formatWithAdjustedScore","delta","loadingPlaceholder","DUMMY_DATA_ADAPTER","noop","DataAdapter","provider","onDataUpdate","_provider","_onDataUpdate","_triggeredRequest","promise","_callHook","maybeCount","_installHook","getUnfilteredCountSync","isItemLoaded","hook","DataAdapterContext","createContext","useDataAdapter","useContext","Consumer","DataAdapterProvider","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","dataProviders","searchPredicate","needPredicate","modeId","some","indexOf","usePredicate","dataProvider","getProviderKey","createProvider","_useState3","_useState4","dataAdapter","setDataAdapter","refreshDataAdapter","setFilterPredicate","adapter","cancelUpdateHook","setUpdateHook","react__WEBPACK_IMPORTED_MODULE_3___default","Provider","useScrollerProps","react_virtualized_dist_es_WindowScroller__WEBPACK_IMPORTED_MODULE_1__","ScrollerContext","Scroller","scrollerProps","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","DEFAULT_MODEL","ModelContext","isChanged","oldModel","newProps","isSame","newSelectedModes","set","other","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","done","elem","err","return","isSameSet","ModelProvider","_useReducer","useReducer","normalizeUpdate","_useReducer2"],"mappings":"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","file":"static/js/main.9ef263c3.chunk.js","sourcesContent":["import dayjs from \"dayjs\";\r\n\r\nimport { API_ROOT } from \"./constants\";\r\nimport { GameRecord, Metadata, PlayerMetadata, PlayerMetadataLite } from \"./dataTypes\";\r\n\r\nexport { default as GameMode, NUMBER_OF_GAME_MODE } from \"./gameMode\";\r\nexport * from \"./dataTypes\";\r\n\r\nasync function apiGet<T>(path: string) {\r\n  const resp = await fetch(API_ROOT + path);\r\n  if (!resp.ok) {\r\n    throw resp;\r\n  }\r\n  return (await resp.json()) as T;\r\n}\r\n\r\nexport async function searchPlayer(prefix: string, limit = 20): Promise<PlayerMetadataLite[]> {\r\n  prefix = prefix.trim();\r\n  if (!prefix) {\r\n    return [];\r\n  }\r\n  return apiGet<PlayerMetadataLite[]>(`search_player/${encodeURIComponent(prefix)}?limit=${limit}`);\r\n}\r\n\r\ninterface DataLoader<T extends Metadata> {\r\n  getMetadata(): Promise<T>;\r\n  getRecords(skip: number, limit: number, cacheTag?: string): Promise<GameRecord[]>;\r\n}\r\n\r\nclass ListingDataLoader implements DataLoader<Metadata> {\r\n  _date: dayjs.Dayjs;\r\n  constructor(date: dayjs.ConfigType) {\r\n    this._date = dayjs(date).startOf(\"day\");\r\n  }\r\n  async getMetadata(): Promise<Metadata> {\r\n    return await apiGet<Metadata>(`count/${this._date.valueOf()}`);\r\n  }\r\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\r\n    return await apiGet<GameRecord[]>(`games/${this._date.valueOf()}?skip=${skip}&limit=${limit}&tag=${cacheTag}`);\r\n  }\r\n}\r\n\r\nclass PlayerDataLoader implements DataLoader<PlayerMetadata> {\r\n  _playerId: string;\r\n  _startDate?: dayjs.Dayjs;\r\n  _endDate?: dayjs.Dayjs;\r\n  constructor(playerId: string, startDate?: dayjs.Dayjs, endDate?: dayjs.Dayjs) {\r\n    this._playerId = playerId;\r\n    this._startDate = startDate;\r\n    this._endDate = endDate;\r\n  }\r\n  _getDatePath(): string {\r\n    let result = \"\";\r\n    if (this._startDate) {\r\n      result += `/${this._startDate.valueOf()}`;\r\n      if (this._endDate) {\r\n        result += `/${this._endDate.valueOf()}`;\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  async getMetadata(): Promise<PlayerMetadata> {\r\n    return await apiGet<PlayerMetadata>(`player_stats/${this._playerId}${this._getDatePath()}`);\r\n  }\r\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\r\n    return await apiGet<GameRecord[]>(\r\n      `player_records/${this._playerId}${this._getDatePath()}?skip=${skip}&limit=${limit}&tag=${cacheTag}`\r\n    );\r\n  }\r\n}\r\n\r\nexport type FilterPredicate = ((record: GameRecord) => boolean) | null;\r\nexport type ListingDataProvider = _DataProvider<ListingDataLoader>;\r\nexport const ListingDataProvider = Object.freeze({\r\n  create(date: dayjs.ConfigType): ListingDataProvider {\r\n    return new _DataProvider<ListingDataLoader>(new ListingDataLoader(date));\r\n  }\r\n});\r\nexport type PlayerDataProvider = _DataProvider<PlayerDataLoader>;\r\nexport const PlayerDataProvider = Object.freeze({\r\n  create(playerId: string, startDate?: dayjs.ConfigType, endDate?: dayjs.ConfigType): PlayerDataProvider {\r\n    return new _DataProvider<PlayerDataLoader>(\r\n      new PlayerDataLoader(\r\n        playerId,\r\n        startDate ? dayjs(startDate).startOf(\"day\") : undefined,\r\n        endDate ? dayjs(endDate).endOf(\"day\") : undefined\r\n      )\r\n    );\r\n  }\r\n});\r\nexport type DataProvider = ListingDataProvider | PlayerDataProvider;\r\nclass _DataProvider<\r\n  TLoader extends DataLoader<TMetadata>,\r\n  TMetadata extends Metadata = TLoader extends DataLoader<infer T> ? T : Metadata\r\n> {\r\n  _loader: TLoader;\r\n  _metadata: TMetadata | Promise<TMetadata> | null;\r\n  _countPromise: Promise<number> | null;\r\n  _chunks: (GameRecord[] | Promise<GameRecord[]>)[];\r\n  _itemsPerChunk: number;\r\n  _filterPredicate: FilterPredicate;\r\n  _filteredIndices: number[] | null;\r\n  _filterResultCache: { [uuid: string]: boolean };\r\n\r\n  constructor(loader: TLoader, itemsPerChunk = 100) {\r\n    this._loader = loader;\r\n    this._metadata = null;\r\n    this._countPromise = null;\r\n    this._chunks = [];\r\n    this._itemsPerChunk = itemsPerChunk;\r\n    this._filterPredicate = null;\r\n    this._filteredIndices = null;\r\n    this._filterResultCache = {};\r\n  }\r\n  setFilterPredicate(predicate: FilterPredicate) {\r\n    if (this._filterPredicate === predicate) {\r\n      return;\r\n    }\r\n    this._filterPredicate = predicate;\r\n    this._filterResultCache = {};\r\n    this.updateFilteredIndices();\r\n  }\r\n  updateFilteredIndices() {\r\n    this._filteredIndices = null;\r\n    if (!this._filterPredicate) {\r\n      return;\r\n    }\r\n    const metadata = this.getMetadataSync();\r\n    if (!metadata) {\r\n      return;\r\n    }\r\n    const count = metadata.count;\r\n    let numShownItems = 0;\r\n    let numLoadedItems = 0;\r\n    const indices = [];\r\n    for (let i = 0; i < count; i++) {\r\n      const chunk = this._chunks[Math.floor(i / this._itemsPerChunk)];\r\n      if (!chunk || chunk instanceof Promise) {\r\n        indices.push(i);\r\n        continue;\r\n      }\r\n      numLoadedItems++;\r\n      const game = chunk[i % this._itemsPerChunk];\r\n      let result = this._filterResultCache[game.uuid];\r\n      if (result === undefined) {\r\n        this._filterResultCache[game.uuid] = result = this._filterPredicate(game);\r\n      }\r\n      if (result) {\r\n        indices.push(i);\r\n        numShownItems++;\r\n      }\r\n    }\r\n    this._filteredIndices = indices;\r\n    if (numShownItems < 10 && numLoadedItems >= this._itemsPerChunk) {\r\n      this._triggerFullLoad();\r\n    }\r\n  }\r\n  getMetadataSync(): TMetadata | null {\r\n    return this._metadata && !(this._metadata instanceof Promise) ? this._metadata : null;\r\n  }\r\n  getCountMaybeSync(): number | Promise<number> {\r\n    let metadata = this.getMetadataSync();\r\n    if (metadata) {\r\n      return this._filteredIndices ? this._filteredIndices.length : metadata.count;\r\n    }\r\n    return this.getCount();\r\n  }\r\n  async getCount(): Promise<number> {\r\n    let metadata = this.getMetadataSync();\r\n    if (metadata) {\r\n      return this.getCountMaybeSync();\r\n    }\r\n    if (!this._metadata) {\r\n      this._metadata = this._loader.getMetadata().then(metadata => {\r\n        if (!metadata) {\r\n          console.log(\"No metadata returned\");\r\n          throw new Error(\"No metadata returned\");\r\n        }\r\n        this._metadata = metadata;\r\n        this.updateFilteredIndices();\r\n        this._countPromise = null;\r\n        return metadata;\r\n      });\r\n    }\r\n    if (this._countPromise) {\r\n      return this._countPromise;\r\n    }\r\n    this._countPromise = Promise.resolve(this._metadata)\r\n      .then(() => new Promise(resolve => setTimeout(resolve, 100)))\r\n      .then(() => this.getCountMaybeSync());\r\n    return this._countPromise;\r\n  }\r\n  getUnfilteredCountSync(): number | null {\r\n    const metadata = this.getMetadataSync();\r\n    if (!metadata) {\r\n      return null;\r\n    }\r\n    return metadata.count;\r\n  }\r\n  isItemLoaded(index: number): boolean {\r\n    const mappedIndex = this._mapItemIndex(index);\r\n    if (mappedIndex === null) {\r\n      return false;\r\n    }\r\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\r\n    return !!this._chunks[chunkNumber] && !(this._chunks[chunkNumber] instanceof Promise);\r\n  }\r\n  getItem(index: number, skipPreload = false): GameRecord | Promise<GameRecord | null> {\r\n    const mappedIndex = this._mapItemIndex(index);\r\n    if (mappedIndex === null) {\r\n      return this.getCount().then(count => {\r\n        if (index > count - 1 || this._mapItemIndex(index) === null) {\r\n          return null;\r\n        }\r\n        return this.getItem(index);\r\n      });\r\n    }\r\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\r\n    const innerIndex = mappedIndex % this._itemsPerChunk;\r\n    const chunk = this._chunks[chunkNumber];\r\n    if (!chunk || chunk instanceof Promise) {\r\n      return this._getChunk(chunkNumber).then(chunk => chunk[innerIndex]);\r\n    }\r\n    if (!skipPreload && !this._filteredIndices) {\r\n      this.preload(index + this._itemsPerChunk);\r\n    }\r\n    return chunk[innerIndex];\r\n  }\r\n  preload(index: number) {\r\n    const count = this.getCountMaybeSync();\r\n    if (count instanceof Promise) {\r\n      return;\r\n    }\r\n    if (index >= count) {\r\n      return;\r\n    }\r\n    this.getItem(index, true);\r\n  }\r\n  _mapItemIndex(requestedIndex: number): number | null {\r\n    const count = this.getCountMaybeSync();\r\n    if (count instanceof Promise) {\r\n      return null;\r\n    }\r\n    if (requestedIndex < 0) {\r\n      return null;\r\n    }\r\n    // Descending order\r\n    const reversed = count - requestedIndex - 1;\r\n    if (reversed < 0) {\r\n      return null;\r\n    }\r\n    return this._filteredIndices ? this._filteredIndices[reversed] : reversed;\r\n  }\r\n  async _getChunk(chunkIndex: number): Promise<GameRecord[]> {\r\n    if (!this._chunks[chunkIndex]) {\r\n      this._chunks[chunkIndex] = this._loadChunk(chunkIndex);\r\n    }\r\n    return this._chunks[chunkIndex];\r\n  }\r\n  _triggerFullLoad() {\r\n    const count = this.getCountMaybeSync();\r\n    if (typeof count !== \"number\") {\r\n      return;\r\n    }\r\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\r\n    for (let i = 0; i < numChunks; i++) {\r\n      if (this._chunks[i]) {\r\n        continue;\r\n      }\r\n      this._getChunk(i);\r\n    }\r\n  }\r\n  async _loadChunk(chunkIndex: number): Promise<GameRecord[]> {\r\n    const count = await this.getCount();\r\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\r\n    if (!numChunks) {\r\n      return [];\r\n    }\r\n    if (chunkIndex >= numChunks) {\r\n      console.warn(`Loading out-of-index chunk: ${chunkIndex}, number of items: ${count}`);\r\n      return [];\r\n    }\r\n    const chunk = await this._loader.getRecords(\r\n      this._itemsPerChunk * chunkIndex,\r\n      this._itemsPerChunk,\r\n      chunkIndex === numChunks - 1 ? count.toString() : \"\"\r\n    );\r\n    if (chunk.length < this._itemsPerChunk && chunkIndex < numChunks - 1) {\r\n      console.warn(\"Unexpected number of items in chunk:\", chunk.length);\r\n    }\r\n    this._chunks[chunkIndex] = chunk;\r\n    this.updateFilteredIndices();\r\n    return chunk;\r\n  }\r\n}\r\n","import React, { ReactNode } from \"react\";\r\n\r\nexport const Container = ({ title = undefined, children = undefined as ReactNode, fluid = false }) => (\r\n  <div className={`my-5 container${fluid ? \"-fluid\" : \"\"}`}>\r\n    <div className=\"row\">\r\n      <div className=\"col-sm-12\">\r\n        {title && <h2 className=\"mb-4\">{title}</h2>}\r\n        {children}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n","import { useState, useEffect, ReactNode } from \"react\";\r\nimport React from \"react\";\r\nimport { ReactComponentLike } from \"prop-types\";\r\nimport { triggerRelayout } from '../../utils/index';\r\n\r\nexport function Alert({\r\n  className = \"\",\r\n  type = \"info\",\r\n  container = React.Fragment as ReactComponentLike,\r\n  stateName = \"\",\r\n  children = undefined as ReactNode\r\n}) {\r\n  const stateKey = `alertState_${stateName}`;\r\n  const [closed, setClosed] = useState(\r\n    () => stateName && !!localStorage.getItem(stateKey)\r\n  );\r\n  useEffect(() => {\r\n    if (stateName && closed) {\r\n      localStorage.setItem(stateKey, \"true\");\r\n    }\r\n  }, [closed, stateName, stateKey]);\r\n  if (closed) {\r\n    return null;\r\n  }\r\n  const Cont = container;\r\n  return (\r\n    <Cont>\r\n      <div\r\n        className={`alert alert-${type} alert-dismissible fade show ${className}`}\r\n        role=\"alert\"\r\n      >\r\n        {children}\r\n        <button\r\n          type=\"button\"\r\n          className=\"close\"\r\n          data-dismiss=\"alert\"\r\n          aria-label=\"Close\"\r\n          onClick={event => {\r\n            event.preventDefault();\r\n            setClosed(true);\r\n            triggerRelayout();\r\n          }}\r\n        >\r\n          <span aria-hidden=\"true\">×</span>\r\n        </button>\r\n      </div>\r\n    </Cont>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { Container } from \"../layout\";\r\nimport { Alert } from \"../misc/alert\";\r\nimport { TITLE_PREFIX } from \"../../utils/constants\";\r\n\r\nexport function AppHeader() {\r\n  return (\r\n    <React.Fragment>\r\n      <Container>\r\n        <h1>\r\n          <Link to=\"/\">{TITLE_PREFIX}</Link>\r\n        </h1>\r\n      </Container>\r\n      <Alert container={Container} stateName=\"topNote\">\r\n        <h4>说明</h4>\r\n        <ul>\r\n          <li>本页面数据由第三方维护，不能绝对保证完整和正确，信息仅供参考，请勿用于不良用途。</li>\r\n          <li>记录包含雀魂国服四人半庄段位战玉之间及王座之间的牌谱。</li>\r\n          <li>对局数据收集从 2019 年 8 月 23 日开始，之前的对局已无法获取。</li>\r\n          <li>\r\n            正常情况下全部对局都会被记录，但不排除因网络问题遗漏部分对局的情况。另 2019 年 10 月 10 日前因程序 Bug\r\n            每天晚间可能遗漏掉 10% ~ 20% 的对局，此 Bug 目前已经修复。\r\n          </li>\r\n          <li>页面不是实时更新，对局一般会在结束后数分钟至数小时内出现。</li>\r\n          <li>\r\n            如有问题或建议，请戳 <a href=\"mailto:i@sapika.ch\">SAPikachu (i@sapika.ch)</a> 或{\" \"}\r\n            <a href=\"https://github.com/SAPikachu/amae-koromo/\">提交 Issue</a>。\r\n          </li>\r\n        </ul>\r\n      </Alert>\r\n      <Alert container={Container} stateName=\"changeLog20191029\">\r\n        <h4>最近更新（2019-10-29）</h4>\r\n        <ul className=\"mt-3 mb-2\">\r\n          <li>支持按前缀搜索玩家</li>\r\n        </ul>\r\n      </Alert>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\nimport Loadable from \"react-loadable\";\r\nconst Helmet = Loadable({\r\n  loader: () => import(\"react-helmet\"),\r\n  loading: () => <></>\r\n});\r\n\r\nimport Scroller from \"../misc/scroller\";\r\n\r\nimport { Container } from \"../layout\";\r\nimport { AppHeader } from \"./appHeader\";\r\nimport GameRecords from \"../gameRecords\";\r\nimport { TITLE_PREFIX } from '../../utils/constants';\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Helmet>\r\n        <title>{TITLE_PREFIX}</title>\r\n      </Helmet>\r\n      <Scroller>\r\n        <AppHeader />\r\n        <Container>\r\n          <GameRecords />\r\n        </Container>\r\n      </Scroller>\r\n    </Router>\r\n  );\r\n}\r\nexport default App;\r\n","import * as React from \"react\";\nimport { render } from \"react-dom\";\n\nimport \"./styles/bootstrap-custom.scss\";\nimport \"./styles/styles.scss\";\n\nimport App from \"./components/app\";\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n","enum GameMode {\r\n  王座 = 16,\r\n  玉 = 12\r\n}\r\nexport default GameMode;\r\nexport const NUMBER_OF_GAME_MODE = Object.keys(GameMode).filter(\r\n  x => typeof GameMode[x as keyof typeof GameMode] === \"number\"\r\n).length;\r\n","export const DATA_ROOT = \"https://d2ek5tscv4zquv.cloudfront.net/\";\r\nexport const API_ROOT = `${DATA_ROOT}api/`;\r\nexport const TITLE_PREFIX = \"雀魂牌谱屋\";","export function triggerRelayout() {\r\n  requestAnimationFrame(() => window.dispatchEvent(new UIEvent(\"resize\")));\r\n  setTimeout(function() {\r\n    window.dispatchEvent(new UIEvent(\"resize\"));\r\n  }, 200);\r\n}\r\nexport function scrollToTop() {\r\n  window.scrollTo(0, 0);\r\n  requestAnimationFrame(() => window.scrollTo(0, 0));\r\n}\r\nexport const formatPercent = (x: any) => (x > 0 ? `${(x * 100).toFixed(2)}%` : \"\");\r\n","import React from \"react\";\n\nexport default function Loading({ size = \"normal\" }: { size?: \"normal\" | \"small\" }) {\n  return (\n    <div className={`d-flex justify-content-center m-${size === \"normal\" ? 5 : 1}`}>\n      <div className={`spinner-border ${size === \"normal\" ? \"\" : \"spinner-border-sm\"}`} role=\"status\">\n        <span className=\"sr-only\">Loading...</span>\n      </div>\n    </div>\n  );\n}\n","import React from \"react\";\nimport dayjs from \"dayjs\";\n\nimport { useParams, useLocation, Redirect } from \"react-router\";\nimport { useModel, Model, ModelPlain } from \"./model\";\nimport { generatePath } from \"./routes\";\nimport { useEffect } from \"react\";\nimport { scrollToTop, triggerRelayout } from \"../../utils/index\";\n\ntype ListingRouteParams = {\n  date?: string;\n  modes?: string;\n  search?: string;\n};\n\ntype PlayerRouteParams = {\n  id: string;\n  startDate?: string;\n  endDate?: string;\n};\n\ntype HistoryState = {\n  model: ModelPlain;\n  pathname: string;\n};\n\nfunction parseOptionalDate<T>(s: string | null | undefined, defaultValue: T): dayjs.Dayjs | T {\n  return s ? dayjs(s, \"YYYY-MM-DD\") : defaultValue;\n}\n\nconst ModelBuilders = {\n  player: function(params: PlayerRouteParams): Model | string {\n    return {\n      type: \"player\",\n      playerId: params.id,\n      startDate: parseOptionalDate(params.startDate, undefined),\n      endDate: parseOptionalDate(params.endDate, undefined),\n      version: 0\n    };\n  },\n  listing: function(params: ListingRouteParams): Model | string {\n    const date = parseOptionalDate(params.date, null);\n    if (date && !date.isValid()) {\n      return \"/\";\n    }\n    const modes = params.modes\n      ? new Set(\n          params.modes\n            .split(\".\")\n            .map(x => x.trim())\n            .filter(x => !!x)\n        )\n      : null;\n    return {\n      date: date ? date.startOf(\"day\").valueOf() : null,\n      selectedModes: modes,\n      searchText: params.search || \"\",\n      version: 0\n    };\n  }\n};\n\nexport function RouteSync({ view }: { view: keyof typeof ModelBuilders }): React.FunctionComponentElement<any> {\n  const params = useParams();\n  const [model, updateModel] = useModel();\n  const location = useLocation<HistoryState>();\n  useEffect(triggerRelayout, [model.type]);\n  const state = location.state;\n  // console.log(params, model, location, state);\n  if (state && state.model.version === model.version) {\n    delete (model as Model).pendingRouteUpdate;\n    if (location.pathname !== state.pathname) {\n      return <Redirect to={{ pathname: state.pathname, state }} />;\n    }\n    return <></>;\n  }\n  if (!state) {\n    // Navigation\n    const modelResult = ModelBuilders[view](params as any);\n    if (typeof modelResult === \"string\") {\n      return <Redirect to={modelResult} />;\n    }\n    const newModel: Model = {\n      ...modelResult,\n      version: model.version\n    };\n    updateModel(newModel);\n    scrollToTop();\n    return (\n      <Redirect\n        to={{ pathname: location.pathname, state: { pathname: location.pathname, model: Model.toPlain(newModel) } }}\n      />\n    );\n  }\n  if (model.pendingRouteUpdate) {\n    // Model updated\n    const newPath = generatePath(model);\n    delete (model as Model).pendingRouteUpdate; // Do not trigger update\n    return <Redirect to={{ pathname: newPath, state: { pathname: newPath, model: Model.toPlain(model) } }} />;\n  } else {\n    const restoredModel = Model.fromPlain(state.model);\n    updateModel(restoredModel);\n    return <></>;\n  }\n}\n","import React from \"react\";\r\n\r\nexport interface CheckboxItem {\r\n  key: string;\r\n  label: string;\r\n}\r\n\r\nexport function CheckboxGroup({\r\n  items = [] as CheckboxItem[],\r\n  selectedItemKeys = null as Set<string> | null,\r\n  groupKey = \"default\",\r\n  onChange = (selectedItemKeys: Set<string>) => {}\r\n}) {\r\n  const setSelected = function(key: string, isSelected: boolean) {\r\n    if (isSelected && (!selectedItemKeys || selectedItemKeys.has(key))) {\r\n      return;\r\n    }\r\n    if (!isSelected && selectedItemKeys && !selectedItemKeys.has(key)) {\r\n      return;\r\n    }\r\n    const newSet = new Set(selectedItemKeys || items.map(x => x.key));\r\n    if (isSelected) {\r\n      newSet.add(key);\r\n    } else {\r\n      newSet.delete(key);\r\n    }\r\n    onChange(newSet);\r\n  };\r\n  return (\r\n    <React.Fragment>\r\n      {items.map(item => (\r\n        <div className=\"form-check form-check-inline\" key={item.key}>\r\n          <input\r\n            className=\"form-check-input\"\r\n            type=\"checkbox\"\r\n            id={`CG_${groupKey}_${item.key}`}\r\n            value={item.key}\r\n            checked={!selectedItemKeys || selectedItemKeys.has(item.key)}\r\n            onChange={event => setSelected(item.key, event.currentTarget.checked)}\r\n          />\r\n          <label className=\"form-check-label\" htmlFor={`CG_${groupKey}_${item.key}`}>\r\n            {item.label}\r\n          </label>\r\n        </div>\r\n      ))}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nimport dayjs from \"dayjs\";\r\nimport { useCallback } from \"react\";\r\n\r\nexport function DatePicker({\r\n  date = dayjs() as dayjs.ConfigType,\r\n  onChange = (_: dayjs.ConfigType) => {},\r\n  className = \"\",\r\n  min = 0 as dayjs.ConfigType,\r\n  max = dayjs() as dayjs.ConfigType\r\n}) {\r\n  const handleChange = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => onChange(dayjs(e.currentTarget.value, \"YYYY-MM-DD\")),\r\n    [onChange]\r\n  );\r\n  return (\r\n    <input\r\n      className={className}\r\n      type=\"date\"\r\n      value={dayjs(date).format(\"YYYY-MM-DD\")}\r\n      min={min ? dayjs(min).format(\"YYYY-MM-DD\") : undefined}\r\n      max={max ? dayjs(max).format(\"YYYY-MM-DD\") : undefined}\r\n      onChange={handleChange}\r\n    />\r\n  );\r\n}\r\n","import React, { ReactNode } from \"react\";\r\n\r\nexport const FormRow = ({ title = \"\", children = undefined as ReactNode }) => (\r\n  <div className=\"form-group row\">\r\n    <label className=\"col-sm-2 col-form-label\">{title}</label>\r\n    <div className=\"col-sm-10\">{children}</div>\r\n  </div>\r\n);\r\n","import { useCallback } from \"react\";\r\nimport React from \"react\";\r\n\r\nimport { FormRow, DatePicker, CheckboxGroup } from \"../form\";\r\nimport { GameMode } from \"../../utils/dataSource\";\r\nimport { useModel } from \"./model\";\r\nimport dayjs from \"dayjs\";\r\n\r\nexport const MODE_CHECKBOXES = Object.keys(GameMode)\r\n  .filter(x => typeof GameMode[x as keyof typeof GameMode] !== \"string\")\r\n  .map(x => ({\r\n    key: String(GameMode[x as keyof typeof GameMode]),\r\n    label: x\r\n  }));\r\n\r\nconst DEFAULT_DATE = dayjs().startOf(\"day\");\r\n\r\nexport function FilterPanel({ className = \"\" }) {\r\n  const [model, updateModel] = useModel();\r\n  const updateSearchTextFromEvent = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => updateModel({ searchText: e.currentTarget.value }),\r\n    [updateModel]\r\n  );\r\n  const setSelectedItems = useCallback(\r\n    (selectedItemKeys: Set<string>) => updateModel({ selectedModes: selectedItemKeys }),\r\n    [updateModel]\r\n  );\r\n  const setDate = useCallback((date: dayjs.ConfigType) => updateModel({ date }), [updateModel]);\r\n  if (model.type !== undefined) {\r\n    return null;\r\n  }\r\n  return (\r\n    <div className={className}>\r\n      <FormRow title=\"日期\">\r\n        <DatePicker min=\"2019-08-23\" date={model.date || DEFAULT_DATE} onChange={setDate} className=\"form-control\" />\r\n      </FormRow>\r\n      <FormRow title=\"查找玩家\">\r\n        <input type=\"text\" className=\"form-control\" value={model.searchText} onChange={updateSearchTextFromEvent} />\r\n      </FormRow>\r\n      <FormRow>\r\n        <CheckboxGroup items={MODE_CHECKBOXES} selectedItemKeys={model.selectedModes} onChange={setSelectedItems} />\r\n      </FormRow>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { useEffect, useState, useMemo } from \"react\";\n\nimport { useModel } from \"./model\";\nimport Loading from \"../misc/loading\";\nimport { PlayerMetadataLite, LevelWithDelta, getLevelTag } from \"../../utils/dataTypes\";\nimport { searchPlayer } from \"../../utils/dataSource\";\nimport { Link } from \"react-router-dom\";\nimport { generatePath } from \"./routes\";\n\nconst playerSearchCache = {} as { [prefix: string]: PlayerMetadataLite[] | Promise<PlayerMetadataLite[]> };\nconst NUM_RESULTS_SHOWN = 6;\nconst NUM_FETCH = 20;\n\nconst normalizeName = (s: string) => s.toLowerCase().trim();\n\nfunction findRawResultFromCache(prefix: string): { result: PlayerMetadataLite[]; isExactMatch: boolean } | null {\n  const normalizedPrefix = normalizeName(prefix);\n  prefix = normalizedPrefix;\n  while (prefix) {\n    const players = playerSearchCache[prefix];\n    if (!players || players instanceof Promise) {\n      prefix = prefix.slice(0, prefix.length - 1);\n      continue;\n    }\n    return {\n      isExactMatch: prefix === normalizedPrefix,\n      result: players\n    };\n  }\n  return null;\n}\n\nfunction PlayerSearchResult({ searchText }: { searchText: string }) {\n  const [version, setVersion] = useState(0);\n  const [players, isLoading, mayHaveMore] = useMemo(() => {\n    const cachedResult = findRawResultFromCache(searchText);\n    if (!cachedResult) {\n      return [[], true];\n    }\n    if (cachedResult.isExactMatch) {\n      return [cachedResult.result, false];\n    }\n    const normalizedPrefix = normalizeName(searchText);\n    let mayHaveMore = cachedResult.result.length >= NUM_FETCH;\n    const filteredPlayers = [] as PlayerMetadataLite[];\n    cachedResult.result.forEach(player => {\n      if (normalizeName(player.nickname).startsWith(normalizedPrefix)) {\n        filteredPlayers.push(player);\n      } else if (filteredPlayers.length) {\n        // Result covers all players who have the specified prefix\n        mayHaveMore = false;\n      }\n    });\n    return [filteredPlayers, mayHaveMore && filteredPlayers.length < NUM_RESULTS_SHOWN, mayHaveMore];\n  }, [searchText, version]);\n  useEffect(() => {\n    const prefix = normalizeName(searchText);\n    if (playerSearchCache[prefix]) {\n      return;\n    }\n    if (!isLoading) {\n      return;\n    }\n    let cancelled = false;\n    let debounceToken: NodeJS.Timeout | undefined = setTimeout(() => {\n      debounceToken = undefined;\n      if (cancelled) {\n        return;\n      }\n      if (playerSearchCache[prefix]) {\n        return;\n      }\n      playerSearchCache[prefix] = searchPlayer(prefix).then(function(players) {\n        playerSearchCache[prefix] = players;\n        if (!cancelled) {\n          setVersion(new Date().getTime());\n        }\n        return players;\n      });\n    }, 500);\n    return () => {\n      cancelled = true;\n      if (debounceToken) {\n        clearTimeout(debounceToken);\n      }\n    };\n  }, [searchText, isLoading]);\n  return (\n    <>\n      <h6 className=\"text-center mb-2\">玩家前缀搜索</h6>\n      <ul className=\"list-unstyled row mb-2\">\n        {players.slice(0, NUM_RESULTS_SHOWN).map(x => (\n          <li key={x.id} className=\"col-6\">\n            <Link to={generatePath({ type: \"player\", playerId: x.id.toString(), version: 0 })}>\n              <span>\n                [{getLevelTag(x.level.id)}] {x.nickname}\n              </span>\n            </Link>\n          </li>\n        ))}\n      </ul>\n      {(isLoading && <Loading size=\"small\" />) ||\n        ((players.length > NUM_RESULTS_SHOWN || mayHaveMore) && (\n          <small className=\"d-block text-center text-muted\">（输入更长名字显示其它结果）</small>\n        ))}\n    </>\n  );\n}\n\nexport function PlayerSearch({ className = \"\" }) {\n  const [model] = useModel();\n  if (\"playerId\" in model || !model.searchText) {\n    return <></>;\n  }\n  return (\n    <div className={className}>\n      <PlayerSearchResult searchText={model.searchText} />\n    </div>\n  );\n}\n","import React from \"react\";\n\nimport { Switch, Route, Redirect, generatePath as genPath } from \"react-router-dom\";\n\nimport { Model, ModelProvider } from \"./model\";\nimport dayjs from \"dayjs\";\nimport { RouteSync } from \"./routeSync\";\nimport { DataAdapterProvider } from \"./dataAdapterProvider\";\nimport { FilterPanel } from \"./filterPanel\";\nimport Loadable from \"react-loadable\";\nimport Loading from \"../misc/loading\";\nimport { PlayerSearch } from \"./playerSearch\";\nconst PlayerDetails = Loadable({\n  loader: () => import(\"./playerDetails\"),\n  loading: () => <Loading />\n});\nconst GameRecordTable = Loadable({\n  loader: () => import(\"./table\"),\n  loading: () => <Loading />\n});\n\nconst PLAYER_PATH = \"/player/:id/:startDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?/:endDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?\";\nconst PATH = \"/:date(\\\\d{4}-\\\\d{2}-\\\\d{2})/:modes([0-9.]+)?/:search?\";\n\nexport function generatePath(model: Model): string {\n  if (model.type === \"player\") {\n    return genPath(PLAYER_PATH, {\n      id: model.playerId,\n      startDate: model.startDate ? dayjs(model.startDate).format(\"YYYY-MM-DD\") : undefined,\n      endDate: model.endDate ? dayjs(model.endDate).format(\"YYYY-MM-DD\") : undefined\n    });\n  }\n  if ((!model.selectedModes || !model.selectedModes.size) && !model.searchText && !model.date) {\n    return \"/\";\n  }\n  return genPath(PATH, {\n    date: dayjs(model.date || new Date()).format(\"YYYY-MM-DD\"),\n    modes: model.selectedModes && model.selectedModes.size ? Array.from(model.selectedModes).join(\".\") : undefined,\n    search: model.searchText || undefined\n  });\n}\n\nfunction Routes() {\n  return (\n    <ModelProvider>\n      <DataAdapterProvider>\n        <Switch>\n          <Route exact path={PLAYER_PATH}>\n            <RouteSync view=\"player\" />\n            <PlayerDetails />\n            <GameRecordTable showFullTime showStartEnd={false} />\n          </Route>\n          <Route exact path={[\"/\", PATH]}>\n            <RouteSync view=\"listing\" />\n            <div className=\"row\">\n              <FilterPanel className=\"col\" />\n              <PlayerSearch className=\"col-12 col-sm-6 col-md-4\" />\n            </div>\n            <GameRecordTable />\n          </Route>\n          <Route>\n            <Redirect to=\"/\" />\n          </Route>\n        </Switch>\n      </DataAdapterProvider>\n    </ModelProvider>\n  );\n}\nexport default Routes;\n","import dayjs from \"dayjs\";\n\nimport GameMode from \"./gameMode\";\n\nexport const PLAYER_RANKS = \"初士杰豪圣魂\";\nexport const LEVEL_MAX_POINTS = [20, 80, 200, 600, 800, 1000, 1200, 1400, 2000, 2800, 3200, 3600, 4000, 6000, 9000];\nexport const RANK_LABELS = [\"一位\", \"二位\", \"三位\", \"四位\"];\nexport const RANK_COLORS = [\"#28a745\", \"#17a2b8\", \"#6c757d\", \"#dc3545\"];\n\nexport interface PlayerRecord {\n  accountId: number;\n  nickname: string;\n  level: number;\n  score: number;\n}\nexport interface GameRecord {\n  modeId: GameMode;\n  uuid: string;\n  startTime: number;\n  endTime: number;\n  players: PlayerRecord[];\n}\nexport const GameRecord = Object.freeze({\n  getRankIndexByPlayer: function(rec: GameRecord, player: number | string | PlayerRecord): number {\n    const playerId = (typeof player === \"object\" ? player.accountId : player).toString();\n    const sortedPlayers = rec.players.map((player, index) => ({ player, index }));\n    sortedPlayers.sort((a, b) => 5 - b.index + b.player.score - (5 - a.index + a.player.score));\n    for (let i = 0; i < sortedPlayers.length; i++) {\n      if (sortedPlayers[i].player.accountId.toString() === playerId) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  getPlayerRankLabel: function(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return RANK_LABELS[GameRecord.getRankIndexByPlayer(rec, player)] || \"\";\n  },\n  getPlayerRankColor: function(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return RANK_COLORS[GameRecord.getRankIndexByPlayer(rec, player)];\n  },\n  encodeAccountId: (t: number) => 1358437 + ((7 * t + 1117113) ^ 86216345),\n  formatFullStartTime: (rec: GameRecord) => dayjs(rec.startTime * 1000).format(\"YYYY/M/D HH:mm\"),\n  getRecordLink: function(rec: GameRecord, player?: PlayerRecord | number | string) {\n    const playerId = typeof player === \"object\" ? player.accountId : player;\n    const trailer = playerId\n      ? `_a${GameRecord.encodeAccountId(typeof playerId === \"number\" ? playerId : parseInt(playerId))}`\n      : \"\";\n    return `https://www.majsoul.com/1/?paipu=${rec.uuid}${trailer}`;\n  }\n});\n\nclass Level {\n  _majorRank: number;\n  _minorRank: number;\n  constructor(levelId: number) {\n    const realId = levelId % 10000;\n    this._majorRank = Math.floor(realId / 100);\n    this._minorRank = realId % 100;\n  }\n  getTag(): string {\n    const label = PLAYER_RANKS[this._majorRank - 1];\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return label;\n    }\n    return label + this._minorRank;\n  }\n  getMaxPoint(): number {\n    return LEVEL_MAX_POINTS[(this._majorRank - 1) * 3 + this._minorRank - 1];\n  }\n  getStartingPoint(): number {\n    if (this._majorRank === 1) {\n      return 0;\n    }\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return 10000;\n    }\n    return this.getMaxPoint() / 2;\n  }\n  getNextLevel(): Level {\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank + 1;\n    if (minorRank > 3) {\n      majorRank++;\n      minorRank = 1;\n    }\n    return new Level(majorRank * 100 + minorRank);\n  }\n  getPreviousLevel(): Level {\n    if (this._majorRank === 1 && this._minorRank === 1) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank - 1;\n    if (minorRank < 1) {\n      majorRank--;\n      minorRank = 3;\n    }\n    return new Level(majorRank * 100 + minorRank);\n  }\n  formatWithAdjustedScore(score: number) {\n    let maxPoints = this.getMaxPoint();\n    let level: Level = this;\n    if (maxPoints && score >= maxPoints) {\n      level = this.getNextLevel();\n      maxPoints = level.getMaxPoint();\n      score = level.getStartingPoint();\n    } else if (score < 0) {\n      if (!maxPoints || level._majorRank === 1 || (level._majorRank === 2 && level._minorRank === 1)) {\n        score = 0;\n      } else {\n        level = this.getPreviousLevel();\n        maxPoints = level.getMaxPoint();\n        score = level.getStartingPoint();\n      }\n    }\n    return `${level.getTag()} - ${score}${maxPoints ? \"/\" + maxPoints : \"\"}`;\n  }\n}\nexport function getLevelTag(levelId: number) {\n  return new Level(levelId).getTag();\n}\nexport type LevelWithDelta = {\n  id: number;\n  score: number;\n  delta: number;\n};\nexport const LevelWithDelta = Object.freeze({\n  format(obj: LevelWithDelta): string {\n    return new Level(obj.id).formatWithAdjustedScore(obj.score + obj.delta);\n  }\n});\n\nexport interface Metadata {\n  count: number;\n}\nexport interface PlayerMetadataLite extends Metadata {\n  id: number;\n  nickname: string;\n  level: LevelWithDelta;\n}\nexport interface PlayerMetadata extends PlayerMetadataLite {\n  rank_rates: [number, number, number, number];\n  avg_rank: number;\n  negative_rate: number;\n}\n","import { useState, useEffect, useMemo, useCallback, useContext } from \"react\";\r\nimport React, { ReactChild } from \"react\";\r\nimport dayjs from \"dayjs\";\r\n\r\nimport {\r\n  DataProvider,\r\n  GameRecord,\r\n  NUMBER_OF_GAME_MODE,\r\n  FilterPredicate,\r\n  ListingDataProvider,\r\n  PlayerDataProvider\r\n} from \"../../utils/dataSource\";\r\nimport { useModel, Model } from \"./model\";\r\nimport { Metadata } from \"../../utils/dataSource\";\r\nimport { generatePath } from \"./routes\";\r\n\r\ninterface ItemLoadingPlaceholder {\r\n  loading: boolean;\r\n}\r\n\r\nconst loadingPlaceholder = { loading: true };\r\n\r\nexport interface IDataAdapter {\r\n  getCount(): number;\r\n  getUnfilteredCount(): number;\r\n  getMetadata<T extends Metadata>(): T | null;\r\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder;\r\n  isItemLoaded(index: number): boolean;\r\n}\r\n\r\nclass _DummyDataAdapter implements IDataAdapter {\r\n  getCount(): number {\r\n    return 0;\r\n  }\r\n  getUnfilteredCount(): number {\r\n    return 0;\r\n  }\r\n  getMetadata<T extends Metadata>(): T | null {\r\n    return null;\r\n  }\r\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder {\r\n    return loadingPlaceholder;\r\n  }\r\n  isItemLoaded(index: number): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const DUMMY_DATA_ADAPTER = new _DummyDataAdapter() as IDataAdapter;\r\n\r\nconst noop = () => {};\r\n\r\nclass DataAdapter implements IDataAdapter {\r\n  _provider: DataProvider;\r\n  _onDataUpdate: () => void;\r\n  _triggeredRequest: boolean;\r\n\r\n  constructor(provider: DataProvider, onDataUpdate = noop) {\r\n    this._provider = provider;\r\n    this._onDataUpdate = onDataUpdate;\r\n    this._triggeredRequest = false;\r\n  }\r\n  _installHook(promise: Promise<any>) {\r\n    if (this._triggeredRequest) {\r\n      return;\r\n    }\r\n    this._triggeredRequest = true;\r\n    promise.then(this._callHook.bind(this));\r\n  }\r\n  _callHook() {\r\n    this._onDataUpdate();\r\n  }\r\n  getCount(): number {\r\n    const maybeCount = this._provider.getCountMaybeSync();\r\n    if (maybeCount instanceof Promise) {\r\n      this._installHook(maybeCount);\r\n      return 0;\r\n    }\r\n    return maybeCount;\r\n  }\r\n  getUnfilteredCount(): number {\r\n    return this._provider.getUnfilteredCountSync() || 0;\r\n  }\r\n  getMetadata<T extends Metadata>(): T | null {\r\n    return this._provider.getMetadataSync() as T | null;\r\n  }\r\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder {\r\n    if (index >= this.getCount()) {\r\n      return loadingPlaceholder;\r\n    }\r\n    if (this._provider.isItemLoaded(index)) {\r\n      return this._provider.getItem(index) as GameRecord;\r\n    }\r\n    if (!this._triggeredRequest) {\r\n      this._installHook(this._provider.getItem(index) as Promise<GameRecord>);\r\n    }\r\n    return loadingPlaceholder;\r\n  }\r\n  isItemLoaded(index: number): boolean {\r\n    if (index < 0) {\r\n      return false;\r\n    }\r\n    return this._provider.isItemLoaded(index);\r\n  }\r\n  setUpdateHook(hook: () => void) {\r\n    this._onDataUpdate = hook;\r\n  }\r\n  cancelUpdateHook() {\r\n    this._onDataUpdate = noop;\r\n  }\r\n}\r\n\r\nconst DataAdapterContext = React.createContext(DUMMY_DATA_ADAPTER);\r\n\r\nexport const useDataAdapter = () => useContext(DataAdapterContext);\r\nexport const DataAdapterConsumer = DataAdapterContext.Consumer;\r\n\r\nfunction getProviderKey(model: Model): string {\r\n  if (model.type === undefined) {\r\n    return dayjs(model.date || dayjs())\r\n      .startOf(\"day\")\r\n      .valueOf()\r\n      .toString();\r\n  } else if (model.type === \"player\") {\r\n    return generatePath(model);\r\n  }\r\n  throw new Error(\"Unknown model type\");\r\n}\r\n\r\nfunction createProvider(model: Model): DataProvider {\r\n  if (model.type === undefined) {\r\n    return ListingDataProvider.create(model.date || dayjs().startOf(\"day\"));\r\n  }\r\n  if (model.type === \"player\") {\r\n    return PlayerDataProvider.create(model.playerId, model.startDate, model.endDate);\r\n  }\r\n  throw new Error(\"Not implemented\");\r\n}\r\n\r\nfunction usePredicate(model: Model): FilterPredicate {\r\n  if (model.type !== undefined) {\r\n    return useMemo(() => null, [null, \"\"]);\r\n  }\r\n  const searchText = (model.searchText || \"\").trim() || \"\";\r\n  const needPredicate = searchText || (model.selectedModes && model.selectedModes.size < NUMBER_OF_GAME_MODE);\r\n  return useMemo(\r\n    () =>\r\n      needPredicate\r\n        ? game => {\r\n            if (model.selectedModes && !model.selectedModes.has(game.modeId.toString())) {\r\n              return false;\r\n            }\r\n            if (!game.players.some(player => player.nickname.toLowerCase().indexOf(searchText) > -1)) {\r\n              return false;\r\n            }\r\n            return true;\r\n          }\r\n        : null,\r\n    [(model.type === undefined && model.selectedModes) || null, searchText]\r\n  );\r\n}\r\n\r\nexport function DataAdapterProvider({ children }: { children: ReactChild | ReactChild[] }) {\r\n  const [model] = useModel();\r\n  const [dataProviders] = useState(() => ({} as { [key: string]: DataProvider }));\r\n  const searchPredicate = usePredicate(model);\r\n  const dataProvider = useMemo(() => {\r\n    const key = getProviderKey(model);\r\n    if (!dataProviders[key]) {\r\n      dataProviders[key] = createProvider(model);\r\n    }\r\n    return dataProviders[key];\r\n  }, [model, dataProviders]);\r\n  const [dataAdapter, setDataAdapter] = useState(() => DUMMY_DATA_ADAPTER);\r\n  const refreshDataAdapter = useCallback(() => {\r\n    dataProvider.setFilterPredicate(searchPredicate);\r\n    const adapter = new DataAdapter(dataProvider);\r\n    setDataAdapter(adapter);\r\n  }, [dataProvider, searchPredicate]);\r\n  useEffect(refreshDataAdapter, [refreshDataAdapter]);\r\n  useEffect(() => {\r\n    const adapter = dataAdapter;\r\n    if (adapter instanceof DataAdapter) {\r\n      return () => adapter.cancelUpdateHook();\r\n    }\r\n  }, [dataAdapter]);\r\n  useEffect(() => {\r\n    const adapter = dataAdapter;\r\n    if (adapter instanceof DataAdapter) {\r\n      adapter.setUpdateHook(refreshDataAdapter);\r\n    }\r\n  }, [dataAdapter, refreshDataAdapter]);\r\n  useEffect(() => {\r\n    dataProvider.getCountMaybeSync(); // Preload metadata\r\n  }, [dataProvider]);\r\n  return <DataAdapterContext.Provider value={dataAdapter}>{children}</DataAdapterContext.Provider>;\r\n}\r\n","import React, { ReactChild, useContext } from \"react\";\r\n\r\nimport { WindowScrollerChildProps } from \"react-virtualized\";\r\nimport { WindowScroller } from \"react-virtualized/dist/es/WindowScroller\";\r\n\r\nconst ScrollerContext = React.createContext<WindowScrollerChildProps>({} as any);\r\n\r\nexport const useScrollerProps = () => useContext(ScrollerContext);\r\n\r\nfunction Scroller({ children }: { children: ReactChild | ReactChild[] }) {\r\n  return (\r\n    <WindowScroller>\r\n      {scrollerProps => <ScrollerContext.Provider value={scrollerProps}>{children}</ScrollerContext.Provider>}\r\n    </WindowScroller>\r\n  );\r\n}\r\nexport default Scroller;\r\n","import dayjs from \"dayjs\";\r\nimport React, { useReducer, useContext, ReactChild } from \"react\";\r\nimport { useMemo } from \"react\";\r\nimport { NUMBER_OF_GAME_MODE } from \"../../utils/gameMode\";\r\nimport { useLocation } from \"react-router\";\r\n\r\ninterface WithRuntimeInfo {\r\n  version: number;\r\n  pendingRouteUpdate?: boolean;\r\n}\r\nexport interface ListingModel {\r\n  type?: undefined;\r\n  date: dayjs.ConfigType | null;\r\n  selectedModes: Set<string> | null;\r\n  searchText: string;\r\n}\r\nexport interface PlayerModel {\r\n  type: \"player\";\r\n  playerId: string;\r\n  startDate?: dayjs.ConfigType;\r\n  endDate?: dayjs.ConfigType;\r\n}\r\nexport type Model = (ListingModel | PlayerModel) & WithRuntimeInfo;\r\ninterface ListingModelPlain {\r\n  type?: undefined;\r\n  date: number | null;\r\n  selectedModes: string[] | null;\r\n  searchText: string;\r\n}\r\nexport interface PlayerModelPlain {\r\n  type: \"player\";\r\n  playerId: string;\r\n  startDate?: number;\r\n  endDate?: number;\r\n}\r\nexport type ModelPlain = (ListingModelPlain | PlayerModelPlain) & WithRuntimeInfo;\r\nexport const Model = Object.freeze({\r\n  toPlain: function(model: Model): ModelPlain {\r\n    if (model.type === \"player\") {\r\n      return {\r\n        ...model,\r\n        startDate: model.startDate ? dayjs(model.startDate).valueOf() : undefined,\r\n        endDate: model.endDate ? dayjs(model.endDate).valueOf() : undefined,\r\n      };\r\n    }\r\n    return {\r\n      ...model,\r\n      date: model.date ? dayjs(model.date).valueOf() : null,\r\n      selectedModes: model.selectedModes ? Array.from(model.selectedModes) : null\r\n    };\r\n  },\r\n  fromPlain: function(model: ModelPlain): ListingModel | PlayerModel {\r\n    if (model.type === \"player\") {\r\n      return model;\r\n    }\r\n    if (model.type === undefined) {\r\n      return {\r\n        date: model.date || null,\r\n        searchText: model.searchText || \"\",\r\n        selectedModes: model.selectedModes ? new Set(model.selectedModes) : null\r\n      };\r\n    }\r\n    console.warn(\"Unknown model data from location state:\", model);\r\n    return DEFAULT_MODEL;\r\n  }\r\n});\r\ntype ModelUpdate = Partial<ListingModel> | PlayerModel;\r\ntype DispatchModelUpdate = (props: ModelUpdate) => void;\r\n\r\nconst DEFAULT_MODEL: ListingModel = { date: null, selectedModes: null, searchText: \"\" };\r\nconst ModelContext = React.createContext<[Readonly<Model>, DispatchModelUpdate]>([\r\n  { ...DEFAULT_MODEL, version: 0 },\r\n  () => {}\r\n]);\r\nexport const useModel = () => useContext(ModelContext);\r\n\r\nfunction isSameSet<T>(set: Set<T>, other: Set<T>) {\r\n  if (set.size !== other.size) {\r\n    return false;\r\n  }\r\n  for (const elem of other) {\r\n    if (!set.has(elem)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction normalizeUpdate(newProps: ModelUpdate): ModelUpdate {\r\n  if (newProps.type === undefined) {\r\n    if (newProps.date) {\r\n      newProps.date = dayjs(newProps.date).valueOf();\r\n    }\r\n    if (newProps.selectedModes && newProps.selectedModes.size >= NUMBER_OF_GAME_MODE) {\r\n      newProps.selectedModes = null;\r\n    }\r\n  }\r\n  return newProps;\r\n}\r\nfunction isChanged(oldModel: Model, newProps: ModelUpdate): boolean {\r\n  if (oldModel.type !== newProps.type) {\r\n    return true;\r\n  }\r\n  if (oldModel.type === undefined && newProps.type === oldModel.type) {\r\n    if (\r\n      newProps.date !== undefined &&\r\n      newProps.date !== oldModel.date &&\r\n      (!newProps.date || !oldModel.date || !dayjs(newProps.date).isSame(oldModel.date, \"day\"))\r\n    ) {\r\n      return true;\r\n    }\r\n    if (newProps.searchText !== undefined && newProps.searchText !== oldModel.searchText) {\r\n      return true;\r\n    }\r\n    let newSelectedModes = newProps.selectedModes;\r\n    if (newSelectedModes && newSelectedModes.size >= NUMBER_OF_GAME_MODE) {\r\n      newSelectedModes = null;\r\n    }\r\n    if (newSelectedModes !== undefined && newSelectedModes !== oldModel.selectedModes) {\r\n      if (!newSelectedModes || !oldModel.selectedModes) {\r\n        return true;\r\n      }\r\n      if (isSameSet(oldModel.selectedModes, newSelectedModes)) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n  if (oldModel.type === \"player\" && newProps.type === oldModel.type) {\r\n    if (newProps.playerId !== undefined && newProps.playerId !== oldModel.playerId) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function ModelProvider({ children }: { children: ReactChild | ReactChild[] }) {\r\n  const location = useLocation();\r\n  const [model, updateModel] = useReducer(\r\n    (oldModel: Model, newProps: ModelUpdate): Model =>\r\n      isChanged(oldModel, newProps)\r\n        ? {\r\n            ...((oldModel.type === newProps.type ? oldModel : {}) as Model),\r\n            ...normalizeUpdate(newProps),\r\n            version: oldModel.version + 1,\r\n            pendingRouteUpdate: true\r\n          }\r\n        : oldModel,\r\n    null,\r\n    (): Model => ({\r\n      ...DEFAULT_MODEL,\r\n      ...Model.fromPlain((location.state || {}).model || {}),\r\n      version: new Date().getTime()\r\n    })\r\n  );\r\n  const value: [Model, DispatchModelUpdate] = useMemo(() => [model, updateModel], [model, updateModel]);\r\n  return <ModelContext.Provider value={value}>{children}</ModelContext.Provider>;\r\n}\r\n"],"sourceRoot":""}