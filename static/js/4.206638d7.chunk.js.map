{"version":3,"sources":["components/gameRecords/playerDetails.tsx"],"names":["DateRangeOptions","RankRateChart","Loadable","loader","Promise","all","__webpack_require__","e","then","bind","loading","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","_misc_loading__WEBPACK_IMPORTED_MODULE_8__","RecentRankChart","DATE_RANGE_ITEMS","Object","keys","map","key","label","PlayerDetailsDateRangeSelector","_useModel","useModel","_useModel2","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","model","updateModel","_useState","useState","type","All","startDate","endDate","dayjs","isSame","subtract","Custom","Last4Weeks","_useState2","mode","setMode","_useState3","DATE_MIN","_useState4","customDateFrom","setCustomDateFrom","_useState5","_useState6","customDateTo","setCustomDateTo","useEffect","playerId","undefined","_form_formRow__WEBPACK_IMPORTED_MODULE_9__","title","inline","_form__WEBPACK_IMPORTED_MODULE_11__","selectedItemKey","items","groupKey","onChange","Fragment","min","date","className","PlayerDetails","dataAdapter","useDataAdapter","metadata","getMetadata","triggerRelayout","nickname","react_helmet__WEBPACK_IMPORTED_MODULE_3__","TITLE_PREFIX","id","aspect","count","LevelWithDelta","format","level","avg_rank","toFixed","formatPercent","negative_rate"],"mappings":"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","file":"static/js/4.206638d7.chunk.js","sourcesContent":["import React from \"react\";\nimport Loadable from \"react-loadable\";\nimport { Helmet } from \"react-helmet\";\n\nimport { useDataAdapter } from \"./dataAdapterProvider\";\nimport { PlayerMetadata } from \"../../utils/dataSource\";\nimport { useEffect, useState } from \"react\";\nimport { triggerRelayout, formatPercent } from \"../../utils/index\";\nimport { LevelWithDelta } from \"../../utils/dataTypes\";\nimport { TITLE_PREFIX, DATE_MIN } from \"../../utils/constants\";\nimport Loading from \"../misc/loading\";\nimport { FormRow } from \"../form/formRow\";\nimport { useModel } from \"./model\";\nimport { CheckboxGroup, DatePicker } from \"../form\";\nimport dayjs from \"dayjs\";\nconst RankRateChart = Loadable({\n  loader: () => import(\"./charts/rankRate\"),\n  loading: () => <Loading />\n});\nconst RecentRankChart = Loadable({\n  loader: () => import(\"./charts/recentRank\"),\n  loading: () => <Loading />\n});\n\nenum DateRangeOptions {\n  All = \"全部\",\n  Last4Weeks = \"最近四周\",\n  Custom = \"自定义\"\n}\nconst DATE_RANGE_ITEMS = Object.keys(DateRangeOptions).map((key: string) => ({\n  key: DateRangeOptions[key as keyof typeof DateRangeOptions],\n  label: DateRangeOptions[key as keyof typeof DateRangeOptions]\n}));\n\nfunction PlayerDetailsDateRangeSelector() {\n  const [model, updateModel] = useModel();\n  const [mode, setMode] = useState(() => {\n    if (model.type !== \"player\") {\n      return DateRangeOptions.All;\n    }\n    if (!model.startDate) {\n      return DateRangeOptions.All;\n    }\n    if (\n      (!model.endDate || dayjs(model.endDate).isSame(dayjs(), \"day\")) &&\n      dayjs(model.startDate).isSame(dayjs().subtract(28, \"day\"), \"day\")\n    ) {\n      return DateRangeOptions.Last4Weeks;\n    }\n    return DateRangeOptions.Custom;\n  });\n  const [customDateFrom, setCustomDateFrom] = useState(() =>\n    model.type === \"player\" && model.startDate ? model.startDate : DATE_MIN\n  );\n  const [customDateTo, setCustomDateTo] = useState(() =>\n    model.type === \"player\" && model.endDate ? model.endDate : dayjs()\n  );\n  useEffect(() => {\n    if (model.type !== \"player\") {\n      return;\n    }\n    switch (mode) {\n      case DateRangeOptions.All:\n        updateModel({\n          type: \"player\",\n          playerId: model.playerId,\n          startDate: undefined,\n          endDate: undefined\n        });\n        break;\n      case DateRangeOptions.Last4Weeks:\n        updateModel({\n          type: \"player\",\n          playerId: model.playerId,\n          startDate: dayjs().subtract(27, \"day\"),\n          endDate: undefined\n        });\n        break;\n      case DateRangeOptions.Custom:\n        updateModel({\n          type: \"player\",\n          playerId: model.playerId,\n          startDate: customDateFrom,\n          endDate: customDateTo\n        });\n        break;\n    }\n  }, [model, mode, customDateFrom, customDateTo]);\n  return (\n    <FormRow title=\"数据范围\" inline={true}>\n      <CheckboxGroup\n        type=\"radio\"\n        selectedItemKey={mode}\n        items={DATE_RANGE_ITEMS}\n        groupKey=\"PlayerDetailsDateRangeSelector\"\n        onChange={setMode as (x: string) => void}\n      />\n      {mode === DateRangeOptions.Custom ? (\n        <>\n          <DatePicker min={DATE_MIN} onChange={setCustomDateFrom} date={customDateFrom} className=\"form-control\" />\n          <DatePicker min={DATE_MIN} onChange={setCustomDateTo} date={customDateTo} className=\"form-control\" />\n        </>\n      ) : null}\n    </FormRow>\n  );\n}\n\nexport default function PlayerDetails() {\n  const dataAdapter = useDataAdapter();\n  const metadata = dataAdapter.getMetadata<PlayerMetadata>();\n  useEffect(triggerRelayout, [!!metadata]);\n  if (!metadata || !metadata.nickname) {\n    return <Loading />;\n  }\n  return (\n    <div>\n      <Helmet>\n        <title>\n          {TITLE_PREFIX} - {metadata.nickname}\n        </title>\n      </Helmet>\n      <h2 className=\"text-center\">玩家：{metadata.nickname}</h2>\n      <div className=\"row mt-4\">\n        <div className=\"col-md-8\">\n          <h3 className=\"text-center mb-4\">最近走势</h3>\n          <RecentRankChart dataAdapter={dataAdapter} playerId={metadata.id} aspect={6} />\n          <h3 className=\"text-center mt-4 mb-4\">相关数据</h3>\n          <dl className=\"row\">\n            <dt className=\"col-4 col-md-2\">记录场数</dt>\n            <dd className=\"col-8 col-md-4\">{metadata.count}</dd>\n            <dt className=\"col-4 col-md-2\">当前等级</dt>\n            <dd className=\"col-8 col-md-4\">{LevelWithDelta.format(metadata.level)}</dd>\n            <dt className=\"col-4 col-md-2\">平均顺位</dt>\n            <dd className=\"col-8 col-md-4\">{metadata.avg_rank.toFixed(3)}</dd>\n            <dt className=\"col-4 col-md-2\">被飞率</dt>\n            <dd className=\"col-8 col-md-4\">{formatPercent(metadata.negative_rate)}</dd>\n          </dl>\n        </div>\n        <div className=\"col-md-4\">\n          <h3 className=\"text-center mb-4\">累计战绩</h3>\n          <RankRateChart metadata={metadata} />\n        </div>\n      </div>\n      <PlayerDetailsDateRangeSelector />\n    </div>\n  );\n}\n"],"sourceRoot":""}