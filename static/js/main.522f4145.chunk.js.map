{"version":3,"sources":["utils/dataSource.ts","components/layout/container.tsx","components/misc/alert.tsx","components/app/appHeader.tsx","components/app/maintenance.tsx","components/app/index.tsx","index.tsx","utils/constants.ts","components/form/checkboxGroup.tsx","components/form/datePicker.tsx","components/form/index.tsx","utils/index.ts","components/misc/loading.tsx","utils/dataTypes.ts","components/gameRecords/routeSync.tsx","components/gameRecords/filterPanel.tsx","components/gameRecords/playerSearch.tsx","components/gameRecords/routes.tsx","components/gameRecords/model.tsx","components/gameRecords/dataAdapterProvider.tsx","components/form/formRow.tsx","components/misc/scroller.tsx","components/gameRecords/modeSelector.tsx"],"names":["onMaintenance","setMaintenanceHandler","handler","apiGet","_callee8","path","resp","data","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","a","wrap","_context8","prev","next","fetch","API_ROOT","sent","ok","json","maintenance","abrupt","Promise","stop","searchPlayer","_x2","_searchPlayer","apply","this","arguments","_callee9","prefix","limit","_args9","_context9","length","undefined","trim","concat","encodeURIComponent","ListingDataLoader","date","Object","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","_date","dayjs","startOf","valueOf","skip","cacheTag","PlayerDataLoader","playerId","startDate","endDate","mode","_playerId","_startDate","_endDate","_mode","result","_getDatePath","_getParams","then","stats","extended_stats","_this","extendedStats","ListingDataProvider","freeze","create","DataProviderImpl","PlayerDataProvider","endOf","loader","itemsPerChunk","_loader","_metadata","_countPromise","_chunks","_itemsPerChunk","_filterPredicate","_filteredIndices","_filterResultCache","predicate","updateFilteredIndices","metadata","getMetadataSync","count","numShownItems","numLoadedItems","indices","i","chunk","Math","floor","push","game","uuid","_triggerFullLoad","getCount","getCountMaybeSync","getMetadata","console","log","Error","_this2","resolve","setTimeout","index","mappedIndex","_mapItemIndex","chunkNumber","_this3","skipPreload","getItem","innerIndex","_getChunk","preload","requestedIndex","reversed","chunkIndex","_loadChunk","numChunks","ceil","warn","getRecords","toString","Container","_ref","_ref$title","title","_ref$children","children","_ref$fluid","fluid","react_default","createElement","className","Alert","_ref$className","_ref$type","type","_ref$container","container","React","Fragment","_ref$stateName","stateName","_ref$closable","closable","stateKey","_useState","useState","localStorage","_useState2","slicedToArray","closed","setClosed","useEffect","setItem","Cont","role","data-dismiss","aria-label","onClick","event","preventDefault","triggerRelayout","aria-hidden","AppHeader","container_Container","react_router_dom","to","TITLE_PREFIX","href","MaintenanceHandler","msg","setMsg","react","Helmet","Loadable","__webpack_require__","e","t","bind","loading","App","scroller","routes","rootElement","document","getElementById","render","app","d","__webpack_exports__","DATE_MIN","dayjs__WEBPACK_IMPORTED_MODULE_0__","dayjs__WEBPACK_IMPORTED_MODULE_0___default","n","API_ROOT_PROD","CheckboxGroup","props","items","groupKey","selectedItemKeys","onChange","setSelected","key","isSelected","has","newSet","Set","map","x","add","delete","isChecked","selectedItemKey","item","id","name","value","checked","currentTarget","htmlFor","label","DatePicker","_ref$date","_ref$onChange","_ref$min","min","_ref$max","max","handleChange","useCallback","format","formRow","requestAnimationFrame","window","dispatchEvent","UIEvent","scrollToTop","scrollTo","formatPercent","toFixed","NOT_FINISHED","notFinished","useAsync","maybePromise","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","fulfilledValue","setFulfilledValue","Loading","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","_ref$size","size","GameMode","LEVEL_MAX_POINTS","LEVEL_PENALTY","RANK_DELTA","MODE_DELTA","12","16","RANK_LABELS","RANK_COLORS","LEVEL_ALLOWED_MODES","1","2","3","4","玉","5","王座","6","GameRecord","keys","filter","getRankIndexByPlayer","rec","player","accountId","sortedPlayers","players","sort","b","score","getPlayerRankLabel","getPlayerRankColor","encodeAccountId","formatFullStartTime","startTime","getRecordLink","trailer","parseInt","Level","levelId","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","_majorRank","_minorRank","realId","other","includes","getMaxPoint","majorRank","minorRank","maxPoints","level","getNextLevel","getStartingPoint","getPreviousLevel","getAdjustedLevel","getTag","formatAdjustedScore","getLevelTag","LevelWithDelta","obj","formatAdjustedScoreWithTag","delta","PlayerMetadata","calculateExpectedGamePoint","rank_avg_score","rank","getPenaltyPoint","calculateDeltaPoint","point","rank_rates","reduce","estimateStableLevel","lastPositiveLevel","expectedGamePoint","abs","isAllowedMode","prevLevel","parseOptionalDate","s","defaultValue","ModelBuilders","params","selectedMode","version","listing","isValid","searchText","search","RouteSync","view","useParams","_useModel","useModel","_useModel2","model","updateModel","location","useLocation","state","pendingRouteUpdate","pathname","react_router","modelResult","newModel","objectSpread","Model","toPlain","newPath","generatePath","fromPlain","DEFAULT_DATE","FilterPanel","updateSearchTextFromEvent","setMode","setDate","components_form","modeSelector","playerSearchCache","NUM_RESULTS_SHOWN","NUM_FETCH","normalizeName","toLowerCase","PlayerSearchResult","setVersion","_useMemo","useMemo","cachedResult","normalizedPrefix","isExactMatch","slice","findRawResultFromCache","mayHaveMore","filteredPlayers","forEach","nickname","startsWith","_useMemo2","isLoading","cancelled","debounceToken","Date","getTime","clearTimeout","generatePlayerPathById","misc_loading","PlayerSearch","_ref2","_ref2$className","PlayerDetails","all","GameRecordTable","PLAYER_PATH","PATH","genPath","Routes","gameRecords_model","dataAdapterProvider","exact","showFullTime","showStartEnd","_home_travis_build_SAPikachu_amae_koromo_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_1__","DEFAULT_MODEL","removeExtraParams","ModelContext","createContext","useContext","isSameDateValue","d1","d2","isSame","ModelProvider","_useReducer","useReducer","oldModel","newProps","isChanged","_i","_Object$keys","normalizeUpdate","_useReducer2","react__WEBPACK_IMPORTED_MODULE_3___default","Provider","loadingPlaceholder","DUMMY_DATA_ADAPTER","noop","DataAdapter","provider","onDataUpdate","_provider","_onDataUpdate","_triggeredRequest","promise","_callHook","catch","isError","maybeCount","_installHook","getUnfilteredCountSync","isItemLoaded","hook","DataAdapterContext","useDataAdapter","Consumer","DataAdapterProvider","dataProviders","searchPredicate","needPredicate","modeId","some","indexOf","usePredicate","dataProvider","getProviderKey","createProvider","_useState3","_useState4","dataAdapter","setDataAdapter","refreshDataAdapter","setFilterPredicate","adapter","cancelUpdateHook","setUpdateHook","FormRow","_ref$inline","inline","useScrollerProps","react_virtualized_dist_es_WindowScroller__WEBPACK_IMPORTED_MODULE_1__","ScrollerContext","Scroller","scrollerProps","ModeSelector","_form__WEBPACK_IMPORTED_MODULE_1__","_utils_dataSource__WEBPACK_IMPORTED_MODULE_2__","MODE_CHECKBOXES","String","unshift"],"mappings":"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","file":"static/js/main.522f4145.chunk.js","sourcesContent":["/* eslint-disable @typescript-eslint/camelcase */\r\n/* eslint-disable @typescript-eslint/no-use-before-define */\r\n/* eslint-disable no-use-before-define */\r\nimport dayjs from \"dayjs\";\r\n\r\nimport { API_ROOT } from \"./constants\";\r\nimport { GameRecord, Metadata, PlayerMetadata, PlayerMetadataLite, PlayerExtendedStats } from \"./dataTypes\";\r\n\r\nexport * from \"./dataTypes\";\r\n\r\nlet onMaintenance: (msg: string) => void = () => {};\r\n\r\nexport function setMaintenanceHandler(handler: (msg: string) => void) {\r\n  onMaintenance = handler;\r\n}\r\n\r\nasync function apiGet<T>(path: string) {\r\n  const resp = await fetch(API_ROOT + path);\r\n  if (!resp.ok) {\r\n    throw resp;\r\n  }\r\n  const data = await resp.json();\r\n  if (data.maintenance) {\r\n    onMaintenance(data.maintenance);\r\n    return new Promise(() => {}) as Promise<T>; // Freeze all other components\r\n  }\r\n  return data as T;\r\n}\r\n\r\nexport async function searchPlayer(prefix: string, limit = 20): Promise<PlayerMetadataLite[]> {\r\n  prefix = prefix.trim();\r\n  if (!prefix) {\r\n    return [];\r\n  }\r\n  return apiGet<PlayerMetadataLite[]>(`search_player/${encodeURIComponent(prefix)}?limit=${limit}`);\r\n}\r\n\r\nexport async function getExtendedStats(\r\n  playerId: number,\r\n  startDate?: dayjs.ConfigType,\r\n  endDate?: dayjs.ConfigType,\r\n  mode = \"\"\r\n): Promise<PlayerExtendedStats> {\r\n  let datePath = \"\";\r\n  if (startDate) {\r\n    datePath += `/${dayjs(startDate).valueOf()}`;\r\n    if (endDate) {\r\n      datePath += `/${dayjs(endDate).valueOf()}`;\r\n    }\r\n  }\r\n  return await apiGet<PlayerExtendedStats>(`player_extended_stats/${playerId}${datePath}?mode=${mode}`);\r\n}\r\n\r\ninterface DataLoader<T extends Metadata> {\r\n  getMetadata(): Promise<T>;\r\n  getRecords(skip: number, limit: number, cacheTag?: string): Promise<GameRecord[]>;\r\n}\r\n\r\nclass ListingDataLoader implements DataLoader<Metadata> {\r\n  _date: dayjs.Dayjs;\r\n  constructor(date: dayjs.ConfigType) {\r\n    this._date = dayjs(date).startOf(\"day\");\r\n  }\r\n  async getMetadata(): Promise<Metadata> {\r\n    return await apiGet<Metadata>(`count/${this._date.valueOf()}`);\r\n  }\r\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\r\n    return await apiGet<GameRecord[]>(`games/${this._date.valueOf()}?skip=${skip}&limit=${limit}&tag=${cacheTag}`);\r\n  }\r\n}\r\n\r\nclass PlayerDataLoader implements DataLoader<PlayerMetadata> {\r\n  _playerId: string;\r\n  _startDate?: dayjs.Dayjs;\r\n  _endDate?: dayjs.Dayjs;\r\n  _mode: string;\r\n  constructor(playerId: string, startDate?: dayjs.Dayjs, endDate?: dayjs.Dayjs, mode = \"\") {\r\n    this._playerId = playerId;\r\n    this._startDate = startDate;\r\n    this._endDate = endDate;\r\n    this._mode = mode;\r\n  }\r\n  _getDatePath(): string {\r\n    let result = \"\";\r\n    if (this._startDate) {\r\n      result += `/${this._startDate.valueOf()}`;\r\n      if (this._endDate) {\r\n        result += `/${this._endDate.valueOf()}`;\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n  _getParams(): string {\r\n    return `${this._playerId}${this._getDatePath()}?mode=${this._mode}`;\r\n  }\r\n  async getMetadata(): Promise<PlayerMetadata> {\r\n    return await apiGet<PlayerMetadata>(`player_stats/${this._getParams()}`).then(stats => {\r\n      stats.extended_stats = apiGet<PlayerExtendedStats>(`player_extended_stats/${this._getParams()}`).then(\r\n        extendedStats => (stats.extended_stats = extendedStats)\r\n      );\r\n      return stats;\r\n    });\r\n  }\r\n  async getRecords(skip: number, limit: number, cacheTag = \"\"): Promise<GameRecord[]> {\r\n    return await apiGet<GameRecord[]>(\r\n      `player_records/${this._playerId}${this._getDatePath()}?skip=${skip}&limit=${limit}&mode=${\r\n        this._mode\r\n      }&tag=${cacheTag}`\r\n    );\r\n  }\r\n}\r\n\r\nexport type FilterPredicate = ((record: GameRecord) => boolean) | null;\r\nexport type ListingDataProvider = DataProviderImpl<ListingDataLoader>;\r\nexport const ListingDataProvider = Object.freeze({\r\n  create(date: dayjs.ConfigType): ListingDataProvider {\r\n    return new DataProviderImpl<ListingDataLoader>(new ListingDataLoader(date));\r\n  }\r\n});\r\nexport type PlayerDataProvider = DataProviderImpl<PlayerDataLoader>;\r\nexport const PlayerDataProvider = Object.freeze({\r\n  create(\r\n    playerId: string,\r\n    startDate: dayjs.ConfigType | null,\r\n    endDate: dayjs.ConfigType | null,\r\n    mode: string\r\n  ): PlayerDataProvider {\r\n    return new DataProviderImpl<PlayerDataLoader>(\r\n      new PlayerDataLoader(\r\n        playerId,\r\n        startDate ? dayjs(startDate).startOf(\"day\") : undefined,\r\n        endDate ? dayjs(endDate).endOf(\"day\") : undefined,\r\n        mode\r\n      )\r\n    );\r\n  }\r\n});\r\nexport type DataProvider = ListingDataProvider | PlayerDataProvider;\r\nclass DataProviderImpl<\r\n  TLoader extends DataLoader<TMetadata>,\r\n  TMetadata extends Metadata = TLoader extends DataLoader<infer T> ? T : Metadata\r\n> {\r\n  _loader: TLoader;\r\n  _metadata: TMetadata | Promise<TMetadata> | null;\r\n  _countPromise: Promise<number> | null;\r\n  _chunks: (GameRecord[] | Promise<GameRecord[]>)[];\r\n  _itemsPerChunk: number;\r\n  _filterPredicate: FilterPredicate;\r\n  _filteredIndices: number[] | null;\r\n  _filterResultCache: { [uuid: string]: boolean };\r\n\r\n  constructor(loader: TLoader, itemsPerChunk = 100) {\r\n    this._loader = loader;\r\n    this._metadata = null;\r\n    this._countPromise = null;\r\n    this._chunks = [];\r\n    this._itemsPerChunk = itemsPerChunk;\r\n    this._filterPredicate = null;\r\n    this._filteredIndices = null;\r\n    this._filterResultCache = {};\r\n  }\r\n  setFilterPredicate(predicate: FilterPredicate) {\r\n    if (this._filterPredicate === predicate) {\r\n      return;\r\n    }\r\n    this._filterPredicate = predicate;\r\n    this._filterResultCache = {};\r\n    this.updateFilteredIndices();\r\n  }\r\n  updateFilteredIndices() {\r\n    this._filteredIndices = null;\r\n    if (!this._filterPredicate) {\r\n      return;\r\n    }\r\n    const metadata = this.getMetadataSync();\r\n    if (!metadata) {\r\n      return;\r\n    }\r\n    const count = metadata.count;\r\n    let numShownItems = 0;\r\n    let numLoadedItems = 0;\r\n    const indices = [];\r\n    for (let i = 0; i < count; i++) {\r\n      const chunk = this._chunks[Math.floor(i / this._itemsPerChunk)];\r\n      if (!chunk || chunk instanceof Promise) {\r\n        indices.push(i);\r\n        continue;\r\n      }\r\n      numLoadedItems++;\r\n      const game = chunk[i % this._itemsPerChunk];\r\n      let result = this._filterResultCache[game.uuid];\r\n      if (result === undefined) {\r\n        this._filterResultCache[game.uuid] = result = this._filterPredicate(game);\r\n      }\r\n      if (result) {\r\n        indices.push(i);\r\n        numShownItems++;\r\n      }\r\n    }\r\n    this._filteredIndices = indices;\r\n    if (numShownItems < 10 && numLoadedItems >= this._itemsPerChunk) {\r\n      this._triggerFullLoad();\r\n    }\r\n  }\r\n  getMetadataSync(): TMetadata | null {\r\n    return this._metadata && !(this._metadata instanceof Promise) ? this._metadata : null;\r\n  }\r\n  getCountMaybeSync(): number | Promise<number> {\r\n    const metadata = this.getMetadataSync();\r\n    if (metadata) {\r\n      return this._filteredIndices ? this._filteredIndices.length : metadata.count;\r\n    }\r\n    return this.getCount();\r\n  }\r\n  async getCount(): Promise<number> {\r\n    const metadata = this.getMetadataSync();\r\n    if (metadata) {\r\n      return this.getCountMaybeSync();\r\n    }\r\n    if (!this._metadata) {\r\n      this._metadata = this._loader.getMetadata().then(metadata => {\r\n        if (!metadata) {\r\n          console.log(\"No metadata returned\");\r\n          throw new Error(\"No metadata returned\");\r\n        }\r\n        this._metadata = metadata;\r\n        this.updateFilteredIndices();\r\n        this._countPromise = null;\r\n        return metadata;\r\n      });\r\n    }\r\n    if (this._countPromise) {\r\n      return this._countPromise;\r\n    }\r\n    this._countPromise = Promise.resolve(this._metadata)\r\n      .then(() => new Promise(resolve => setTimeout(resolve, 100)))\r\n      .then(() => this.getCountMaybeSync());\r\n    return this._countPromise;\r\n  }\r\n  getUnfilteredCountSync(): number | null {\r\n    const metadata = this.getMetadataSync();\r\n    if (!metadata) {\r\n      return null;\r\n    }\r\n    return metadata.count;\r\n  }\r\n  isItemLoaded(index: number): boolean {\r\n    const mappedIndex = this._mapItemIndex(index);\r\n    if (mappedIndex === null) {\r\n      return false;\r\n    }\r\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\r\n    return !!this._chunks[chunkNumber] && !(this._chunks[chunkNumber] instanceof Promise);\r\n  }\r\n  getItem(index: number, skipPreload = false): GameRecord | Promise<GameRecord | null> {\r\n    const mappedIndex = this._mapItemIndex(index);\r\n    if (mappedIndex === null) {\r\n      return this.getCount().then(count => {\r\n        if (index > count - 1 || this._mapItemIndex(index) === null) {\r\n          return null;\r\n        }\r\n        return this.getItem(index);\r\n      });\r\n    }\r\n    const chunkNumber = Math.floor(mappedIndex / this._itemsPerChunk);\r\n    const innerIndex = mappedIndex % this._itemsPerChunk;\r\n    const chunk = this._chunks[chunkNumber];\r\n    if (!chunk || chunk instanceof Promise) {\r\n      return this._getChunk(chunkNumber).then(chunk => chunk[innerIndex]);\r\n    }\r\n    if (!skipPreload && !this._filteredIndices) {\r\n      this.preload(index + this._itemsPerChunk);\r\n    }\r\n    return chunk[innerIndex];\r\n  }\r\n  preload(index: number) {\r\n    const count = this.getCountMaybeSync();\r\n    if (count instanceof Promise) {\r\n      return;\r\n    }\r\n    if (index >= count) {\r\n      return;\r\n    }\r\n    this.getItem(index, true);\r\n  }\r\n  _mapItemIndex(requestedIndex: number): number | null {\r\n    const count = this.getCountMaybeSync();\r\n    if (count instanceof Promise) {\r\n      return null;\r\n    }\r\n    if (requestedIndex < 0) {\r\n      return null;\r\n    }\r\n    // Descending order\r\n    const reversed = count - requestedIndex - 1;\r\n    if (reversed < 0) {\r\n      return null;\r\n    }\r\n    return this._filteredIndices ? this._filteredIndices[reversed] : reversed;\r\n  }\r\n  async _getChunk(chunkIndex: number): Promise<GameRecord[]> {\r\n    if (!this._chunks[chunkIndex]) {\r\n      this._chunks[chunkIndex] = this._loadChunk(chunkIndex);\r\n    }\r\n    return this._chunks[chunkIndex];\r\n  }\r\n  _triggerFullLoad() {\r\n    const count = this.getCountMaybeSync();\r\n    if (typeof count !== \"number\") {\r\n      return;\r\n    }\r\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\r\n    for (let i = 0; i < numChunks; i++) {\r\n      if (this._chunks[i]) {\r\n        continue;\r\n      }\r\n      this._getChunk(i);\r\n    }\r\n  }\r\n  async _loadChunk(chunkIndex: number): Promise<GameRecord[]> {\r\n    const count = await this.getCount();\r\n    const numChunks = Math.ceil(count / this._itemsPerChunk);\r\n    if (!numChunks) {\r\n      return [];\r\n    }\r\n    if (chunkIndex >= numChunks) {\r\n      console.warn(`Loading out-of-index chunk: ${chunkIndex}, number of items: ${count}`);\r\n      return [];\r\n    }\r\n    const chunk = await this._loader.getRecords(\r\n      this._itemsPerChunk * chunkIndex,\r\n      this._itemsPerChunk,\r\n      chunkIndex === numChunks - 1 ? count.toString() : \"\"\r\n    );\r\n    if (chunk.length < this._itemsPerChunk && chunkIndex < numChunks - 1) {\r\n      console.warn(\"Unexpected number of items in chunk:\", chunk.length);\r\n    }\r\n    this._chunks[chunkIndex] = chunk;\r\n    this.updateFilteredIndices();\r\n    return chunk;\r\n  }\r\n}\r\n","import React, { ReactNode } from \"react\";\r\n\r\nexport const Container = ({ title = undefined, children = undefined as ReactNode, fluid = false }) => (\r\n  <div className={`my-5 container${fluid ? \"-fluid\" : \"\"}`}>\r\n    <div className=\"row\">\r\n      <div className=\"col-sm-12\">\r\n        {title && <h2 className=\"mb-4\">{title}</h2>}\r\n        {children}\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n","import { useState, useEffect, ReactNode } from \"react\";\r\nimport React from \"react\";\r\nimport { ReactComponentLike } from \"prop-types\";\r\nimport { triggerRelayout } from \"../../utils/index\";\r\n\r\nexport function Alert({\r\n  className = \"\",\r\n  type = \"info\",\r\n  container = React.Fragment as ReactComponentLike,\r\n  stateName = \"\",\r\n  closable = true,\r\n  children = undefined as ReactNode\r\n}) {\r\n  const stateKey = `alertState_${stateName}`;\r\n  const [closed, setClosed] = useState(() => stateName && !!localStorage.getItem(stateKey));\r\n  useEffect(() => {\r\n    if (stateName && closed) {\r\n      localStorage.setItem(stateKey, \"true\");\r\n    }\r\n  }, [closed, stateName, stateKey]);\r\n  if (closed && closable) {\r\n    return null;\r\n  }\r\n  const Cont = container;\r\n  return (\r\n    <Cont>\r\n      <div className={`alert alert-${type} alert-dismissible fade show ${className}`} role=\"alert\">\r\n        {children}\r\n        {closable && (\r\n          <button\r\n            type=\"button\"\r\n            className=\"close\"\r\n            data-dismiss=\"alert\"\r\n            aria-label=\"Close\"\r\n            onClick={event => {\r\n              event.preventDefault();\r\n              setClosed(true);\r\n              triggerRelayout();\r\n            }}\r\n          >\r\n            <span aria-hidden=\"true\">×</span>\r\n          </button>\r\n        )}\r\n      </div>\r\n    </Cont>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { Container } from \"../layout\";\r\nimport { Alert } from \"../misc/alert\";\r\nimport { TITLE_PREFIX } from \"../../utils/constants\";\r\n\r\nexport function AppHeader() {\r\n  return (\r\n    <React.Fragment>\r\n      <Container>\r\n        <h1>\r\n          <Link to=\"/\">{TITLE_PREFIX}</Link>\r\n        </h1>\r\n      </Container>\r\n      <Alert container={Container} stateName=\"topNote\">\r\n        <h4>说明</h4>\r\n        <ul>\r\n          <li>本页面数据由第三方维护，不能绝对保证完整和正确，信息仅供参考，请勿用于不良用途。</li>\r\n          <li>记录包含雀魂国服四人半庄段位战玉之间及王座之间的牌谱。</li>\r\n          <li>对局数据收集从 2019 年 8 月 23 日开始，之前的对局已无法获取。</li>\r\n          <li>\r\n            正常情况下全部对局都会被记录，但不排除因网络问题遗漏部分对局的情况。另 2019 年 10 月 10 日前因程序 Bug\r\n            每天晚间可能遗漏掉 10% ~ 20% 的对局，此 Bug 目前已经修复。\r\n          </li>\r\n          <li>页面不是实时更新，对局一般会在结束后数分钟至数小时内出现。</li>\r\n          <li>\r\n            如有问题或建议，请戳 <a href=\"mailto:i@sapika.ch\">SAPikachu (i@sapika.ch)</a> 或{\" \"}\r\n            <a href=\"https://github.com/SAPikachu/amae-koromo/\">提交 Issue</a>。\r\n          </li>\r\n        </ul>\r\n      </Alert>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import * as React from \"react\";\nimport { useState } from \"react\";\n\nimport { Alert } from \"../misc/alert\";\nimport { Container } from \"../layout/container\";\nimport { setMaintenanceHandler } from \"../../utils/dataSource\";\n\nexport function MaintenanceHandler({ children }: { children: React.ReactElement }): React.ReactElement {\n  const [msg, setMsg] = useState(\"\");\n  setMaintenanceHandler(setMsg);\n  if (!msg) {\n    return children;\n  }\n  return (\n    <Alert container={Container} closable={false}>\n      <h4>临时维护公告</h4>\n      <p>{msg}</p>\n    </Alert>\n  );\n}\n","import React from \"react\";\r\n\r\nimport { BrowserRouter as Router } from \"react-router-dom\";\r\nimport Loadable from \"react-loadable\";\r\nconst Helmet = Loadable({\r\n  loader: () => import(\"react-helmet\"),\r\n  loading: () => <></>\r\n});\r\n\r\nimport Scroller from \"../misc/scroller\";\r\n\r\nimport { Container } from \"../layout\";\r\nimport { AppHeader } from \"./appHeader\";\r\nimport GameRecords from \"../gameRecords\";\r\nimport { TITLE_PREFIX } from \"../../utils/constants\";\r\nimport { MaintenanceHandler } from \"./maintenance\";\r\n\r\nfunction App() {\r\n  return (\r\n    <Router>\r\n      <Helmet>\r\n        <title>{TITLE_PREFIX}</title>\r\n      </Helmet>\r\n      <MaintenanceHandler>\r\n        <Scroller>\r\n          <AppHeader />\r\n          <Container>\r\n            <GameRecords />\r\n          </Container>\r\n        </Scroller>\r\n      </MaintenanceHandler>\r\n    </Router>\r\n  );\r\n}\r\nexport default App;\r\n","import * as React from \"react\";\nimport { render } from \"react-dom\";\n\nimport \"./styles/bootstrap-custom.scss\";\nimport \"./styles/styles.scss\";\n\nimport App from \"./components/app\";\n\nconst rootElement = document.getElementById(\"root\");\nrender(<App />, rootElement);\n","import dayjs from \"dayjs\";\r\n\r\nexport const DATA_ROOT = \"https://ak-data-1.sapk.ch/\";\r\nconst API_ROOT_PROD = `${DATA_ROOT}api/`;\r\nconst API_ROOT_TEST = `${DATA_ROOT}api-test/`;\r\nexport const API_ROOT = process.env.NODE_ENV === \"development\" ? API_ROOT_TEST : API_ROOT_PROD;\r\nexport const TITLE_PREFIX = \"雀魂牌谱屋\";\r\nexport const DATE_MIN = dayjs(\"2019-08-23\", \"YYYY-MM-DD\");\r\n","import React from \"react\";\r\n\r\nexport interface CheckboxItem {\r\n  key: string;\r\n  label: string;\r\n}\r\n\r\ntype CommonGroupParams = {\r\n  items: CheckboxItem[];\r\n  groupKey: string;\r\n};\r\ntype CheckboxGroupParams = CommonGroupParams & {\r\n  type: \"checkbox\";\r\n  selectedItemKeys: Set<string> | null;\r\n  onChange: (selectedItemKeys: Set<string>) => void;\r\n};\r\ntype RadioGroupParams = CommonGroupParams & {\r\n  type: \"radio\";\r\n  selectedItemKey: string;\r\n  onChange: (selectedItemKey: string) => void;\r\n};\r\n\r\nexport function CheckboxGroup(\r\n  props: CheckboxGroupParams | RadioGroupParams = {\r\n    type: \"checkbox\",\r\n    items: [],\r\n    groupKey: \"default\",\r\n    selectedItemKeys: null,\r\n    onChange: () => {}\r\n  }\r\n) {\r\n  const { type, items, groupKey } = props;\r\n  const { setSelected, isChecked } = (() => {\r\n    if (props.type === \"checkbox\") {\r\n      const { selectedItemKeys, onChange } = props;\r\n      return {\r\n        setSelected(key: string, isSelected: boolean) {\r\n          if (isSelected && (!selectedItemKeys || selectedItemKeys.has(key))) {\r\n            return;\r\n          }\r\n          if (!isSelected && selectedItemKeys && !selectedItemKeys.has(key)) {\r\n            return;\r\n          }\r\n          const newSet = new Set(selectedItemKeys || items.map(x => x.key));\r\n          if (isSelected) {\r\n            newSet.add(key);\r\n          } else {\r\n            newSet.delete(key);\r\n          }\r\n          onChange(newSet);\r\n        },\r\n        isChecked: (key: string) => !selectedItemKeys || selectedItemKeys.has(key)\r\n      };\r\n    } else {\r\n      const { selectedItemKey, onChange } = props;\r\n      return {\r\n        setSelected(key: string, isSelected: boolean) {\r\n          if (!isSelected) {\r\n            return;\r\n          }\r\n          onChange(key);\r\n        },\r\n        isChecked: (key: string) => selectedItemKey === key\r\n      };\r\n    }\r\n  })();\r\n  return (\r\n    <React.Fragment>\r\n      {items.map(item => (\r\n        <div className=\"form-check form-check-inline\" key={item.key}>\r\n          <input\r\n            className=\"form-check-input\"\r\n            type={type}\r\n            id={`CG_${groupKey}_${item.key}`}\r\n            name={`CG_${groupKey}_${item.key}`}\r\n            value={item.key}\r\n            checked={isChecked(item.key)}\r\n            onChange={event => setSelected(item.key, event.currentTarget.checked)}\r\n          />\r\n          <label className=\"form-check-label\" htmlFor={`CG_${groupKey}_${item.key}`}>\r\n            {item.label}\r\n          </label>\r\n        </div>\r\n      ))}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from \"react\";\r\n\r\nimport dayjs from \"dayjs\";\r\nimport { useCallback } from \"react\";\r\n\r\nexport function DatePicker({\r\n  date = dayjs() as dayjs.ConfigType,\r\n  onChange = (() => {}) as (_: dayjs.Dayjs) => void,\r\n  className = \"\",\r\n  min = 0 as dayjs.ConfigType,\r\n  max = dayjs() as dayjs.ConfigType\r\n}) {\r\n  const handleChange = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => onChange(dayjs(e.currentTarget.value, \"YYYY-MM-DD\")),\r\n    [onChange]\r\n  );\r\n  return (\r\n    <input\r\n      className={className}\r\n      type=\"date\"\r\n      value={dayjs(date).format(\"YYYY-MM-DD\")}\r\n      min={min ? dayjs(min).format(\"YYYY-MM-DD\") : undefined}\r\n      max={max ? dayjs(max).format(\"YYYY-MM-DD\") : undefined}\r\n      onChange={handleChange}\r\n    />\r\n  );\r\n}\r\n","export * from \"./checkboxGroup\";\r\nexport * from \"./datePicker\";\r\nexport * from \"./formRow\";\r\n","import { useState, useEffect } from \"react\";\r\nexport function triggerRelayout() {\r\n  requestAnimationFrame(() => window.dispatchEvent(new UIEvent(\"resize\")));\r\n  setTimeout(function() {\r\n    window.dispatchEvent(new UIEvent(\"resize\"));\r\n  }, 200);\r\n}\r\nexport function scrollToTop() {\r\n  window.scrollTo(0, 0);\r\n  requestAnimationFrame(() => window.scrollTo(0, 0));\r\n}\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport const formatPercent = (x: any) => (x > 0 ? `${(x * 100).toFixed(2)}%` : \"\");\r\n\r\ntype NotFinished = { notFinished: string };\r\nconst NOT_FINISHED = { notFinished: \"yes\" };\r\n\r\nexport function useAsync<T>(maybePromise: T | Promise<T>): T | undefined {\r\n  const [fulfilledValue, setFulfilledValue] = useState<T | NotFinished>(NOT_FINISHED);\r\n  useEffect(() => {\r\n    if (maybePromise instanceof Promise) {\r\n      setFulfilledValue(NOT_FINISHED);\r\n      maybePromise.then(result => setFulfilledValue(result));\r\n    } else {\r\n      setFulfilledValue(maybePromise);\r\n    }\r\n  }, [maybePromise]);\r\n  if (fulfilledValue !== NOT_FINISHED) {\r\n    return fulfilledValue as T;\r\n  }\r\n  return undefined;\r\n}\r\n","import React from \"react\";\n\nexport default function Loading({ size = \"normal\" }: { size?: \"normal\" | \"small\" }) {\n  return (\n    <div className={`d-flex justify-content-center m-${size === \"normal\" ? 5 : 1}`}>\n      <div className={`spinner-border ${size === \"normal\" ? \"\" : \"spinner-border-sm\"}`} role=\"status\">\n        <span className=\"sr-only\">Loading...</span>\n      </div>\n    </div>\n  );\n}\n","import dayjs from \"dayjs\";\n\nexport const PLAYER_RANKS = \"初士杰豪圣魂\";\nconst LEVEL_MAX_POINTS = [20, 80, 200, 600, 800, 1000, 1200, 1400, 2000, 2800, 3200, 3600, 4000, 6000, 9000];\nconst LEVEL_PENALTY = [0, 0, 0, 20, 40, 60, 80, 100, 120, 165, 180, 195, 210, 225, 240, 255];\nconst RANK_DELTA = [15, 5, -5, -15];\nconst MODE_DELTA = {\n  \"12\": [110, 55, 0, 0],\n  \"16\": [120, 60, 0, 0]\n};\nexport const RANK_LABELS = [\"一位\", \"二位\", \"三位\", \"四位\"];\nexport const RANK_COLORS = [\"#28a745\", \"#17a2b8\", \"#6c757d\", \"#dc3545\"];\n\nexport enum GameMode {\n  王座 = 16,\n  玉 = 12\n}\nconst LEVEL_ALLOWED_MODES: { [key: string]: GameMode[] } = {\n  \"1\": [],\n  \"2\": [],\n  \"3\": [],\n  \"4\": [GameMode.玉],\n  \"5\": [GameMode.玉, GameMode.王座],\n  \"6\": [GameMode.王座]\n};\nexport const NUMBER_OF_GAME_MODE = Object.keys(GameMode).filter(\n  x => typeof GameMode[x as keyof typeof GameMode] === \"number\"\n).length;\n\nexport interface PlayerRecord {\n  accountId: number;\n  nickname: string;\n  level: number;\n  score: number;\n}\nexport interface GameRecord {\n  modeId: GameMode;\n  uuid: string;\n  startTime: number;\n  endTime: number;\n  players: PlayerRecord[];\n}\nexport const GameRecord = Object.freeze({\n  getRankIndexByPlayer(rec: GameRecord, player: number | string | PlayerRecord): number {\n    const playerId = (typeof player === \"object\" ? player.accountId : player).toString();\n    const sortedPlayers = rec.players.map((player, index) => ({ player, index }));\n    sortedPlayers.sort((a, b) => 5 - b.index + b.player.score - (5 - a.index + a.player.score));\n    for (let i = 0; i < sortedPlayers.length; i++) {\n      if (sortedPlayers[i].player.accountId.toString() === playerId) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  getPlayerRankLabel(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return RANK_LABELS[GameRecord.getRankIndexByPlayer(rec, player)] || \"\";\n  },\n  getPlayerRankColor(rec: GameRecord, player: number | string | PlayerRecord): string {\n    return RANK_COLORS[GameRecord.getRankIndexByPlayer(rec, player)];\n  },\n  encodeAccountId: (t: number) => 1358437 + ((7 * t + 1117113) ^ 86216345),\n  formatFullStartTime: (rec: GameRecord) => dayjs(rec.startTime * 1000).format(\"YYYY/M/D HH:mm\"),\n  getRecordLink(rec: GameRecord, player?: PlayerRecord | number | string) {\n    const playerId = typeof player === \"object\" ? player.accountId : player;\n    const trailer = playerId\n      ? `_a${GameRecord.encodeAccountId(typeof playerId === \"number\" ? playerId : parseInt(playerId))}`\n      : \"\";\n    return `https://www.majsoul.com/1/?paipu=${rec.uuid}${trailer}`;\n  }\n});\n\nfunction calculateDeltaPoint(score: number, rank: number, mode: GameMode, level: Level): number {\n  let result =\n    Math.ceil((score - 25000) / 1000 + RANK_DELTA[rank]) + MODE_DELTA[mode.toString() as keyof typeof MODE_DELTA][rank];\n  if (rank === 3) {\n    result -= level.getPenaltyPoint();\n  }\n  /*\n  console.log(\n    `calculateDeltaPoint: score=${score}, rank=${rank}, mode=${mode}, level=${level.getTag()}, result=${result}`\n  );\n  */\n  return result;\n}\n\nclass Level {\n  _majorRank: number;\n  _minorRank: number;\n  constructor(levelId: number) {\n    const realId = levelId % 10000;\n    this._majorRank = Math.floor(realId / 100);\n    this._minorRank = realId % 100;\n  }\n  isSameMajorRank(other: Level): boolean {\n    return this._majorRank === other._majorRank;\n  }\n  isAllowedMode(mode: GameMode): boolean {\n    return LEVEL_ALLOWED_MODES[this._majorRank.toString() as keyof typeof LEVEL_ALLOWED_MODES].includes(mode);\n  }\n  getTag(): string {\n    const label = PLAYER_RANKS[this._majorRank - 1];\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return label;\n    }\n    return label + this._minorRank;\n  }\n  getMaxPoint(): number {\n    return LEVEL_MAX_POINTS[(this._majorRank - 1) * 3 + this._minorRank - 1];\n  }\n  getPenaltyPoint(): number {\n    return LEVEL_PENALTY[(this._majorRank - 1) * 3 + this._minorRank - 1];\n  }\n  getStartingPoint(): number {\n    if (this._majorRank === 1) {\n      return 0;\n    }\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return 10000;\n    }\n    return this.getMaxPoint() / 2;\n  }\n  getNextLevel(): Level {\n    if (this._majorRank === PLAYER_RANKS.length) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank + 1;\n    if (minorRank > 3) {\n      majorRank++;\n      minorRank = 1;\n    }\n    return new Level(majorRank * 100 + minorRank);\n  }\n  getPreviousLevel(): Level {\n    if (this._majorRank === 1 && this._minorRank === 1) {\n      return this;\n    }\n    let majorRank = this._majorRank;\n    let minorRank = this._minorRank - 1;\n    if (minorRank < 1) {\n      majorRank--;\n      minorRank = 3;\n    }\n    return new Level(majorRank * 100 + minorRank);\n  }\n  getAdjustedLevel(score: number): Level {\n    let maxPoints = this.getMaxPoint();\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let level: Level = this;\n    if (maxPoints && score >= maxPoints) {\n      level = this.getNextLevel();\n      maxPoints = level.getMaxPoint();\n      score = level.getStartingPoint();\n    } else if (score < 0) {\n      if (!maxPoints || level._majorRank === 1 || (level._majorRank === 2 && level._minorRank === 1)) {\n        score = 0;\n      } else {\n        level = this.getPreviousLevel();\n        maxPoints = level.getMaxPoint();\n        score = level.getStartingPoint();\n      }\n    }\n    return level;\n  }\n  formatAdjustedScoreWithTag(score: number) {\n    const level = this.getAdjustedLevel(score);\n    return `${level.getTag()} - ${this.formatAdjustedScore(score)}`;\n  }\n  formatAdjustedScore(score: number) {\n    const level = this.getAdjustedLevel(score);\n    return `${level === this ? Math.max(score, 0) : level.getStartingPoint()}${\n      level.getMaxPoint() ? \"/\" + level.getMaxPoint() : \"\"\n    }`;\n  }\n}\nexport function getLevelTag(levelId: number) {\n  return new Level(levelId).getTag();\n}\nexport type LevelWithDelta = {\n  id: number;\n  score: number;\n  delta: number;\n};\nexport const LevelWithDelta = Object.freeze({\n  format(obj: LevelWithDelta): string {\n    return new Level(obj.id).formatAdjustedScoreWithTag(obj.score + obj.delta);\n  },\n  formatAdjustedScore(obj: LevelWithDelta): string {\n    return new Level(obj.id).formatAdjustedScore(obj.score + obj.delta);\n  },\n  getTag(obj: LevelWithDelta): string {\n    return LevelWithDelta.getAdjustedLevel(obj).getTag();\n  },\n  getAdjustedLevel(obj: LevelWithDelta): Level {\n    return new Level(obj.id).getAdjustedLevel(obj.score + obj.delta);\n  }\n});\n\nexport interface Metadata {\n  count: number;\n}\nexport interface PlayerMetadataLite extends Metadata {\n  id: number;\n  nickname: string;\n  level: LevelWithDelta;\n}\nexport interface PlayerMetadata extends PlayerMetadataLite {\n  rank_rates: [number, number, number, number];\n  rank_avg_score: [number, number, number, number];\n  avg_rank: number;\n  negative_rate: number;\n  extended_stats?: PlayerExtendedStats | Promise<PlayerExtendedStats>;\n}\nexport const PlayerMetadata = Object.freeze({\n  calculateExpectedGamePoint(metadata: PlayerMetadata, mode: GameMode, level?: Level): number {\n    const rankDeltaPoints = metadata.rank_avg_score.map((score, rank) =>\n      calculateDeltaPoint(score, rank, mode, level || LevelWithDelta.getAdjustedLevel(metadata.level))\n    );\n    const rankWeightedPoints = rankDeltaPoints.map((point, rank) => point * metadata.rank_rates[rank]);\n    const expectedGamePoint = rankWeightedPoints.reduce((a, b) => a + b, 0);\n    /*\n    console.log(rankDeltaPoints);\n    console.log(rankWeightedPoints);\n    console.log(\n      `calculateExpectedGamePoint: mode=${mode}, level=${level ? level.getTag() : \"\"}, result=${expectedGamePoint}`\n    );\n    */\n    return expectedGamePoint;\n  },\n  estimateStableLevel(metadata: PlayerMetadata, mode: GameMode): string {\n    let level = new Level(metadata.level.id);\n    let lastPositiveLevel: Level | undefined = undefined;\n    for (;;) {\n      const expectedGamePoint = PlayerMetadata.calculateExpectedGamePoint(metadata, mode, level);\n      if (Math.abs(expectedGamePoint) < 0.001) {\n        return level.getTag();\n      }\n      if (expectedGamePoint >= 0) {\n        lastPositiveLevel = level;\n        level = level.getNextLevel();\n        if (!level.isAllowedMode(mode)) {\n          return lastPositiveLevel.getTag() + \"+\";\n        }\n        if (level === lastPositiveLevel) {\n          return level.getTag() + \"+\";\n        }\n      } else {\n        if (lastPositiveLevel) {\n          return lastPositiveLevel.getTag();\n        }\n        break;\n      }\n    }\n    if (!level.getMaxPoint()) {\n      // 魂天不会掉段\n      return level.getTag() + \"-\";\n    }\n    for (;;) {\n      const prevLevel = level.getPreviousLevel();\n      if (!prevLevel.isAllowedMode(mode) || prevLevel === level) {\n        return level.getTag() + \"-\";\n      }\n      level = prevLevel;\n      const expectedGamePoint = PlayerMetadata.calculateExpectedGamePoint(metadata, mode, level);\n      if (expectedGamePoint + 0.001 >= 0) {\n        return level.getTag();\n      }\n    }\n  }\n});\nexport interface PlayerExtendedStats {\n  id: number;\n  和牌率: number;\n  自摸率: number;\n  默听率: number;\n  放铳率: number;\n  副露率: number;\n  立直率: number;\n  平均打点: number;\n  最大连庄: number;\n  和了巡数: number;\n  平均铳点: number;\n  流局率: number;\n  流听率: number;\n}\n","import React from \"react\";\nimport dayjs from \"dayjs\";\n\nimport { useParams, useLocation, Redirect } from \"react-router\";\nimport { useModel, Model, ModelPlain } from \"./model\";\nimport { generatePath } from \"./routes\";\nimport { useEffect } from \"react\";\nimport { scrollToTop, triggerRelayout } from \"../../utils/index\";\n\ntype ListingRouteParams = {\n  date?: string;\n  mode?: string;\n  search?: string;\n};\n\ntype PlayerRouteParams = {\n  id: string;\n  startDate?: string;\n  endDate?: string;\n  mode?: string;\n};\n\ntype HistoryState = {\n  model: ModelPlain;\n  pathname: string;\n};\n\nfunction parseOptionalDate<T>(s: string | null | undefined, defaultValue: T): dayjs.Dayjs | T {\n  return s ? dayjs(s, \"YYYY-MM-DD\") : defaultValue;\n}\n\nconst ModelBuilders = {\n  player(params: PlayerRouteParams): Model | string {\n    return {\n      type: \"player\",\n      playerId: params.id,\n      startDate: parseOptionalDate(params.startDate, null),\n      endDate: parseOptionalDate(params.endDate, null),\n      selectedMode: params.mode || \"\",\n      version: 0\n    };\n  },\n  listing(params: ListingRouteParams): Model | string {\n    const date = parseOptionalDate(params.date, null);\n    if (date && !date.isValid()) {\n      return \"/\";\n    }\n    return {\n      type: undefined,\n      date: date ? date.startOf(\"day\").valueOf() : null,\n      selectedMode: params.mode || \"\",\n      searchText: params.search || \"\",\n      version: 0\n    };\n  }\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function RouteSync({ view }: { view: keyof typeof ModelBuilders }): React.FunctionComponentElement<any> {\n  const params = useParams();\n  const [model, updateModel] = useModel();\n  const location = useLocation<HistoryState>();\n  useEffect(triggerRelayout, [model.type]);\n  const state = location.state;\n  // console.log(params, model, location, state);\n  if (state && state.model.version === model.version) {\n    delete (model as Model).pendingRouteUpdate;\n    if (location.pathname !== state.pathname) {\n      return <Redirect to={{ pathname: state.pathname, state }} />;\n    }\n    return <></>;\n  }\n  if (!state) {\n    // Navigation\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const modelResult = ModelBuilders[view](params as any);\n    if (typeof modelResult === \"string\") {\n      return <Redirect to={modelResult} />;\n    }\n    const newModel: Model = {\n      ...modelResult,\n      version: model.version\n    };\n    updateModel(newModel);\n    scrollToTop();\n    return (\n      <Redirect\n        to={{ pathname: location.pathname, state: { pathname: location.pathname, model: Model.toPlain(newModel) } }}\n      />\n    );\n  }\n  if (model.pendingRouteUpdate) {\n    // Model updated\n    const newPath = generatePath(model);\n    delete (model as Model).pendingRouteUpdate; // Do not trigger update\n    return <Redirect to={{ pathname: newPath, state: { pathname: newPath, model: Model.toPlain(model) } }} />;\n  } else {\n    const restoredModel = Model.fromPlain(state.model);\n    updateModel(restoredModel);\n    return <></>;\n  }\n}\n","import { useCallback } from \"react\";\r\nimport React from \"react\";\r\n\r\nimport { FormRow, DatePicker } from \"../form\";\r\nimport { useModel } from \"./model\";\r\nimport dayjs from \"dayjs\";\r\nimport { DATE_MIN } from \"../../utils/constants\";\r\nimport { ModeSelector } from \"./modeSelector\";\r\n\r\nconst DEFAULT_DATE = dayjs().startOf(\"day\");\r\n\r\nexport function FilterPanel({ className = \"\" }) {\r\n  const [model, updateModel] = useModel();\r\n  const updateSearchTextFromEvent = useCallback(\r\n    (e: React.ChangeEvent<HTMLInputElement>) => updateModel({ searchText: e.currentTarget.value }),\r\n    [updateModel]\r\n  );\r\n  const setMode = useCallback((mode: string) => updateModel({ selectedMode: mode }), [updateModel]);\r\n  const setDate = useCallback((date: dayjs.ConfigType) => updateModel({ date }), [updateModel]);\r\n  if (model.type !== undefined) {\r\n    return null;\r\n  }\r\n  return (\r\n    <div className={className}>\r\n      <FormRow title=\"日期\">\r\n        <DatePicker min={DATE_MIN} date={model.date || DEFAULT_DATE} onChange={setDate} className=\"form-control\" />\r\n      </FormRow>\r\n      <FormRow title=\"查找玩家\">\r\n        <input type=\"text\" className=\"form-control\" value={model.searchText} onChange={updateSearchTextFromEvent} />\r\n      </FormRow>\r\n      <FormRow>\r\n        <ModeSelector mode={model.selectedMode} onChange={setMode} />\r\n      </FormRow>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\nimport { useEffect, useState, useMemo } from \"react\";\n\nimport { useModel } from \"./model\";\nimport Loading from \"../misc/loading\";\nimport { PlayerMetadataLite, getLevelTag } from \"../../utils/dataTypes\";\nimport { searchPlayer } from \"../../utils/dataSource\";\nimport { Link } from \"react-router-dom\";\nimport { generatePlayerPathById } from \"./routes\";\n\nconst playerSearchCache = {} as { [prefix: string]: PlayerMetadataLite[] | Promise<PlayerMetadataLite[]> };\nconst NUM_RESULTS_SHOWN = 6;\nconst NUM_FETCH = 20;\n\nconst normalizeName = (s: string) => s.toLowerCase().trim();\n\nfunction findRawResultFromCache(prefix: string): { result: PlayerMetadataLite[]; isExactMatch: boolean } | null {\n  const normalizedPrefix = normalizeName(prefix);\n  prefix = normalizedPrefix;\n  while (prefix) {\n    const players = playerSearchCache[prefix];\n    if (!players || players instanceof Promise) {\n      prefix = prefix.slice(0, prefix.length - 1);\n      continue;\n    }\n    return {\n      isExactMatch: prefix === normalizedPrefix,\n      result: players\n    };\n  }\n  return null;\n}\n\nfunction PlayerSearchResult({ searchText }: { searchText: string }) {\n  const [version, setVersion] = useState(0);\n  const [players, isLoading, mayHaveMore] = useMemo(() => {\n    const cachedResult = findRawResultFromCache(searchText);\n    if (!cachedResult) {\n      return [[], true];\n    }\n    if (cachedResult.isExactMatch) {\n      return [cachedResult.result, false];\n    }\n    const normalizedPrefix = normalizeName(searchText);\n    let mayHaveMore = cachedResult.result.length >= NUM_FETCH;\n    const filteredPlayers = [] as PlayerMetadataLite[];\n    cachedResult.result.forEach(player => {\n      if (normalizeName(player.nickname).startsWith(normalizedPrefix)) {\n        filteredPlayers.push(player);\n      } else if (filteredPlayers.length) {\n        // Result covers all players who have the specified prefix\n        mayHaveMore = false;\n      }\n    });\n    return [filteredPlayers, mayHaveMore && filteredPlayers.length < NUM_RESULTS_SHOWN, mayHaveMore];\n  }, [searchText, version]);\n  useEffect(() => {\n    const prefix = normalizeName(searchText);\n    if (playerSearchCache[prefix]) {\n      return;\n    }\n    if (!isLoading) {\n      return;\n    }\n    let cancelled = false;\n    let debounceToken: NodeJS.Timeout | undefined = setTimeout(() => {\n      debounceToken = undefined;\n      if (cancelled) {\n        return;\n      }\n      if (playerSearchCache[prefix]) {\n        return;\n      }\n      playerSearchCache[prefix] = searchPlayer(prefix).then(function(players) {\n        playerSearchCache[prefix] = players;\n        if (!cancelled) {\n          setVersion(new Date().getTime());\n        }\n        return players;\n      });\n    }, 500);\n    return () => {\n      cancelled = true;\n      if (debounceToken) {\n        clearTimeout(debounceToken);\n      }\n    };\n  }, [searchText, isLoading]);\n  return (\n    <>\n      <h6 className=\"text-center mb-2\">玩家前缀搜索</h6>\n      <ul className=\"list-unstyled row mb-2\">\n        {players.slice(0, NUM_RESULTS_SHOWN).map(x => (\n          <li key={x.id} className=\"col-6\">\n            <Link to={generatePlayerPathById(x.id)}>\n              <span>\n                [{getLevelTag(x.level.id)}] {x.nickname}\n              </span>\n            </Link>\n          </li>\n        ))}\n      </ul>\n      {(isLoading && <Loading size=\"small\" />) ||\n        ((players.length > NUM_RESULTS_SHOWN || mayHaveMore) && (\n          <small className=\"d-block text-center text-muted\">（输入更长名字显示其它结果）</small>\n        ))}\n    </>\n  );\n}\n\nexport function PlayerSearch({ className = \"\" }) {\n  const [model] = useModel();\n  if (\"playerId\" in model || !model.searchText) {\n    return <></>;\n  }\n  return (\n    <div className={className}>\n      <PlayerSearchResult searchText={model.searchText} />\n    </div>\n  );\n}\n","import React from \"react\";\n\nimport { Switch, Route, Redirect, generatePath as genPath } from \"react-router-dom\";\n\nimport { Model, ModelProvider } from \"./model\";\nimport dayjs from \"dayjs\";\nimport { RouteSync } from \"./routeSync\";\nimport { DataAdapterProvider } from \"./dataAdapterProvider\";\nimport { FilterPanel } from \"./filterPanel\";\nimport Loadable from \"react-loadable\";\nimport Loading from \"../misc/loading\";\nimport { PlayerSearch } from \"./playerSearch\";\nconst PlayerDetails = Loadable({\n  loader: () => import(\"./playerDetails\"),\n  loading: () => <Loading />\n});\nconst GameRecordTable = Loadable({\n  loader: () => import(\"./table\"),\n  loading: () => <Loading />\n});\n\nconst PLAYER_PATH = \"/player/:id/:mode([0-9]+)?/:startDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?/:endDate(\\\\d{4}-\\\\d{2}-\\\\d{2})?\";\nconst PATH = \"/:date(\\\\d{4}-\\\\d{2}-\\\\d{2})/:mode([0-9]+)?/:search?\";\n\nexport function generatePath(model: Model): string {\n  if (model.type === \"player\") {\n    return genPath(PLAYER_PATH, {\n      id: model.playerId,\n      startDate: model.startDate ? dayjs(model.startDate).format(\"YYYY-MM-DD\") : undefined,\n      endDate: model.endDate ? dayjs(model.endDate).format(\"YYYY-MM-DD\") : undefined,\n      mode: model.selectedMode || undefined\n    });\n  }\n  if (!model.selectedMode && !model.searchText && !model.date) {\n    return \"/\";\n  }\n  return genPath(PATH, {\n    date: dayjs(model.date || new Date()).format(\"YYYY-MM-DD\"),\n    mode: model.selectedMode || undefined,\n    search: model.searchText || undefined\n  });\n}\nexport function generatePlayerPathById(playerId: number | string): string {\n  return generatePath({\n    type: \"player\",\n    playerId: playerId.toString(),\n    startDate: null,\n    endDate: null,\n    selectedMode: \"\",\n    version: 0\n  });\n}\n\nfunction Routes() {\n  return (\n    <ModelProvider>\n      <DataAdapterProvider>\n        <Switch>\n          <Route exact path={PLAYER_PATH}>\n            <RouteSync view=\"player\" />\n            <PlayerDetails />\n            <GameRecordTable showFullTime showStartEnd={false} />\n          </Route>\n          <Route exact path={[\"/\", PATH]}>\n            <RouteSync view=\"listing\" />\n            <div className=\"row\">\n              <FilterPanel className=\"col\" />\n              <PlayerSearch className=\"col-12 col-sm-6 col-md-4\" />\n            </div>\n            <GameRecordTable />\n          </Route>\n          <Route>\n            <Redirect to=\"/\" />\n          </Route>\n        </Switch>\n      </DataAdapterProvider>\n    </ModelProvider>\n  );\n}\nexport default Routes;\n","import dayjs from \"dayjs\";\r\nimport React, { useReducer, useContext, ReactChild } from \"react\";\r\nimport { useMemo } from \"react\";\r\nimport { useLocation } from \"react-router\";\r\n\r\ninterface WithRuntimeInfo {\r\n  version: number;\r\n  pendingRouteUpdate?: boolean;\r\n}\r\nexport interface ListingModel {\r\n  type: undefined;\r\n  date: dayjs.ConfigType | null;\r\n  selectedMode: string;\r\n  searchText: string;\r\n}\r\nexport interface PlayerModel {\r\n  type: \"player\";\r\n  playerId: string;\r\n  startDate: dayjs.ConfigType | null;\r\n  endDate: dayjs.ConfigType | null;\r\n  selectedMode: string;\r\n}\r\nexport type Model = (ListingModel | PlayerModel) & WithRuntimeInfo;\r\ninterface ListingModelPlain {\r\n  type: undefined;\r\n  date: number | null;\r\n  selectedMode: string;\r\n  searchText: string;\r\n}\r\nexport interface PlayerModelPlain {\r\n  type: \"player\";\r\n  playerId: string;\r\n  startDate: number | null;\r\n  endDate: number | null;\r\n  selectedMode: string;\r\n}\r\nexport type ModelPlain = (ListingModelPlain | PlayerModelPlain) & WithRuntimeInfo;\r\nexport const Model = Object.freeze({\r\n  toPlain(model: Model): ModelPlain {\r\n    if (model.type === \"player\") {\r\n      return {\r\n        ...model,\r\n        startDate: model.startDate ? dayjs(model.startDate).valueOf() : null,\r\n        endDate: model.endDate ? dayjs(model.endDate).valueOf() : null\r\n      };\r\n    }\r\n    return {\r\n      ...model,\r\n      type: undefined,\r\n      date: model.date ? dayjs(model.date).valueOf() : null\r\n    };\r\n  },\r\n  fromPlain(model: ModelPlain): ListingModel | PlayerModel {\r\n    if (model.type === \"player\") {\r\n      return model;\r\n    }\r\n    if (model.type === undefined) {\r\n      return {\r\n        type: undefined,\r\n        date: model.date || null,\r\n        searchText: model.searchText || \"\",\r\n        selectedMode: model.selectedMode\r\n      };\r\n    }\r\n    console.warn(\"Unknown model data from location state:\", model);\r\n    // eslint-disable-next-line no-use-before-define, @typescript-eslint/no-use-before-define\r\n    return DEFAULT_MODEL;\r\n  },\r\n  removeExtraParams(model: Model): Model {\r\n    if (model.type === \"player\") {\r\n      return {\r\n        type: \"player\",\r\n        playerId: model.playerId,\r\n        selectedMode: \"\",\r\n        startDate: null,\r\n        endDate: null,\r\n        version: 0\r\n      };\r\n    }\r\n    return {\r\n      type: undefined,\r\n      searchText: \"\",\r\n      selectedMode: \"\",\r\n      date: null,\r\n      version: 0\r\n    };\r\n  }\r\n});\r\ntype ModelUpdate = Partial<ListingModel> | ({ type: \"player\" } & Partial<PlayerModel>);\r\ntype DispatchModelUpdate = (props: ModelUpdate) => void;\r\n\r\nconst DEFAULT_MODEL: ListingModel = { type: undefined, date: null, selectedMode: \"\", searchText: \"\" };\r\nconst ModelContext = React.createContext<[Readonly<Model>, DispatchModelUpdate]>([\r\n  { ...DEFAULT_MODEL, version: 0 },\r\n  () => {}\r\n]);\r\nexport const useModel = () => useContext(ModelContext);\r\n\r\nfunction normalizeUpdate(newProps: ModelUpdate): ModelUpdate {\r\n  if (newProps.type === undefined) {\r\n    if (newProps.date) {\r\n      newProps.date = dayjs(newProps.date).valueOf();\r\n    }\r\n  }\r\n  for (const key of Object.keys(newProps)) {\r\n    if (key !== \"type\" && newProps[key as keyof typeof newProps] === undefined) {\r\n      delete newProps[key as keyof typeof newProps];\r\n    }\r\n  }\r\n  return newProps;\r\n}\r\nfunction isSameDateValue(d1?: dayjs.ConfigType | null, d2?: dayjs.ConfigType | null): boolean {\r\n  if (d1 === d2) {\r\n    return true;\r\n  }\r\n  if (!d1 || !d2) {\r\n    return false;\r\n  }\r\n  return dayjs(d1).isSame(d2, \"day\");\r\n}\r\nfunction isChanged(oldModel: Model, newProps: ModelUpdate): boolean {\r\n  if (oldModel.type !== newProps.type) {\r\n    return true;\r\n  }\r\n  if (newProps.selectedMode !== undefined && newProps.selectedMode !== oldModel.selectedMode) {\r\n    return true;\r\n  }\r\n  if (oldModel.type === undefined && newProps.type === oldModel.type) {\r\n    if (newProps.date !== undefined && !isSameDateValue(newProps.date, oldModel.date)) {\r\n      return true;\r\n    }\r\n    if (newProps.searchText !== undefined && newProps.searchText !== oldModel.searchText) {\r\n      return true;\r\n    }\r\n  }\r\n  if (oldModel.type === \"player\" && newProps.type === oldModel.type) {\r\n    if (newProps.playerId !== undefined && newProps.playerId !== oldModel.playerId) {\r\n      return true;\r\n    }\r\n    if (newProps.startDate !== undefined && !isSameDateValue(oldModel.startDate, newProps.startDate)) {\r\n      return true;\r\n    }\r\n    if (newProps.endDate !== undefined && !isSameDateValue(oldModel.endDate, newProps.endDate)) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nexport function ModelProvider({ children }: { children: ReactChild | ReactChild[] }) {\r\n  const location = useLocation();\r\n  const [model, updateModel] = useReducer(\r\n    (oldModel: Model, newProps: ModelUpdate): Model =>\r\n      isChanged(oldModel, newProps)\r\n        ? {\r\n            ...((oldModel.type === newProps.type ? oldModel : {}) as Model),\r\n            ...(normalizeUpdate(newProps) as Model),\r\n            version: oldModel.version + 1,\r\n            pendingRouteUpdate: true\r\n          }\r\n        : oldModel,\r\n    null,\r\n    (): Model => ({\r\n      ...DEFAULT_MODEL,\r\n      ...Model.fromPlain((location.state || {}).model || {}),\r\n      version: new Date().getTime()\r\n    })\r\n  );\r\n  const value: [Model, DispatchModelUpdate] = useMemo(() => [model, updateModel], [model, updateModel]);\r\n  return <ModelContext.Provider value={value}>{children}</ModelContext.Provider>;\r\n}\r\n","import { useState, useEffect, useMemo, useCallback, useContext } from \"react\";\r\nimport React, { ReactChild } from \"react\";\r\nimport dayjs from \"dayjs\";\r\n\r\nimport {\r\n  DataProvider,\r\n  GameRecord,\r\n  FilterPredicate,\r\n  ListingDataProvider,\r\n  PlayerDataProvider\r\n} from \"../../utils/dataSource\";\r\nimport { useModel, Model } from \"./model\";\r\nimport { Metadata } from \"../../utils/dataSource\";\r\nimport { generatePath } from \"./routes\";\r\n\r\ninterface ItemLoadingPlaceholder {\r\n  loading: boolean;\r\n}\r\n\r\nconst loadingPlaceholder = { loading: true };\r\n\r\n// eslint-disable-next-line @typescript-eslint/interface-name-prefix\r\nexport interface IDataAdapter {\r\n  getCount(): number;\r\n  getUnfilteredCount(): number;\r\n  getMetadata<T extends Metadata>(): T | null;\r\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder;\r\n  isItemLoaded(index: number): boolean;\r\n}\r\n\r\nclass DummyDataAdapter implements IDataAdapter {\r\n  getCount(): number {\r\n    return 0;\r\n  }\r\n  getUnfilteredCount(): number {\r\n    return 0;\r\n  }\r\n  getMetadata<T extends Metadata>(): T | null {\r\n    return null;\r\n  }\r\n  getItem(): GameRecord | ItemLoadingPlaceholder {\r\n    return loadingPlaceholder;\r\n  }\r\n  isItemLoaded(): boolean {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const DUMMY_DATA_ADAPTER = new DummyDataAdapter() as IDataAdapter;\r\n\r\nconst noop = () => {};\r\n\r\nclass DataAdapter implements IDataAdapter {\r\n  _provider: DataProvider;\r\n  _onDataUpdate: (isError: boolean) => void;\r\n  _triggeredRequest: boolean;\r\n\r\n  constructor(provider: DataProvider, onDataUpdate = noop) {\r\n    this._provider = provider;\r\n    this._onDataUpdate = onDataUpdate;\r\n    this._triggeredRequest = false;\r\n  }\r\n  _installHook<T>(promise: Promise<T>) {\r\n    if (this._triggeredRequest) {\r\n      return;\r\n    }\r\n    this._triggeredRequest = true;\r\n    promise.then(() => this._callHook(false)).catch(() => this._callHook(true));\r\n  }\r\n  _callHook(isError: boolean) {\r\n    this._onDataUpdate(isError);\r\n  }\r\n  getCount(): number {\r\n    const maybeCount = this._provider.getCountMaybeSync();\r\n    if (maybeCount instanceof Promise) {\r\n      this._installHook(maybeCount);\r\n      return 0;\r\n    }\r\n    return maybeCount;\r\n  }\r\n  getUnfilteredCount(): number {\r\n    return this._provider.getUnfilteredCountSync() || 0;\r\n  }\r\n  getMetadata<T extends Metadata>(): T | null {\r\n    return this._provider.getMetadataSync() as T | null;\r\n  }\r\n  getItem(index: number): GameRecord | ItemLoadingPlaceholder {\r\n    if (index >= this.getCount()) {\r\n      return loadingPlaceholder;\r\n    }\r\n    if (this._provider.isItemLoaded(index)) {\r\n      return this._provider.getItem(index) as GameRecord;\r\n    }\r\n    if (!this._triggeredRequest) {\r\n      this._installHook(this._provider.getItem(index) as Promise<GameRecord>);\r\n    }\r\n    return loadingPlaceholder;\r\n  }\r\n  isItemLoaded(index: number): boolean {\r\n    if (index < 0) {\r\n      return false;\r\n    }\r\n    return this._provider.isItemLoaded(index);\r\n  }\r\n  setUpdateHook(hook: () => void) {\r\n    this._onDataUpdate = hook;\r\n  }\r\n  cancelUpdateHook() {\r\n    this._onDataUpdate = noop;\r\n  }\r\n}\r\n\r\nconst DataAdapterContext = React.createContext(DUMMY_DATA_ADAPTER);\r\n\r\nexport const useDataAdapter = () => useContext(DataAdapterContext);\r\nexport const DataAdapterConsumer = DataAdapterContext.Consumer;\r\n\r\nfunction getProviderKey(model: Model): string {\r\n  if (model.type === undefined) {\r\n    return dayjs(model.date || dayjs())\r\n      .startOf(\"day\")\r\n      .valueOf()\r\n      .toString();\r\n  } else if (model.type === \"player\") {\r\n    return generatePath(model);\r\n  }\r\n  throw new Error(\"Unknown model type\");\r\n}\r\n\r\nfunction createProvider(model: Model): DataProvider {\r\n  if (model.type === undefined) {\r\n    return ListingDataProvider.create(model.date || dayjs().startOf(\"day\"));\r\n  }\r\n  if (model.type === \"player\") {\r\n    return PlayerDataProvider.create(model.playerId, model.startDate, model.endDate, model.selectedMode);\r\n  }\r\n  throw new Error(\"Not implemented\");\r\n}\r\n\r\nfunction usePredicate(model: Model): FilterPredicate {\r\n  if (model.type !== undefined) {\r\n    return useMemo(() => null, [null, \"\"]);\r\n  }\r\n  const searchText = (model.searchText || \"\").trim() || \"\";\r\n  const needPredicate = searchText || model.selectedMode;\r\n  return useMemo(\r\n    () =>\r\n      needPredicate\r\n        ? game => {\r\n            if (model.selectedMode && model.selectedMode !== game.modeId.toString()) {\r\n              return false;\r\n            }\r\n            if (!game.players.some(player => player.nickname.toLowerCase().indexOf(searchText) > -1)) {\r\n              return false;\r\n            }\r\n            return true;\r\n          }\r\n        : null,\r\n    [(model.type === undefined && model.selectedMode) || null, searchText]\r\n  );\r\n}\r\n\r\nexport function DataAdapterProvider({ children }: { children: ReactChild | ReactChild[] }) {\r\n  const [model, updateModel] = useModel();\r\n  const [dataProviders] = useState(() => ({} as { [key: string]: DataProvider }));\r\n  const searchPredicate = usePredicate(model);\r\n  const dataProvider = useMemo(() => {\r\n    const key = getProviderKey(model);\r\n    if (!dataProviders[key]) {\r\n      dataProviders[key] = createProvider(model);\r\n    }\r\n    return dataProviders[key];\r\n  }, [model, dataProviders]);\r\n  const [dataAdapter, setDataAdapter] = useState(() => DUMMY_DATA_ADAPTER);\r\n  const refreshDataAdapter = useCallback(\r\n    (isError?: boolean) => {\r\n      if (isError) {\r\n        updateModel(Model.removeExtraParams(model));\r\n        return;\r\n      }\r\n      dataProvider.setFilterPredicate(searchPredicate);\r\n      const adapter = new DataAdapter(dataProvider);\r\n      setDataAdapter(adapter);\r\n    },\r\n    [dataProvider, searchPredicate, model, updateModel]\r\n  );\r\n  useEffect(refreshDataAdapter, [refreshDataAdapter]);\r\n  useEffect(() => {\r\n    const adapter = dataAdapter;\r\n    if (adapter instanceof DataAdapter) {\r\n      return () => adapter.cancelUpdateHook();\r\n    }\r\n  }, [dataAdapter]);\r\n  useEffect(() => {\r\n    const adapter = dataAdapter;\r\n    if (adapter instanceof DataAdapter) {\r\n      adapter.setUpdateHook(refreshDataAdapter);\r\n    }\r\n  }, [dataAdapter, refreshDataAdapter]);\r\n  useEffect(() => {\r\n    dataProvider.getCountMaybeSync(); // Preload metadata\r\n  }, [dataProvider]);\r\n  return <DataAdapterContext.Provider value={dataAdapter}>{children}</DataAdapterContext.Provider>;\r\n}\r\n","import React, { ReactNode } from \"react\";\r\n\r\nexport const FormRow = ({ title = \"\", inline = false, children = undefined as ReactNode }) => (\r\n  <div className=\"form-group row\">\r\n    <label className={`col-${inline ? \"lg\" : \"md\"}-2 col-form-label`}>{title}</label>\r\n    <div className={`col-${inline ? \"lg\" : \"md\"}-10 ${inline ? \"form-inline\" : \"\"}`}>{children}</div>\r\n  </div>\r\n);\r\n","import React, { ReactChild, useContext } from \"react\";\r\n\r\nimport { WindowScrollerChildProps } from \"react-virtualized\";\r\nimport { WindowScroller } from \"react-virtualized/dist/es/WindowScroller\";\r\n\r\nconst ScrollerContext = React.createContext<WindowScrollerChildProps>({} as any);\r\n\r\nexport const useScrollerProps = () => useContext(ScrollerContext);\r\n\r\nfunction Scroller({ children }: { children: ReactChild | ReactChild[] }) {\r\n  return (\r\n    <WindowScroller>\r\n      {scrollerProps => <ScrollerContext.Provider value={scrollerProps}>{children}</ScrollerContext.Provider>}\r\n    </WindowScroller>\r\n  );\r\n}\r\nexport default Scroller;\r\n","import React from \"react\";\n\nimport { CheckboxGroup } from \"../form\";\nimport { GameMode } from \"../../utils/dataSource\";\n\nconst MODE_CHECKBOXES = Object.keys(GameMode)\n  .filter(x => typeof GameMode[x as keyof typeof GameMode] !== \"string\")\n  .map(x => ({\n    key: String(GameMode[x as keyof typeof GameMode]),\n    label: x\n  }));\nMODE_CHECKBOXES.unshift({\n  key: \"\",\n  label: \"全部\"\n});\n\nexport function ModeSelector({ mode, onChange }: { mode: string; onChange: (x: string) => void }) {\n  return (\n    <CheckboxGroup\n      type=\"radio\"\n      groupKey=\"ModeSelector\"\n      items={MODE_CHECKBOXES}\n      selectedItemKey={mode || \"\"}\n      onChange={onChange}\n    />\n  );\n}\n"],"sourceRoot":""}